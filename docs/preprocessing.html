---

title: Preprocessing


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/03_preprocessing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_preprocessing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">load_ext</span> nb_black
<span class="o">%</span><span class="k">load_ext</span> lab_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7681c8e7-eeef-4ed2-96c6-e9c06fa32adb"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7681c8e7-eeef-4ed2-96c6-e9c06fa32adb');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_formatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.-Base">0. Base<a class="anchor-link" href="#0.-Base"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="0.1.-BaseProcessor">0.1. BaseProcessor<a class="anchor-link" href="#0.1.-BaseProcessor"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseProcessor" class="doc_header"><code>class</code> <code>BaseProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseProcessor</code>() :: <code>ABC</code></p>
</blockquote>
<p>New Preprocessors and Postprocessors should inherit from this object
and implement the transform method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="3d83e850-4f0e-49a6-8d1e-0d388f957c17"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#3d83e850-4f0e-49a6-8d1e-0d388f957c17');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "#export\nclass BaseProcessor(ABC):\n    \"\"\"\n    New Preprocessors and Postprocessors should inherit from this object\n    and implement the transform method.\n    \"\"\"\n    def __init__(self):\n        ...\n\n    @abstractmethod\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        ...\n\n    def __call__(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return self.transform(dataset=dataset, *args, **kwargs)";
                var nbb_formatted_code = "# export\nclass BaseProcessor(ABC):\n    \"\"\"\n    New Preprocessors and Postprocessors should inherit from this object\n    and implement the transform method.\n    \"\"\"\n\n    def __init__(self):\n        ...\n\n    @abstractmethod\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        ...\n\n    def __call__(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return self.transform(dataset=dataset, *args, **kwargs)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="0.2.-Decorators">0.2. Decorators<a class="anchor-link" href="#0.2.-Decorators"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You might have preprocessing functions that work with Pandas DataFrames and want to make them compatible with <code>numerai-blocks</code> <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a>s. This can be done by adding a single decorator (<a href="/numerai_blocks/preprocessing.html#support_dataset_processing"><code>support_dataset_processing</code></a>) to a method where you call a DataFrame function.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="support_dataset_processing" class="doc_header"><code>support_dataset_processing</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L39" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>support_dataset_processing</code>(<strong><code>func</code></strong>)</p>
</blockquote>
<p>Make existing DataFrame transformer compatible with Dataset input.
:param func: Some function/method that takes Pandas DataFrame as input
and return Pandas DataFrame.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="9646baba-65f5-4a0e-867e-fe1893a36a5e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#9646baba-65f5-4a0e-867e-fe1893a36a5e');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "#export\ndef support_dataset_processing(func):\n    \"\"\"\n    Make existing DataFrame transformer compatible with Dataset input.\n    :param func: Some function/method that takes Pandas DataFrame as input\n    and return Pandas DataFrame.\n    \"\"\"\n    @wraps(func)\n    def wrapper(dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataf_transform = func(dataset.dataf, *args, **kwargs)\n        metadata = dataset.__dict__\n        metadata.pop(\"dataf\", None)\n        return Dataset(dataf_transform, metadata)\n    return wrapper";
                var nbb_formatted_code = "# export\ndef support_dataset_processing(func):\n    \"\"\"\n    Make existing DataFrame transformer compatible with Dataset input.\n    :param func: Some function/method that takes Pandas DataFrame as input\n    and return Pandas DataFrame.\n    \"\"\"\n\n    @wraps(func)\n    def wrapper(dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataf_transform = func(dataset.dataf, *args, **kwargs)\n        metadata = dataset.__dict__\n        metadata.pop(\"dataf\", None)\n        return Dataset(dataf_transform, metadata)\n\n    return wrapper";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Decorator-example-+-tests.">Decorator example + tests.<a class="anchor-link" href="#Decorator-example-+-tests."> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_features</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="s2">&quot;ABCDEFGHIK&quot;</span><span class="p">]</span>
<span class="n">id_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">test_features</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pandas_quad</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple DataFrame function which takes gives column to power of 2. &quot;&quot;&quot;</span>
    <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_copy</span>

<span class="nd">@support_dataset_processing</span>
<span class="k">def</span> <span class="nf">test_dataf_with_dataset_input</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Put Dataset through function that normally only accepts Pandas DataFrame. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pandas_quad</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7e06f5d1-04b1-4c6e-ae9f-6a0767e0d5c3"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7e06f5d1-04b1-4c6e-ae9f-6a0767e0d5c3');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "# Random DataFrame\ntest_features = [f\"feature_{l}\" for l in \"ABCDEFGHIK\"]\nid_col = [uuid.uuid4().hex for _ in range(100)]\ndf = pd.DataFrame(np.random.uniform(size=(100, 10)), columns=test_features)\n\ndef pandas_quad(df: pd.DataFrame, col: str):\n    \"\"\" Simple DataFrame function which takes gives column to power of 2. \"\"\"\n    df_copy = df.copy()\n    df_copy.loc[:, col] = df_copy.loc[:, col].apply(lambda x: x ** 2)\n    return df_copy\n\n@support_dataset_processing\ndef test_dataf_with_dataset_input(dataset: Dataset, col: str) -> Dataset:\n    \"\"\" Put Dataset through function that normally only accepts Pandas DataFrame. \"\"\"\n    return pandas_quad(dataset, col=col)";
                var nbb_formatted_code = "# Random DataFrame\ntest_features = [f\"feature_{l}\" for l in \"ABCDEFGHIK\"]\nid_col = [uuid.uuid4().hex for _ in range(100)]\ndf = pd.DataFrame(np.random.uniform(size=(100, 10)), columns=test_features)\n\n\ndef pandas_quad(df: pd.DataFrame, col: str):\n    \"\"\"Simple DataFrame function which takes gives column to power of 2.\"\"\"\n    df_copy = df.copy()\n    df_copy.loc[:, col] = df_copy.loc[:, col].apply(lambda x: x ** 2)\n    return df_copy\n\n\n@support_dataset_processing\ndef test_dataf_with_dataset_input(dataset: Dataset, col: str) -> Dataset:\n    \"\"\"Put Dataset through function that normally only accepts Pandas DataFrame.\"\"\"\n    return pandas_quad(dataset, col=col)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The function <code>test_dataf_with_dataset_input</code> will behave as a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> preprocessor even though the function called within normally only accepts Pandas DataFrames.</p>
<p><code>transform_method_1</code> and <code>transform_method_2</code> will there lead to the same result.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_to_transform</span> <span class="o">=</span> <span class="s2">&quot;feature_B&quot;</span>
<span class="n">transform_method_1</span> <span class="o">=</span> <span class="n">test_dataf_with_dataset_input</span><span class="p">(</span><span class="n">Dataset</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="n">feature_to_transform</span><span class="p">)</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">feature_to_transform</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">transform_method_2</span> <span class="o">=</span> <span class="n">pandas_quad</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">feature_to_transform</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">feature_to_transform</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">transform_method_1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">transform_method_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="80b6c9f5-69e6-4628-bdd9-35ba68985ecf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#80b6c9f5-69e6-4628-bdd9-35ba68985ecf');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "feature_to_transform = \"feature_B\"\ntransform_method_1 = test_dataf_with_dataset_input(Dataset(df), col=feature_to_transform).get_column_selection(feature_to_transform).round(8)\ntransform_method_2 = pandas_quad(df, col=feature_to_transform).loc[:, [feature_to_transform]].round(8)\n\nassert transform_method_1.equals(transform_method_2)";
                var nbb_formatted_code = "feature_to_transform = \"feature_B\"\ntransform_method_1 = (\n    test_dataf_with_dataset_input(Dataset(df), col=feature_to_transform)\n    .get_column_selection(feature_to_transform)\n    .round(8)\n)\ntransform_method_2 = (\n    pandas_quad(df, col=feature_to_transform).loc[:, [feature_to_transform]].round(8)\n)\n\nassert transform_method_1.equals(transform_method_2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="0.3.-Logging">0.3. Logging<a class="anchor-link" href="#0.3.-Logging"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We would like to keep an overview of which steps are done in a data pipeline and where processing bottlenecks occur.
The decorator below will display:</p>
<ol>
<li>When a step has finished.</li>
<li>What the output shape of the data is.</li>
<li>How long the step took to finish</li>
</ol>
<p>Note that this wrapper only works for methods that return a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> object as a result. All implemented preprocessors, models and postprocessors have this property.</p>
<p>To use this functionality, simply add <code>@display_processor_info</code> as a decorator to the function/method you want to track.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="display_processor_info" class="doc_header"><code>display_processor_info</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>display_processor_info</code>(<strong><code>func</code></strong>)</p>
</blockquote>
<p>Fancy console output for data processing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7c5a56de-d6d2-4393-90bb-370880f52e19"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7c5a56de-d6d2-4393-90bb-370880f52e19');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "#export\ndef display_processor_info(func):\n    \"\"\" Fancy console output for data processing. \"\"\"\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        tic = dt.datetime.now()\n        result = func(*args, **kwargs)\n        time_taken = str(dt.datetime.now() - tic)\n        class_name = func.__qualname__.split('.')[0]\n        rich_print(f\":white_check_mark: Finished step [bold]{class_name}[/bold]. Output shape={result.dataf.shape}. Time taken for step: [blue]{time_taken}[/blue]. :white_check_mark:\")\n        return result\n    return wrapper";
                var nbb_formatted_code = "# export\ndef display_processor_info(func):\n    \"\"\"Fancy console output for data processing.\"\"\"\n\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        tic = dt.datetime.now()\n        result = func(*args, **kwargs)\n        time_taken = str(dt.datetime.now() - tic)\n        class_name = func.__qualname__.split(\".\")[0]\n        rich_print(\n            f\":white_check_mark: Finished step [bold]{class_name}[/bold]. Output shape={result.dataf.shape}. Time taken for step: [blue]{time_taken}[/blue]. :white_check_mark:\"\n        )\n        return result\n\n    return wrapper";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TestDisplay</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span>
    <span class="nd">@display_processor_info</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;test_assets/mini_numerai_version_1_data.csv&quot;</span><span class="p">)</span>
<span class="n">TestDisplay</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TestDisplay</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">314</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:02</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">003015</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="c8541ed7-056c-4d0a-b2b6-d8832db22b0a"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#c8541ed7-056c-4d0a-b2b6-d8832db22b0a');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "class TestDisplay:\n    def __init__(self, dataset: Dataset):\n        self.dataset = dataset\n    @display_processor_info\n    def test(self) -> Dataset:\n        time.sleep(2)\n        return self.dataset\n\ndataset = create_dataset(\"test_assets/mini_numerai_version_1_data.csv\")\nTestDisplay(dataset).test();";
                var nbb_formatted_code = "class TestDisplay:\n    def __init__(self, dataset: Dataset):\n        self.dataset = dataset\n\n    @display_processor_info\n    def test(self) -> Dataset:\n        time.sleep(2)\n        return self.dataset\n\n\ndataset = create_dataset(\"test_assets/mini_numerai_version_1_data.csv\")\nTestDisplay(dataset).test()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Common-preprocessing-steps">1. Common preprocessing steps<a class="anchor-link" href="#1.-Common-preprocessing-steps"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.1.-Version-agnostic">1.1. Version agnostic<a class="anchor-link" href="#1.1.-Version-agnostic"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CopyPreProcessor" class="doc_header"><code>class</code> <code>CopyPreProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L68" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CopyPreProcessor</code>() :: <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Copy DataFrame to avoid manipulation of original DataFrame.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="40cbb3e9-2bb1-4143-81dd-62f45754d86c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#40cbb3e9-2bb1-4143-81dd-62f45754d86c');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "#export\n@typechecked\nclass CopyPreProcessor(BaseProcessor):\n    \"\"\"Copy DataFrame to avoid manipulation of original DataFrame. \"\"\"\n    def __init__(self):\n        super(CopyPreProcessor, self).__init__()\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return dataset.copy_dataset()";
                var nbb_formatted_code = "# export\n@typechecked\nclass CopyPreProcessor(BaseProcessor):\n    \"\"\"Copy DataFrame to avoid manipulation of original DataFrame.\"\"\"\n\n    def __init__(self):\n        super(CopyPreProcessor, self).__init__()\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return dataset.copy_dataset()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;test_assets/mini_numerai_version_1_data.csv&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">CopyPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">copied_dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">dataf</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">multi_target</span> <span class="o">==</span> <span class="p">(</span><span class="n">copied_dataset</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">copied_dataset</span><span class="o">.</span><span class="n">multi_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">CopyPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">314</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">000599</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="beeb7340-9c79-43ce-8c63-792c7986c2bb"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#beeb7340-9c79-43ce-8c63-792c7986c2bb');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "dataset = create_dataset(\"test_assets/mini_numerai_version_1_data.csv\", version=1)\ncopied_dataset = CopyPreProcessor().transform(dataset)\nassert copied_dataset.dataf.equals(dataset.dataf)\nassert dataset.version, dataset.multi_target == (copied_dataset.version, copied_dataset.multi_target)";
                var nbb_formatted_code = "dataset = create_dataset(\"test_assets/mini_numerai_version_1_data.csv\", version=1)\ncopied_dataset = CopyPreProcessor().transform(dataset)\nassert copied_dataset.dataf.equals(dataset.dataf)\nassert dataset.version, dataset.multi_target == (\n    copied_dataset.version,\n    copied_dataset.multi_target,\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FeatureSelectionPreProcessor" class="doc_header"><code>class</code> <code>FeatureSelectionPreProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L79" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FeatureSelectionPreProcessor</code>(<strong><code>feature_cols</code></strong>:<code>Union</code>[<code>str</code>, <code>list</code>]) :: <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Keep only features given + all target, predictions and aux columns.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="1ea76802-e86c-4833-8bcd-f9199bbb51cf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#1ea76802-e86c-4833-8bcd-f9199bbb51cf');

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "#export\n@typechecked\nclass FeatureSelectionPreProcessor(BaseProcessor):\n    \"\"\"\n    Keep only features given + all target, predictions and aux columns.\n    \"\"\"\n    def __init__(self, feature_cols: Union[str, list]):\n        super(FeatureSelectionPreProcessor, self).__init__()\n        self.feature_cols = feature_cols\n\n    @display_processor_info\n    def transform(self, dataset: Dataset) -> Dataset:\n        keep_cols = self.feature_cols + dataset.target_cols + dataset.prediction_cols + dataset.aux_cols\n        dataset.dataf = dataset.dataf.loc[:, keep_cols]\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "# export\n@typechecked\nclass FeatureSelectionPreProcessor(BaseProcessor):\n    \"\"\"\n    Keep only features given + all target, predictions and aux columns.\n    \"\"\"\n\n    def __init__(self, feature_cols: Union[str, list]):\n        super(FeatureSelectionPreProcessor, self).__init__()\n        self.feature_cols = feature_cols\n\n    @display_processor_info\n    def transform(self, dataset: Dataset) -> Dataset:\n        keep_cols = (\n            self.feature_cols\n            + dataset.target_cols\n            + dataset.prediction_cols\n            + dataset.aux_cols\n        )\n        dataset.dataf = dataset.dataf.loc[:, keep_cols]\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">selected_dataset</span> <span class="o">=</span> <span class="n">FeatureSelectionPreProcessor</span><span class="p">(</span><span class="n">feature_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feature_wisdom1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">selected_dataset</span><span class="o">.</span><span class="n">get_feature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">multi_target</span> <span class="o">==</span> <span class="p">(</span><span class="n">selected_dataset</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">selected_dataset</span><span class="o">.</span><span class="n">multi_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">FeatureSelectionPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">000670</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="580083e6-9a1d-4d8d-927b-1d11f40e8cf6"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#580083e6-9a1d-4d8d-927b-1d11f40e8cf6');

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "selected_dataset = FeatureSelectionPreProcessor(feature_cols=['feature_wisdom1']).transform(dataset)\nassert selected_dataset.get_feature_data.shape[1] == 1\nassert dataset.version, dataset.multi_target == (selected_dataset.version, selected_dataset.multi_target)";
                var nbb_formatted_code = "selected_dataset = FeatureSelectionPreProcessor(\n    feature_cols=[\"feature_wisdom1\"]\n).transform(dataset)\nassert selected_dataset.get_feature_data.shape[1] == 1\nassert dataset.version, dataset.multi_target == (\n    selected_dataset.version,\n    selected_dataset.multi_target,\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">selected_dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_wisdom1</th>
      <th>target</th>
      <th>id</th>
      <th>era</th>
      <th>data_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.25</td>
      <td>0.50</td>
      <td>n000315175b67977</td>
      <td>era1</td>
      <td>train</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.50</td>
      <td>0.25</td>
      <td>n0014af834a96cdd</td>
      <td>era1</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="5620d3cb-d0b8-4050-99e0-c2a8dcf9bfdf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#5620d3cb-d0b8-4050-99e0-c2a8dcf9bfdf');

            setTimeout(function() {
                var nbb_cell_id = 15;
                var nbb_unformatted_code = "selected_dataset.dataf.head(2)";
                var nbb_formatted_code = "selected_dataset.dataf.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.2.-Version-1-specific">1.2. Version 1 specific<a class="anchor-link" href="#1.2.-Version-1-specific"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GroupStatsPreProcessor" class="doc_header"><code>class</code> <code>GroupStatsPreProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L95" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GroupStatsPreProcessor</code>() :: <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>WARNING: Only supported for Version 1 (legacy) data.
Calculate group statistics for all data groups.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="b405d062-a32e-4c49-af61-78e4674f3934"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#b405d062-a32e-4c49-af61-78e4674f3934');

            setTimeout(function() {
                var nbb_cell_id = 16;
                var nbb_unformatted_code = "#export\n@typechecked\nclass GroupStatsPreProcessor(BaseProcessor):\n    \"\"\"\n    WARNING: Only supported for Version 1 (legacy) data.\n    Calculate group statistics for all data groups.\n    \"\"\"\n    def __init__(self):\n        super(GroupStatsPreProcessor, self).__init__()\n        self.group_names = [\"intelligence\", \"wisdom\", \"charisma\",\n                            \"dexterity\", \"strength\", \"constitution\"]\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        self._check_data_validity(dataset=dataset)\n        dataset.dataf = dataset.dataf.pipe(self._add_group_features)\n        return Dataset(**dataset.__dict__)\n\n    def _add_group_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\" Mean, standard deviation and skew for each group. \"\"\"\n        for group in self.group_names:\n            cols = [col for col in dataf.columns if group in col]\n            dataf[f\"feature_{group}_mean\"] = dataf[cols].mean(axis=1)\n            dataf[f\"feature_{group}_std\"] = dataf[cols].std(axis=1)\n            dataf[f\"feature_{group}_skew\"] = dataf[cols].skew(axis=1)\n        return dataf\n\n    def _check_data_validity(self, dataset: Dataset):\n        assert hasattr(dataset, 'version'), f\"Version should be specified for '{self.__class__.__name__}' This Preprocessor will only work on version 1 data.\"\n        assert getattr(dataset, 'version') == 1, f\"'{self.__class__.__name__}' only works on version 1 data. Got version: '{getattr(dataset, 'version')}'.\"";
                var nbb_formatted_code = "# export\n@typechecked\nclass GroupStatsPreProcessor(BaseProcessor):\n    \"\"\"\n    WARNING: Only supported for Version 1 (legacy) data.\n    Calculate group statistics for all data groups.\n    \"\"\"\n\n    def __init__(self):\n        super(GroupStatsPreProcessor, self).__init__()\n        self.group_names = [\n            \"intelligence\",\n            \"wisdom\",\n            \"charisma\",\n            \"dexterity\",\n            \"strength\",\n            \"constitution\",\n        ]\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        self._check_data_validity(dataset=dataset)\n        dataset.dataf = dataset.dataf.pipe(self._add_group_features)\n        return Dataset(**dataset.__dict__)\n\n    def _add_group_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"Mean, standard deviation and skew for each group.\"\"\"\n        for group in self.group_names:\n            cols = [col for col in dataf.columns if group in col]\n            dataf[f\"feature_{group}_mean\"] = dataf[cols].mean(axis=1)\n            dataf[f\"feature_{group}_std\"] = dataf[cols].std(axis=1)\n            dataf[f\"feature_{group}_skew\"] = dataf[cols].skew(axis=1)\n        return dataf\n\n    def _check_data_validity(self, dataset: Dataset):\n        assert hasattr(\n            dataset, \"version\"\n        ), f\"Version should be specified for '{self.__class__.__name__}' This Preprocessor will only work on version 1 data.\"\n        assert (\n            getattr(dataset, \"version\") == 1\n        ), f\"'{self.__class__.__name__}' only works on version 1 data. Got version: '{getattr(dataset, 'version')}'.\"";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">group_features_dataset</span> <span class="o">=</span> <span class="n">GroupStatsPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">copied_dataset</span><span class="p">)</span>
<span class="n">group_features_dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">group_features_dataset</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">GroupStatsPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">332</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">022079</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="1a3270b0-087a-45bc-9c1a-ad016bdb0fc1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#1a3270b0-087a-45bc-9c1a-ad016bdb0fc1');

            setTimeout(function() {
                var nbb_cell_id = 17;
                var nbb_unformatted_code = "group_features_dataset = GroupStatsPreProcessor().transform(copied_dataset)\ngroup_features_dataset.dataf.head(2)\nassert group_features_dataset.version == 1";
                var nbb_formatted_code = "group_features_dataset = GroupStatsPreProcessor().transform(copied_dataset)\ngroup_features_dataset.dataf.head(2)\nassert group_features_dataset.version == 1";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_cols</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;feature_intelligence_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_intelligence_std&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_intelligence_skew&#39;</span><span class="p">,</span>
             <span class="s1">&#39;feature_wisdom_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_wisdom_std&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_wisdom_skew&#39;</span><span class="p">,</span>
             <span class="s1">&#39;feature_charisma_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_charisma_std&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_charisma_skew&#39;</span><span class="p">,</span>
             <span class="s1">&#39;feature_dexterity_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_dexterity_std&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_dexterity_skew&#39;</span><span class="p">,</span>
             <span class="s1">&#39;feature_strength_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_strength_std&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_strength_skew&#39;</span><span class="p">,</span>
             <span class="s1">&#39;feature_constitution_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_constitution_std&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_constitution_skew&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">group_features_dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span>
<span class="n">group_features_dataset</span><span class="o">.</span><span class="n">get_feature_data</span><span class="p">[</span><span class="n">new_cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_intelligence_mean</th>
      <th>feature_intelligence_std</th>
      <th>feature_intelligence_skew</th>
      <th>feature_wisdom_mean</th>
      <th>feature_wisdom_std</th>
      <th>feature_wisdom_skew</th>
      <th>feature_charisma_mean</th>
      <th>feature_charisma_std</th>
      <th>feature_charisma_skew</th>
      <th>feature_dexterity_mean</th>
      <th>feature_dexterity_std</th>
      <th>feature_dexterity_skew</th>
      <th>feature_strength_mean</th>
      <th>feature_strength_std</th>
      <th>feature_strength_skew</th>
      <th>feature_constitution_mean</th>
      <th>feature_constitution_std</th>
      <th>feature_constitution_skew</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.333333</td>
      <td>0.246183</td>
      <td>0.558528</td>
      <td>0.668478</td>
      <td>0.236022</td>
      <td>-0.115082</td>
      <td>0.438953</td>
      <td>0.259910</td>
      <td>-0.004783</td>
      <td>0.696429</td>
      <td>0.200446</td>
      <td>-0.607620</td>
      <td>0.480263</td>
      <td>0.292829</td>
      <td>-0.372064</td>
      <td>0.427632</td>
      <td>0.27572</td>
      <td>0.276155</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.208333</td>
      <td>0.234359</td>
      <td>0.382554</td>
      <td>0.559783</td>
      <td>0.358177</td>
      <td>-0.062362</td>
      <td>0.485465</td>
      <td>0.252501</td>
      <td>-0.021737</td>
      <td>0.267857</td>
      <td>0.249312</td>
      <td>0.382267</td>
      <td>0.407895</td>
      <td>0.309866</td>
      <td>0.220625</td>
      <td>0.644737</td>
      <td>0.33408</td>
      <td>-0.794938</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="120dc957-04e7-40df-b36b-d8d14d642a1f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#120dc957-04e7-40df-b36b-d8d14d642a1f');

            setTimeout(function() {
                var nbb_cell_id = 18;
                var nbb_unformatted_code = "new_cols =  ['feature_intelligence_mean', 'feature_intelligence_std', 'feature_intelligence_skew',\n             'feature_wisdom_mean', 'feature_wisdom_std', 'feature_wisdom_skew',\n             'feature_charisma_mean', 'feature_charisma_std', 'feature_charisma_skew',\n             'feature_dexterity_mean', 'feature_dexterity_std', 'feature_dexterity_skew',\n             'feature_strength_mean', 'feature_strength_std', 'feature_strength_skew',\n             'feature_constitution_mean', 'feature_constitution_std', 'feature_constitution_skew']\nassert set(group_features_dataset.dataf.columns).intersection(new_cols)\ngroup_features_dataset.get_feature_data[new_cols].head(2)";
                var nbb_formatted_code = "new_cols = [\n    \"feature_intelligence_mean\",\n    \"feature_intelligence_std\",\n    \"feature_intelligence_skew\",\n    \"feature_wisdom_mean\",\n    \"feature_wisdom_std\",\n    \"feature_wisdom_skew\",\n    \"feature_charisma_mean\",\n    \"feature_charisma_std\",\n    \"feature_charisma_skew\",\n    \"feature_dexterity_mean\",\n    \"feature_dexterity_std\",\n    \"feature_dexterity_skew\",\n    \"feature_strength_mean\",\n    \"feature_strength_std\",\n    \"feature_strength_skew\",\n    \"feature_constitution_mean\",\n    \"feature_constitution_std\",\n    \"feature_constitution_skew\",\n]\nassert set(group_features_dataset.dataf.columns).intersection(new_cols)\ngroup_features_dataset.get_feature_data[new_cols].head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/numerai_blocks/preprocessing.html#GroupStatsPreProcessor"><code>GroupStatsPreProcessor</code></a> should break if <code>version != 1</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_invalid_version</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">):</span>
    <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">copy_dataset</span><span class="p">()</span>
    <span class="n">copied_dataset</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">GroupStatsPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">copied_dataset</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="n">test_invalid_version</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="60fc1229-00c3-49a6-903d-54fedbf9e1b0"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#60fc1229-00c3-49a6-903d-54fedbf9e1b0');

            setTimeout(function() {
                var nbb_cell_id = 19;
                var nbb_unformatted_code = "def test_invalid_version(dataset: Dataset):\n    copied_dataset = dataset.copy_dataset()\n    copied_dataset.version = 2\n    try:\n        GroupStatsPreProcessor().transform(copied_dataset)\n    except AssertionError:\n        return True\n    return False\n\ntest_invalid_version(dataset);";
                var nbb_formatted_code = "def test_invalid_version(dataset: Dataset):\n    copied_dataset = dataset.copy_dataset()\n    copied_dataset.version = 2\n    try:\n        GroupStatsPreProcessor().transform(copied_dataset)\n    except AssertionError:\n        return True\n    return False\n\n\ntest_invalid_version(dataset)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.3.-Version-2-specific">1.3. Version 2 specific<a class="anchor-link" href="#1.3.-Version-2-specific"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.4.-Signals-specific">1.4. Signals specific<a class="anchor-link" href="#1.4.-Signals-specific"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.4.1.-Pattern-Features">1.4.1. Pattern Features<a class="anchor-link" href="#1.4.1.-Pattern-Features"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># @typechecked</span>
<span class="c1"># class TalibPatternFeatures(BaseProcessor):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Get all pattern recognition features available in TA-Lib</span>
<span class="c1">#     More information: https://mrjbq7.github.io/ta-lib/func_groups/pattern_recognition.html</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, ticker_col: str = &quot;ticker&quot;):</span>
<span class="c1">#         super(TalibPatternFeatures, self).__init__()</span>
<span class="c1">#         self.ticker_col = ticker_col</span>
<span class="c1">#         # All pattern recognition features start with &quot;CDL&quot; in TA-Lib</span>
<span class="c1">#         self.funcs = [getattr(talib, name) for name in dir(talib) if name.startswith(&quot;CDL&quot;)]</span>
<span class="c1">#</span>
<span class="c1">#     @display_processor_info</span>
<span class="c1">#     def transform(self, dataset: Dataset, *args, **kwargs) -&gt; Dataset:</span>
<span class="c1">#         all_tickers = list(dataset.dataf[self.ticker_col].unique())</span>
<span class="c1">#         for func in self.funcs:</span>
<span class="c1">#             for ticker in all_tickers:</span>
<span class="c1">#                 index_mask = dataset.dataf[self.ticker_col] == ticker</span>
<span class="c1">#                 sub_df = dataset.dataf.loc[index_mask, :]</span>
<span class="c1">#                 open, high = sub_df[&#39;Open&#39;], sub_df[&#39;High&#39;]</span>
<span class="c1">#                 low, close = sub_df[&#39;Low&#39;], sub_df[&#39;Close&#39;]</span>
<span class="c1">#                 dataset.dataf.loc[index_mask, f&quot;feature_{func.__qualname__}&quot;] = func(open, high, low, close)</span>
<span class="c1">#         return Dataset(**dataset.__dict__)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8c8fdd6a-e0b9-46c1-ab71-9d443ca7ccea"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8c8fdd6a-e0b9-46c1-ab71-9d443ca7ccea');

            setTimeout(function() {
                var nbb_cell_id = 20;
                var nbb_unformatted_code = "# export\n@typechecked\nclass TalibPatternFeatures(BaseProcessor):\n    \"\"\"\n    Get all pattern recognition features available in TA-Lib\n    More information: https://mrjbq7.github.io/ta-lib/func_groups/pattern_recognition.html\n    \"\"\"\n    def __init__(self, ticker_col: str = \"ticker\"):\n        super(TalibPatternFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        # All pattern recognition features start with \"CDL\" in TA-Lib\n        self.funcs = [getattr(talib, name) for name in dir(talib) if name.startswith(\"CDL\")]\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        all_tickers = list(dataset.dataf[self.ticker_col].unique())\n        for func in self.funcs:\n            for ticker in all_tickers:\n                index_mask = dataset.dataf[self.ticker_col] == ticker\n                sub_df = dataset.dataf.loc[index_mask, :]\n                open, high = sub_df['Open'], sub_df['High']\n                low, close = sub_df['Low'], sub_df['Close']\n                dataset.dataf.loc[index_mask, f\"feature_{func.__qualname__}\"] = func(open, high, low, close)\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "# export\n@typechecked\nclass TalibPatternFeatures(BaseProcessor):\n    \"\"\"\n    Get all pattern recognition features available in TA-Lib\n    More information: https://mrjbq7.github.io/ta-lib/func_groups/pattern_recognition.html\n    \"\"\"\n\n    def __init__(self, ticker_col: str = \"ticker\"):\n        super(TalibPatternFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        # All pattern recognition features start with \"CDL\" in TA-Lib\n        self.funcs = [\n            getattr(talib, name) for name in dir(talib) if name.startswith(\"CDL\")\n        ]\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        all_tickers = list(dataset.dataf[self.ticker_col].unique())\n        for func in self.funcs:\n            for ticker in all_tickers:\n                index_mask = dataset.dataf[self.ticker_col] == ticker\n                sub_df = dataset.dataf.loc[index_mask, :]\n                open, high = sub_df[\"Open\"], sub_df[\"High\"]\n                low, close = sub_df[\"Low\"], sub_df[\"Close\"]\n                dataset.dataf.loc[index_mask, f\"feature_{func.__qualname__}\"] = func(\n                    open, high, low, close\n                )\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ticker_col = &quot;Symbol&quot;</span>
<span class="c1"># ta_patterns = TalibPatternFeatures(ticker_col=ticker_col)</span>
<span class="c1"># transformed_dataset = ta_patterns.transform(signals_test_data)</span>
<span class="c1"># assert len(transformed_dataset.feature_cols) == 61</span>
<span class="c1"># assert not (transformed_dataset.get_feature_data == 0).all().all()</span>
<span class="c1"># transformed_dataset.get_feature_data.head(2)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TalibPatternFeatures</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2991</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">71</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">118371</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_CDL2CROWS</th>
      <th>feature_CDL3BLACKCROWS</th>
      <th>feature_CDL3INSIDE</th>
      <th>feature_CDL3LINESTRIKE</th>
      <th>feature_CDL3OUTSIDE</th>
      <th>feature_CDL3STARSINSOUTH</th>
      <th>feature_CDL3WHITESOLDIERS</th>
      <th>feature_CDLABANDONEDBABY</th>
      <th>feature_CDLADVANCEBLOCK</th>
      <th>feature_CDLBELTHOLD</th>
      <th>...</th>
      <th>feature_CDLSPINNINGTOP</th>
      <th>feature_CDLSTALLEDPATTERN</th>
      <th>feature_CDLSTICKSANDWICH</th>
      <th>feature_CDLTAKURI</th>
      <th>feature_CDLTASUKIGAP</th>
      <th>feature_CDLTHRUSTING</th>
      <th>feature_CDLTRISTAR</th>
      <th>feature_CDLUNIQUE3RIVER</th>
      <th>feature_CDLUPSIDEGAP2CROWS</th>
      <th>feature_CDLXSIDEGAP3METHODS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 61 columns</p>
</div>
</div>

</div>

<div class="output_area">




<div id="1eba8a34-daef-4dfa-8a02-976bdb330d87"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#1eba8a34-daef-4dfa-8a02-976bdb330d87');

            setTimeout(function() {
                var nbb_cell_id = 21;
                var nbb_unformatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nta_patterns = TalibPatternFeatures(ticker_col=ticker_col)\ntransformed_dataset = ta_patterns.transform(signals_test_data)\nassert len(transformed_dataset.feature_cols) == 61\nassert not (transformed_dataset.get_feature_data == 0).all().all()\ntransformed_dataset.get_feature_data.head(2)";
                var nbb_formatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nta_patterns = TalibPatternFeatures(ticker_col=ticker_col)\ntransformed_dataset = ta_patterns.transform(signals_test_data)\nassert len(transformed_dataset.feature_cols) == 61\nassert not (transformed_dataset.get_feature_data == 0).all().all()\ntransformed_dataset.get_feature_data.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.4.2.-Volume-indicators">1.4.2. Volume indicators<a class="anchor-link" href="#1.4.2.-Volume-indicators"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># @typechecked</span>
<span class="c1"># class TalibVolumeFeatures(BaseProcessor):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Get all volume features using TA-Lib</span>
<span class="c1">#     More information: https://mrjbq7.github.io/ta-lib/func_groups/volume_indicators.html</span>
<span class="c1">#</span>
<span class="c1">#     :param ticker_col: Column name that points to ticker names</span>
<span class="c1">#     :param fastperiod, slowperiod: Periodic arguments for ADOSC (Chaikin A/D Oscillator).</span>
<span class="c1">#     See http://www.tadoc.org/indicator/ADOSC.htm for more information on how these arguments are used.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, ticker_col: str = &quot;ticker&quot;, fastperiod: int = 3, slowperiod: int = 10):</span>
<span class="c1">#         super(TalibVolumeFeatures, self).__init__()</span>
<span class="c1">#         self.ticker_col = ticker_col</span>
<span class="c1">#         self.volume_features = [&#39;AD&#39;, &#39;ADOSC&#39;, &#39;OBV&#39;]</span>
<span class="c1">#         self.fastperiod = fastperiod</span>
<span class="c1">#         self.slowperiod = slowperiod</span>
<span class="c1">#</span>
<span class="c1">#     @display_processor_info</span>
<span class="c1">#     def transform(self, dataset: Dataset) -&gt; Dataset:</span>
<span class="c1">#         all_tickers = list(dataset.dataf[self.ticker_col].unique())</span>
<span class="c1">#         for ticker in all_tickers:</span>
<span class="c1">#             index_mask = dataset.dataf[self.ticker_col] == ticker</span>
<span class="c1">#             sub_df = dataset.dataf.loc[index_mask, :]</span>
<span class="c1">#</span>
<span class="c1">#             high, low = sub_df[&#39;High&#39;].to_numpy(), sub_df[&#39;Low&#39;].to_numpy()</span>
<span class="c1">#             close, volume = sub_df[&#39;Close&#39;].to_numpy(), sub_df[&#39;Volume&#39;].to_numpy()</span>
<span class="c1">#</span>
<span class="c1">#             dataset.dataf.loc[index_mask, &quot;feature_AD&quot;] = talib.AD(high, low, close, volume)</span>
<span class="c1">#             adosc = talib.ADOSC(high, low, close, volume, fastperiod=self.fastperiod, slowperiod=self.slowperiod)</span>
<span class="c1">#             dataset.dataf.loc[index_mask, &quot;feature_ADOSC&quot;] = np.nan_to_num(adosc, nan=0.0)</span>
<span class="c1">#             dataset.dataf.loc[index_mask, &quot;feature_OBV&quot;] = talib.OBV(close, volume)</span>
<span class="c1">#         return Dataset(**dataset.__dict__)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="0c48d0f1-27a1-43c0-9b02-59be90c2d829"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#0c48d0f1-27a1-43c0-9b02-59be90c2d829');

            setTimeout(function() {
                var nbb_cell_id = 22;
                var nbb_unformatted_code = "# export\n@typechecked\nclass TalibVolumeFeatures(BaseProcessor):\n    \"\"\"\n    Get all volume features using TA-Lib\n    More information: https://mrjbq7.github.io/ta-lib/func_groups/volume_indicators.html\n\n    :param ticker_col: Column name that points to ticker names\n    :param fastperiod, slowperiod: Periodic arguments for ADOSC (Chaikin A/D Oscillator).\n    See http://www.tadoc.org/indicator/ADOSC.htm for more information on how these arguments are used.\n    \"\"\"\n    def __init__(self, ticker_col: str = \"ticker\", fastperiod: int = 3, slowperiod: int = 10):\n        super(TalibVolumeFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        self.volume_features = ['AD', 'ADOSC', 'OBV']\n        self.fastperiod = fastperiod\n        self.slowperiod = slowperiod\n\n    @display_processor_info\n    def transform(self, dataset: Dataset) -> Dataset:\n        all_tickers = list(dataset.dataf[self.ticker_col].unique())\n        for ticker in all_tickers:\n            index_mask = dataset.dataf[self.ticker_col] == ticker\n            sub_df = dataset.dataf.loc[index_mask, :]\n\n            high, low = sub_df['High'].to_numpy(), sub_df['Low'].to_numpy()\n            close, volume = sub_df['Close'].to_numpy(), sub_df['Volume'].to_numpy()\n\n            dataset.dataf.loc[index_mask, \"feature_AD\"] = talib.AD(high, low, close, volume)\n            adosc = talib.ADOSC(high, low, close, volume, fastperiod=self.fastperiod, slowperiod=self.slowperiod)\n            dataset.dataf.loc[index_mask, \"feature_ADOSC\"] = np.nan_to_num(adosc, nan=0.0)\n            dataset.dataf.loc[index_mask, \"feature_OBV\"] = talib.OBV(close, volume)\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "# export\n@typechecked\nclass TalibVolumeFeatures(BaseProcessor):\n    \"\"\"\n    Get all volume features using TA-Lib\n    More information: https://mrjbq7.github.io/ta-lib/func_groups/volume_indicators.html\n\n    :param ticker_col: Column name that points to ticker names\n    :param fastperiod, slowperiod: Periodic arguments for ADOSC (Chaikin A/D Oscillator).\n    See http://www.tadoc.org/indicator/ADOSC.htm for more information on how these arguments are used.\n    \"\"\"\n\n    def __init__(\n        self, ticker_col: str = \"ticker\", fastperiod: int = 3, slowperiod: int = 10\n    ):\n        super(TalibVolumeFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        self.volume_features = [\"AD\", \"ADOSC\", \"OBV\"]\n        self.fastperiod = fastperiod\n        self.slowperiod = slowperiod\n\n    @display_processor_info\n    def transform(self, dataset: Dataset) -> Dataset:\n        all_tickers = list(dataset.dataf[self.ticker_col].unique())\n        for ticker in all_tickers:\n            index_mask = dataset.dataf[self.ticker_col] == ticker\n            sub_df = dataset.dataf.loc[index_mask, :]\n\n            high, low = sub_df[\"High\"].to_numpy(), sub_df[\"Low\"].to_numpy()\n            close, volume = sub_df[\"Close\"].to_numpy(), sub_df[\"Volume\"].to_numpy()\n\n            dataset.dataf.loc[index_mask, \"feature_AD\"] = talib.AD(\n                high, low, close, volume\n            )\n            adosc = talib.ADOSC(\n                high,\n                low,\n                close,\n                volume,\n                fastperiod=self.fastperiod,\n                slowperiod=self.slowperiod,\n            )\n            dataset.dataf.loc[index_mask, \"feature_ADOSC\"] = np.nan_to_num(\n                adosc, nan=0.0\n            )\n            dataset.dataf.loc[index_mask, \"feature_OBV\"] = talib.OBV(close, volume)\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ticker_col = &quot;Symbol&quot;</span>
<span class="c1"># fastperiod, slowperiod = 4, 11</span>
<span class="c1"># ta_volume_features = TalibVolumeFeatures(ticker_col=ticker_col, fastperiod=fastperiod, slowperiod=slowperiod)</span>
<span class="c1"># dataset_with_volume_features = ta_volume_features.transform(dataset=signals_test_data)</span>
<span class="c1"># assert fastperiod == ta_volume_features.fastperiod</span>
<span class="c1"># assert slowperiod == ta_volume_features.slowperiod</span>
<span class="c1"># assert list(dataset_with_volume_features.get_feature_data.columns) == [f&quot;feature_{name}&quot; for name in ta_volume_features.volume_features]</span>
<span class="c1"># dataset_with_volume_features.get_feature_data.head(2)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TalibVolumeFeatures</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2991</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">002763</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_AD</th>
      <th>feature_ADOSC</th>
      <th>feature_OBV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="17c7eb75-0288-4c52-898f-ed113a970f7c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#17c7eb75-0288-4c52-898f-ed113a970f7c');

            setTimeout(function() {
                var nbb_cell_id = 23;
                var nbb_unformatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nfastperiod, slowperiod = 4, 11\nta_volume_features = TalibVolumeFeatures(ticker_col=ticker_col, fastperiod=fastperiod, slowperiod=slowperiod)\ndataset_with_volume_features = ta_volume_features.transform(dataset=signals_test_data)\nassert fastperiod == ta_volume_features.fastperiod\nassert slowperiod == ta_volume_features.slowperiod\nassert list(dataset_with_volume_features.get_feature_data.columns) == [f\"feature_{name}\" for name in ta_volume_features.volume_features]\ndataset_with_volume_features.get_feature_data.head(2)";
                var nbb_formatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nfastperiod, slowperiod = 4, 11\nta_volume_features = TalibVolumeFeatures(\n    ticker_col=ticker_col, fastperiod=fastperiod, slowperiod=slowperiod\n)\ndataset_with_volume_features = ta_volume_features.transform(dataset=signals_test_data)\nassert fastperiod == ta_volume_features.fastperiod\nassert slowperiod == ta_volume_features.slowperiod\nassert list(dataset_with_volume_features.get_feature_data.columns) == [\n    f\"feature_{name}\" for name in ta_volume_features.volume_features\n]\ndataset_with_volume_features.get_feature_data.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.4.3.-Realized-volatility">1.4.3. Realized volatility<a class="anchor-link" href="#1.4.3.-Realized-volatility"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Implement 30day and 90 days, 180 days and 360 days vol?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="b47e0ffc-3b04-41ce-9b51-d3c75849ce33"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#b47e0ffc-3b04-41ce-9b51-d3c75849ce33');

            setTimeout(function() {
                var nbb_cell_id = 24;
                var nbb_unformatted_code = "# export\n@typechecked\nclass RealizedVolFeatures(BaseProcessor):\n    \"\"\"\n    Features based on realized volatility features.\n    Dataset DataFrame should have a column named \"Close\".\n    Source and more information: https://dspyt.com/advanced-realized-volatility-and-quarticity/\n    \"\"\"\n    def __init__(self, ticker_col: str = 'ticker', price_col: str = 'Close'):\n        super(RealizedVolFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        self.price_col = price_col\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        \"\"\" Get all realized volatility features. \"\"\"\n        series = dataset.dataf.loc[:, self.price_col]\n        tickers = dataset.dataf.loc[:, self.ticker_col]\n        dataset.dataf.loc[:, \"feature_vol2\"] = series.groupby(tickers).agg(self.realized_2)\n        dataset.dataf.loc[:, \"feature_vol3\"] = series.groupby(tickers).agg(self.realized_3)\n        dataset.dataf.loc[:, \"feature_vol4\"] = series.groupby(tickers).agg(self.realized_4)\n        # Parse all contents of Dataset to the next pipeline step\n        return Dataset(**dataset.__dict__)\n\n    @staticmethod\n    def simple_realized_vol(series: pd.Series) -> np.float64:\n        \"\"\" Most simple way to calculate realized volatility. \"\"\"\n        return np.sqrt(np.sum(series**2))\n\n    @staticmethod\n    def realized_2(series: pd.Series) -> np.float64:\n        return np.sqrt(np.sum(series**4)/(6*np.sum(series**2)))\n\n    @staticmethod\n    def realized_3(series: pd.Series) -> np.float64:\n        return np.sqrt(((np.pi**2)*np.sum(abs(series.rolling(window=4).apply(np.product,\n                                                                             raw=True))))/(8*np.sum(series**2)))\n\n    @staticmethod\n    def realized_4(series: pd.Series) -> np.float64:\n        numerator = (gamma(1/2)**3)*np.sum((abs(series)**(4/3)).rolling(window=3).apply(np.prod))\n        denominator = 8 * (gamma(7/6)**3)*np.sum(series**2)\n        return np.sqrt(numerator/denominator)";
                var nbb_formatted_code = "# export\n@typechecked\nclass RealizedVolFeatures(BaseProcessor):\n    \"\"\"\n    Features based on realized volatility features.\n    Dataset DataFrame should have a column named \"Close\".\n    Source and more information: https://dspyt.com/advanced-realized-volatility-and-quarticity/\n    \"\"\"\n\n    def __init__(self, ticker_col: str = \"ticker\", price_col: str = \"Close\"):\n        super(RealizedVolFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        self.price_col = price_col\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        \"\"\"Get all realized volatility features.\"\"\"\n        series = dataset.dataf.loc[:, self.price_col]\n        tickers = dataset.dataf.loc[:, self.ticker_col]\n        dataset.dataf.loc[:, \"feature_vol2\"] = series.groupby(tickers).agg(\n            self.realized_2\n        )\n        dataset.dataf.loc[:, \"feature_vol3\"] = series.groupby(tickers).agg(\n            self.realized_3\n        )\n        dataset.dataf.loc[:, \"feature_vol4\"] = series.groupby(tickers).agg(\n            self.realized_4\n        )\n        # Parse all contents of Dataset to the next pipeline step\n        return Dataset(**dataset.__dict__)\n\n    @staticmethod\n    def simple_realized_vol(series: pd.Series) -> np.float64:\n        \"\"\"Most simple way to calculate realized volatility.\"\"\"\n        return np.sqrt(np.sum(series ** 2))\n\n    @staticmethod\n    def realized_2(series: pd.Series) -> np.float64:\n        return np.sqrt(np.sum(series ** 4) / (6 * np.sum(series ** 2)))\n\n    @staticmethod\n    def realized_3(series: pd.Series) -> np.float64:\n        return np.sqrt(\n            (\n                (np.pi ** 2)\n                * np.sum(abs(series.rolling(window=4).apply(np.product, raw=True)))\n            )\n            / (8 * np.sum(series ** 2))\n        )\n\n    @staticmethod\n    def realized_4(series: pd.Series) -> np.float64:\n        numerator = (gamma(1 / 2) ** 3) * np.sum(\n            (abs(series) ** (4 / 3)).rolling(window=3).apply(np.prod)\n        )\n        denominator = 8 * (gamma(7 / 6) ** 3) * np.sum(series ** 2)\n        return np.sqrt(numerator / denominator)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ticker_col = &quot;Symbol&quot;</span>
<span class="c1"># vol_features = RealizedVolFeatures(ticker_col=ticker_col)</span>
<span class="c1"># dataset_with_vol_features = vol_features.transform(dataset=signals_test_data)</span>
<span class="c1"># all_vol_cols = [&#39;feature_vol2&#39;, &#39;feature_vol3&#39;, &#39;feature_vol4&#39;]</span>
<span class="c1"># assert dataset_with_vol_features.feature_cols == all_vol_cols</span>
<span class="c1"># for col in all_vol_cols:</span>
<span class="c1">#     assert dataset_with_vol_features.dataf[col].value_counts().nunique() != 1</span>
<span class="c1"># # assert not dataset_with_vol_features.get_feature_data.isna().all().all()</span>
<span class="c1"># dataset_with_vol_features.get_feature_data.head(3)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">RealizedVolFeatures</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2991</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">255835</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_vol2</th>
      <th>feature_vol3</th>
      <th>feature_vol4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="74ea476d-9992-42e9-af0c-e88bbe2b783d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#74ea476d-9992-42e9-af0c-e88bbe2b783d');

            setTimeout(function() {
                var nbb_cell_id = 25;
                var nbb_unformatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nvol_features = RealizedVolFeatures(ticker_col=ticker_col)\ndataset_with_vol_features = vol_features.transform(dataset=signals_test_data)\nall_vol_cols = ['feature_vol2', 'feature_vol3', 'feature_vol4']\nassert dataset_with_vol_features.feature_cols == all_vol_cols\nfor col in all_vol_cols:\n    assert dataset_with_vol_features.dataf[col].value_counts().nunique() != 1\n# assert not dataset_with_vol_features.get_feature_data.isna().all().all()\ndataset_with_vol_features.get_feature_data.head(3)";
                var nbb_formatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nvol_features = RealizedVolFeatures(ticker_col=ticker_col)\ndataset_with_vol_features = vol_features.transform(dataset=signals_test_data)\nall_vol_cols = [\"feature_vol2\", \"feature_vol3\", \"feature_vol4\"]\nassert dataset_with_vol_features.feature_cols == all_vol_cols\nfor col in all_vol_cols:\n    assert dataset_with_vol_features.dataf[col].value_counts().nunique() != 1\n# assert not dataset_with_vol_features.get_feature_data.isna().all().all()\ndataset_with_vol_features.get_feature_data.head(3)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.4.4.-Quarticity">1.4.4. Quarticity<a class="anchor-link" href="#1.4.4.-Quarticity"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="ee9335aa-cf78-440e-9cf9-a0e5199e451b"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ee9335aa-cf78-440e-9cf9-a0e5199e451b');

            setTimeout(function() {
                var nbb_cell_id = 30;
                var nbb_unformatted_code = "# export\n@typechecked\nclass QuarticityFeatures(BaseProcessor):\n    \"\"\"\n    Quarticity (Vol of vol) features.\n    Source and more information: https://dspyt.com/advanced-realized-volatility-and-quarticity/\n    \"\"\"\n    def __init__(self, ticker_col: str = 'ticker', price_col: str = 'Close'):\n        super(QuarticityFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        self.price_col = price_col\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        \"\"\" Get most powerful quarticity features for every stock. \"\"\"\n        series = dataset.dataf.loc[:, self.price_col]\n        tickers = dataset.dataf.loc[:, self.ticker_col]\n        quad_quarticity = series.groupby(tickers).agg(self.realized_quadpower_quarticity)\n        tripower_quarticity = series.groupby(tickers).agg(self.realized_tripower_quarticity)\n        dataset.dataf.loc[:, \"feature_quadpower_quarticity\"] = quad_quarticity\n        dataset.dataf.loc[:, \"feature_tripower_quarticity\"] = tripower_quarticity\n        return Dataset(**dataset.__dict__)\n\n    @staticmethod\n    def realized_quarticity(series: pd.Series) -> np.float64:\n        \"\"\"\n        The realized fourth-power variation or realized quarticity\n        is a consistent estimator of the integrated quarticity.\n        \"\"\"\n        return np.sum(series**4) * series.shape[0] / 3\n\n    @staticmethod\n    def realized_quadpower_quarticity(series: pd.Series) -> np.float64:\n        \"\"\"\n        A more robust estimator compared to realized quarticity,\n        particularly in the presence of jumps, is the realized quad-power quarticity.\n        \"\"\"\n        series = abs(series.rolling(window=4).apply(np.product, raw=True))\n        return (np.sum(series) * series.shape[0] * (np.pi**2)) / 4\n\n    @staticmethod\n    def realized_tripower_quarticity(series: pd.Series) -> np.float64:\n        \"\"\" Similarly robust estimator to quad power quarticity. \"\"\"\n        series = series ** (4/3)\n        series = abs(series).rolling(window=3).apply(np.prod, raw=True)\n        return series.shape[0]*0.25*((gamma(1/2)**3)/(gamma(7/6)**3))*np.sum(series)";
                var nbb_formatted_code = "# export\n@typechecked\nclass QuarticityFeatures(BaseProcessor):\n    \"\"\"\n    Quarticity (Vol of vol) features.\n    Source and more information: https://dspyt.com/advanced-realized-volatility-and-quarticity/\n    \"\"\"\n\n    def __init__(self, ticker_col: str = \"ticker\", price_col: str = \"Close\"):\n        super(QuarticityFeatures, self).__init__()\n        self.ticker_col = ticker_col\n        self.price_col = price_col\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        \"\"\"Get most powerful quarticity features for every stock.\"\"\"\n        series = dataset.dataf.loc[:, self.price_col]\n        tickers = dataset.dataf.loc[:, self.ticker_col]\n        quad_quarticity = series.groupby(tickers).agg(\n            self.realized_quadpower_quarticity\n        )\n        tripower_quarticity = series.groupby(tickers).agg(\n            self.realized_tripower_quarticity\n        )\n        dataset.dataf.loc[:, \"feature_quadpower_quarticity\"] = quad_quarticity\n        dataset.dataf.loc[:, \"feature_tripower_quarticity\"] = tripower_quarticity\n        return Dataset(**dataset.__dict__)\n\n    @staticmethod\n    def realized_quarticity(series: pd.Series) -> np.float64:\n        \"\"\"\n        The realized fourth-power variation or realized quarticity\n        is a consistent estimator of the integrated quarticity.\n        \"\"\"\n        return np.sum(series ** 4) * series.shape[0] / 3\n\n    @staticmethod\n    def realized_quadpower_quarticity(series: pd.Series) -> np.float64:\n        \"\"\"\n        A more robust estimator compared to realized quarticity,\n        particularly in the presence of jumps, is the realized quad-power quarticity.\n        \"\"\"\n        series = abs(series.rolling(window=4).apply(np.product, raw=True))\n        return (np.sum(series) * series.shape[0] * (np.pi ** 2)) / 4\n\n    @staticmethod\n    def realized_tripower_quarticity(series: pd.Series) -> np.float64:\n        \"\"\"Similarly robust estimator to quad power quarticity.\"\"\"\n        series = series ** (4 / 3)\n        series = abs(series).rolling(window=3).apply(np.prod, raw=True)\n        return (\n            series.shape[0]\n            * 0.25\n            * ((gamma(1 / 2) ** 3) / (gamma(7 / 6) ** 3))\n            * np.sum(series)\n        )";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ticker_col = &quot;Symbol&quot;</span>
<span class="c1"># quart_features = QuarticityFeatures(ticker_col=ticker_col)</span>
<span class="c1"># dataset_with_quart_features = quart_features.transform(dataset=signals_test_data)</span>
<span class="c1"># assert dataset_with_quart_features.feature_cols == [&quot;feature_quadpower_quarticity&quot;, &quot;feature_tripower_quarticity&quot;]</span>
<span class="c1"># assert dataset_with_quart_features.dataf[&quot;feature_quadpower_quarticity&quot;].value_counts().nunique() != 1</span>
<span class="c1"># assert dataset_with_quart_features.dataf[&quot;feature_tripower_quarticity&quot;].value_counts().nunique() != 1</span>
<span class="c1"># # assert not dataset_with_quart_features.get_feature_data.isna().all().all()</span>
<span class="c1"># dataset_with_quart_features.get_feature_data.head(2)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">QuarticityFeatures</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2991</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">039181</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_quadpower_quarticity</th>
      <th>feature_tripower_quarticity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="a73663d9-b90b-4560-a1ca-e4f0f8251689"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#a73663d9-b90b-4560-a1ca-e4f0f8251689');

            setTimeout(function() {
                var nbb_cell_id = 31;
                var nbb_unformatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nquart_features = QuarticityFeatures(ticker_col=ticker_col)\ndataset_with_quart_features = quart_features.transform(dataset=signals_test_data)\nassert dataset_with_quart_features.feature_cols == [\"feature_quadpower_quarticity\", \"feature_tripower_quarticity\"]\nassert dataset_with_quart_features.dataf[\"feature_quadpower_quarticity\"].value_counts().nunique() != 1\nassert dataset_with_quart_features.dataf[\"feature_tripower_quarticity\"].value_counts().nunique() != 1\n# assert not dataset_with_quart_features.get_feature_data.isna().all().all()\ndataset_with_quart_features.get_feature_data.head(2)";
                var nbb_formatted_code = "signals_test_data = create_dataset(\"test_assets/bitcoin_time_series_test_data.csv\")\nticker_col = \"Symbol\"\nquart_features = QuarticityFeatures(ticker_col=ticker_col)\ndataset_with_quart_features = quart_features.transform(dataset=signals_test_data)\nassert dataset_with_quart_features.feature_cols == [\n    \"feature_quadpower_quarticity\",\n    \"feature_tripower_quarticity\",\n]\nassert (\n    dataset_with_quart_features.dataf[\"feature_quadpower_quarticity\"]\n    .value_counts()\n    .nunique()\n    != 1\n)\nassert (\n    dataset_with_quart_features.dataf[\"feature_tripower_quarticity\"]\n    .value_counts()\n    .nunique()\n    != 1\n)\n# assert not dataset_with_quart_features.get_feature_data.isna().all().all()\ndataset_with_quart_features.get_feature_data.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Custom-preprocessors">2. Custom preprocessors<a class="anchor-link" href="#2.-Custom-preprocessors"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are an almost unlimited number of ways to preprocess data. We have only scratched the surface with the preprocessors currently implemented in <code>numerai-blocks</code>. We invite the Numerai community to develop Numerai Classic and Signals preprocessors for <code>numerai-blocks</code>.</p>
<p>A new Preprocessor should inherit from <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a> and implement a <code>transform</code> method. The <code>transform</code> method should take a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> as input and return a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> object as output. An example is given below.</p>
<p>To enable fancy logging output. Add the <code>@display_processor_info</code> decorator to the <code>transform</code> method.</p>
<p>Note that arbitrary metadata can be added or changed in a preprocessing step.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AwesomePreProcessor" class="doc_header"><code>class</code> <code>AwesomePreProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L216" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AwesomePreProcessor</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<ul>
<li>TEMPLATE -
Do some awesome preprocessing.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

