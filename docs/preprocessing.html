---

title: Preprocessing


keywords: fastai
sidebar: home_sidebar

summary: "Feature/target selection, engineering and manipulation."
description: "Feature/target selection, engineering and manipulation."
nb_path: "nbs/03_preprocessing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_preprocessing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.-Base">0. Base<a class="anchor-link" href="#0.-Base"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These objects will provide a base for all pre- and post-processing functionality and log relevant information.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.1.-BaseProcessor">0.1. BaseProcessor<a class="anchor-link" href="#0.1.-BaseProcessor"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a> defines common functionality for <code>preprocessing</code> and <code>postprocessing</code> (Section 5).</p>
<p>Every Preprocessor should inherit from <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a> and implement the <code>.transform</code> method.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseProcessor" class="doc_header"><code>class</code> <code>BaseProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L33" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseProcessor</code>() :: <code>ABC</code></p>
</blockquote>
<p>Common functionality for preprocessors and postprocessors.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="55edd1f4-4ccc-4d02-bffc-a8c38f76655d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#55edd1f4-4ccc-4d02-bffc-a8c38f76655d');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "# export\nclass BaseProcessor(ABC):\n    \"\"\"Common functionality for preprocessors and postprocessors.\"\"\"\n\n    def __init__(self):\n        ...\n\n    @abstractmethod\n    def transform(\n        self, dataf: Union[pd.DataFrame, NumerFrame], *args, **kwargs\n    ) -> NumerFrame:\n        ...\n\n    def __call__(\n        self, dataf: Union[pd.DataFrame, NumerFrame], *args, **kwargs\n    ) -> NumerFrame:\n        return self.transform(dataf=dataf, *args, **kwargs)";
                var nbb_formatted_code = "# export\nclass BaseProcessor(ABC):\n    \"\"\"Common functionality for preprocessors and postprocessors.\"\"\"\n\n    def __init__(self):\n        ...\n\n    @abstractmethod\n    def transform(\n        self, dataf: Union[pd.DataFrame, NumerFrame], *args, **kwargs\n    ) -> NumerFrame:\n        ...\n\n    def __call__(\n        self, dataf: Union[pd.DataFrame, NumerFrame], *args, **kwargs\n    ) -> NumerFrame:\n        return self.transform(dataf=dataf, *args, **kwargs)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.2.-Logging">0.2. Logging<a class="anchor-link" href="#0.2.-Logging"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We would like to keep an overview of which steps are done in a data pipeline and where processing bottlenecks occur.
The decorator below will display for a given function/method:</p>
<ol>
<li>When it has finished.</li>
<li>What the output shape of the data is.</li>
<li>How long it took to finish.</li>
</ol>
<p>To use this functionality, simply add <code>@display_processor_info</code> as a decorator to the function/method you want to track.</p>
<p>We will use this decorator throughout the pipeline (<code>preprocessing</code>, <code>model</code> and <code>postprocessing</code>).</p>
<p>Inspiration for this decorator: <a href="https://calmcode.io/pandas-pipe/logs.html">Calmcode Pandas Pipe Logs</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="display_processor_info" class="doc_header"><code>display_processor_info</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L51" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>display_processor_info</code>(<strong><code>func</code></strong>)</p>
</blockquote>
<p>Fancy console output for data processing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8a26b25d-cbb2-46c2-bf65-26b803851cce"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8a26b25d-cbb2-46c2-bf65-26b803851cce');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "# export\ndef display_processor_info(func):\n    \"\"\"Fancy console output for data processing.\"\"\"\n\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        tic = dt.datetime.now()\n        result = func(*args, **kwargs)\n        time_taken = str(dt.datetime.now() - tic)\n        class_name = func.__qualname__.split(\".\")[0]\n        rich_print(\n            f\":white_check_mark: Finished step [bold]{class_name}[/bold]. Output shape={result.shape}. Time taken for step: [blue]{time_taken}[/blue]. :white_check_mark:\"\n        )\n        return result\n\n    return wrapper";
                var nbb_formatted_code = "# export\ndef display_processor_info(func):\n    \"\"\"Fancy console output for data processing.\"\"\"\n\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        tic = dt.datetime.now()\n        result = func(*args, **kwargs)\n        time_taken = str(dt.datetime.now() - tic)\n        class_name = func.__qualname__.split(\".\")[0]\n        rich_print(\n            f\":white_check_mark: Finished step [bold]{class_name}[/bold]. Output shape={result.shape}. Time taken for step: [blue]{time_taken}[/blue]. :white_check_mark:\"\n        )\n        return result\n\n    return wrapper";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TestDisplay</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">314</span><span style="font-weight: bold">)</span>. Time taken for step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:02</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">001335</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>era</th>
      <th>data_type</th>
      <th>feature_intelligence1</th>
      <th>feature_intelligence2</th>
      <th>feature_intelligence3</th>
      <th>feature_intelligence4</th>
      <th>feature_intelligence5</th>
      <th>feature_intelligence6</th>
      <th>feature_intelligence7</th>
      <th>...</th>
      <th>feature_wisdom38</th>
      <th>feature_wisdom39</th>
      <th>feature_wisdom40</th>
      <th>feature_wisdom41</th>
      <th>feature_wisdom42</th>
      <th>feature_wisdom43</th>
      <th>feature_wisdom44</th>
      <th>feature_wisdom45</th>
      <th>feature_wisdom46</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>n000315175b67977</td>
      <td>era1</td>
      <td>train</td>
      <td>0.00</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>...</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>n0014af834a96cdd</td>
      <td>era1</td>
      <td>train</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>1.00</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>n001c93979ac41d4</td>
      <td>era1</td>
      <td>train</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>3</th>
      <td>n0034e4143f22a13</td>
      <td>era1</td>
      <td>train</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>...</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>4</th>
      <td>n00679d1a636062f</td>
      <td>era1</td>
      <td>train</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>...</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.00</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>5</th>
      <td>n009aa2d32389eca</td>
      <td>era1</td>
      <td>train</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>6</th>
      <td>n009ef1a5fe009b6</td>
      <td>era1</td>
      <td>train</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>...</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>7</th>
      <td>n00ae5d51f55fb0f</td>
      <td>era1</td>
      <td>train</td>
      <td>0.25</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>8</th>
      <td>n00b0ac86d77aed7</td>
      <td>era1</td>
      <td>train</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>9</th>
      <td>n00c63366aeaf76a</td>
      <td>era1</td>
      <td>train</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>0.75</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 314 columns</p>
</div>
</div>

</div>

<div class="output_area">




<div id="fb2d6b0c-2b6a-450c-90a9-ba6b8ece04c3"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#fb2d6b0c-2b6a-450c-90a9-ba6b8ece04c3');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "# hide_input\nclass TestDisplay:\n    \"\"\"\n    Small test for logging.\n    Output should mention 'TestDisplay',\n    Return output shape of (10, 314) and\n    time taken for step should be close to 2 seconds.\n    \"\"\"\n\n    def __init__(self, dataf: NumerFrame):\n        self.dataf = dataf\n\n    @display_processor_info\n    def test(self) -> NumerFrame:\n        time.sleep(2)\n        return self.dataf\n\n\ndataf = create_numerframe(\"test_assets/mini_numerai_version_1_data.csv\")\nTestDisplay(dataf).test()";
                var nbb_formatted_code = "# hide_input\nclass TestDisplay:\n    \"\"\"\n    Small test for logging.\n    Output should mention 'TestDisplay',\n    Return output shape of (10, 314) and\n    time taken for step should be close to 2 seconds.\n    \"\"\"\n\n    def __init__(self, dataf: NumerFrame):\n        self.dataf = dataf\n\n    @display_processor_info\n    def test(self) -> NumerFrame:\n        time.sleep(2)\n        return self.dataf\n\n\ndataf = create_numerframe(\"test_assets/mini_numerai_version_1_data.csv\")\nTestDisplay(dataf).test()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Common-preprocessing-steps">1. Common preprocessing steps<a class="anchor-link" href="#1.-Common-preprocessing-steps"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This section implements commonly used preprocessing for Numerai. We invite the Numerai community to develop new preprocessors.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.0-Tournament-agnostic">1.0 Tournament agnostic<a class="anchor-link" href="#1.0-Tournament-agnostic"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preprocessors that can be applied for both Numerai Classic and Numerai Signals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.0.1.-CopyPreProcessor">1.0.1. CopyPreProcessor<a class="anchor-link" href="#1.0.1.-CopyPreProcessor"> </a></h3><p>The first and obvious preprocessor is copying, which is implemented as a default in <a href="/numerbloxmodelpipeline.html#ModelPipeline"><code>ModelPipeline</code></a> (Section 4) to avoid manipulation of the original DataFrame or <a href="/numerbloxnumerframe.html#NumerFrame"><code>NumerFrame</code></a> that you load in.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CopyPreProcessor" class="doc_header"><code>class</code> <code>CopyPreProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L69" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CopyPreProcessor</code>() :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Copy DataFrame to avoid manipulation of original DataFrame.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="1fe7a0b7-23f2-4efd-8abe-f9b6f798ad9d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#1fe7a0b7-23f2-4efd-8abe-f9b6f798ad9d');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# export\n@typechecked\nclass CopyPreProcessor(BaseProcessor):\n    \"\"\"Copy DataFrame to avoid manipulation of original DataFrame.\"\"\"\n\n    def __init__(self):\n        super().__init__()\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        return NumerFrame(dataf.copy())";
                var nbb_formatted_code = "# export\n@typechecked\nclass CopyPreProcessor(BaseProcessor):\n    \"\"\"Copy DataFrame to avoid manipulation of original DataFrame.\"\"\"\n\n    def __init__(self):\n        super().__init__()\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        return NumerFrame(dataf.copy())";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">create_numerframe</span><span class="p">(</span>
    <span class="s2">&quot;test_assets/mini_numerai_version_1_data.csv&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">CopyPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">copied_dataset</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">meta</span> <span class="o">==</span> <span class="n">copied_dataset</span><span class="o">.</span><span class="n">meta</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">CopyPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">314</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">003811</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="d925390f-450c-4367-97be-3164a2a89da6"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d925390f-450c-4367-97be-3164a2a89da6');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "dataset = create_numerframe(\n    \"test_assets/mini_numerai_version_1_data.csv\", metadata={\"version\": 1}\n)\ncopied_dataset = CopyPreProcessor().transform(dataset)\nassert np.array_equal(copied_dataset.values, dataset.values)\nassert dataset.meta == copied_dataset.meta";
                var nbb_formatted_code = "dataset = create_numerframe(\n    \"test_assets/mini_numerai_version_1_data.csv\", metadata={\"version\": 1}\n)\ncopied_dataset = CopyPreProcessor().transform(dataset)\nassert np.array_equal(copied_dataset.values, dataset.values)\nassert dataset.meta == copied_dataset.meta";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.0.2.-FeatureSelectionPreProcessor">1.0.2. FeatureSelectionPreProcessor<a class="anchor-link" href="#1.0.2.-FeatureSelectionPreProcessor"> </a></h3><p><a href="/numerbloxpreprocessing.html#FeatureSelectionPreProcessor"><code>FeatureSelectionPreProcessor</code></a> will keep all features that you pass + keeps all other columns that are not features.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FeatureSelectionPreProcessor" class="doc_header"><code>class</code> <code>FeatureSelectionPreProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L81" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FeatureSelectionPreProcessor</code>(<strong><code>feature_cols</code></strong>:<code>Union</code>[<code>str</code>, <code>list</code>]) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Keep only features given + all target, predictions and aux columns.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="61ecfbff-4e6a-4ec3-ab2c-bf5e81c0389e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#61ecfbff-4e6a-4ec3-ab2c-bf5e81c0389e');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "# export\n@typechecked\nclass FeatureSelectionPreProcessor(BaseProcessor):\n    \"\"\"\n    Keep only features given + all target, predictions and aux columns.\n    \"\"\"\n\n    def __init__(self, feature_cols: Union[str, list]):\n        super().__init__()\n        self.feature_cols = feature_cols\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame) -> NumerFrame:\n        keep_cols = (\n            self.feature_cols\n            + dataf.target_cols\n            + dataf.prediction_cols\n            + dataf.aux_cols\n        )\n        dataf = dataf.loc[:, keep_cols]\n        return NumerFrame(dataf)";
                var nbb_formatted_code = "# export\n@typechecked\nclass FeatureSelectionPreProcessor(BaseProcessor):\n    \"\"\"\n    Keep only features given + all target, predictions and aux columns.\n    \"\"\"\n\n    def __init__(self, feature_cols: Union[str, list]):\n        super().__init__()\n        self.feature_cols = feature_cols\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame) -> NumerFrame:\n        keep_cols = (\n            self.feature_cols\n            + dataf.target_cols\n            + dataf.prediction_cols\n            + dataf.aux_cols\n        )\n        dataf = dataf.loc[:, keep_cols]\n        return NumerFrame(dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">selected_dataset</span> <span class="o">=</span> <span class="n">FeatureSelectionPreProcessor</span><span class="p">(</span>
    <span class="n">feature_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature_wisdom1&quot;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">selected_dataset</span><span class="o">.</span><span class="n">get_feature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">meta</span> <span class="o">==</span> <span class="n">selected_dataset</span><span class="o">.</span><span class="n">meta</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">FeatureSelectionPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">001214</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="81e399be-94c1-4f08-8683-808dffe0f48a"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#81e399be-94c1-4f08-8683-808dffe0f48a');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "selected_dataset = FeatureSelectionPreProcessor(\n    feature_cols=[\"feature_wisdom1\"]\n).transform(dataset)\n\nassert selected_dataset.get_feature_data.shape[1] == 1\nassert dataset.meta == selected_dataset.meta";
                var nbb_formatted_code = "selected_dataset = FeatureSelectionPreProcessor(\n    feature_cols=[\"feature_wisdom1\"]\n).transform(dataset)\n\nassert selected_dataset.get_feature_data.shape[1] == 1\nassert dataset.meta == selected_dataset.meta";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">selected_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_wisdom1</th>
      <th>target</th>
      <th>id</th>
      <th>era</th>
      <th>data_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.25</td>
      <td>0.50</td>
      <td>n000315175b67977</td>
      <td>era1</td>
      <td>train</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.50</td>
      <td>0.25</td>
      <td>n0014af834a96cdd</td>
      <td>era1</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="55f70196-5d4d-4088-b992-b27d60b4c80c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#55f70196-5d4d-4088-b992-b27d60b4c80c');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "selected_dataset.head(2)";
                var nbb_formatted_code = "selected_dataset.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.0.3.-TargetSelectionPreProcessor">1.0.3. TargetSelectionPreProcessor<a class="anchor-link" href="#1.0.3.-TargetSelectionPreProcessor"> </a></h3><p><a href="/numerbloxpreprocessing.html#TargetSelectionPreProcessor"><code>TargetSelectionPreProcessor</code></a> will keep all targets that you pass + all other columns that are not targets.</p>
<p>Not relevant for an inference pipeline, but especially convenient for Numerai Classic training if you train on a subset of the available targets. Can also be applied to Signals if you are using engineered targets in your pipeline.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TargetSelectionPreProcessor" class="doc_header"><code>class</code> <code>TargetSelectionPreProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L103" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TargetSelectionPreProcessor</code>(<strong><code>target_cols</code></strong>:<code>Union</code>[<code>str</code>, <code>list</code>]) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Keep only features given + all target, predictions and aux columns.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="a4b9d4e2-9805-4eb9-ae05-25bf4a1cc3f4"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#a4b9d4e2-9805-4eb9-ae05-25bf4a1cc3f4');

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "# export\n@typechecked\nclass TargetSelectionPreProcessor(BaseProcessor):\n    \"\"\"\n    Keep only features given + all target, predictions and aux columns.\n    \"\"\"\n\n    def __init__(self, target_cols: Union[str, list]):\n        super().__init__()\n        self.target_cols = target_cols\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame) -> NumerFrame:\n        keep_cols = (\n            self.target_cols\n            + dataf.feature_cols\n            + dataf.prediction_cols\n            + dataf.aux_cols\n        )\n        dataf = dataf.loc[:, keep_cols]\n        return NumerFrame(dataf)";
                var nbb_formatted_code = "# export\n@typechecked\nclass TargetSelectionPreProcessor(BaseProcessor):\n    \"\"\"\n    Keep only features given + all target, predictions and aux columns.\n    \"\"\"\n\n    def __init__(self, target_cols: Union[str, list]):\n        super().__init__()\n        self.target_cols = target_cols\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame) -> NumerFrame:\n        keep_cols = (\n            self.target_cols\n            + dataf.feature_cols\n            + dataf.prediction_cols\n            + dataf.aux_cols\n        )\n        dataf = dataf.loc[:, keep_cols]\n        return NumerFrame(dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">create_numerframe</span><span class="p">(</span>
    <span class="s2">&quot;test_assets/mini_numerai_version_2_data.parquet&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;target_nomi_20&quot;</span><span class="p">,</span> <span class="s2">&quot;target_nomi_60&quot;</span><span class="p">]</span>
<span class="n">selected_dataset</span> <span class="o">=</span> <span class="n">TargetSelectionPreProcessor</span><span class="p">(</span><span class="n">target_cols</span><span class="o">=</span><span class="n">target_cols</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
    <span class="n">dataset</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">selected_dataset</span><span class="o">.</span><span class="n">get_target_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_cols</span><span class="p">)</span>
<span class="n">selected_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">TargetSelectionPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1055</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">025717</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>target_nomi_20</th>
      <th>target_nomi_60</th>
      <th>feature_dichasial_hammier_spawner</th>
      <th>feature_rheumy_epistemic_prancer</th>
      <th>feature_pert_performative_hormuz</th>
      <th>feature_hillier_unpitied_theobromine</th>
      <th>feature_perigean_bewitching_thruster</th>
      <th>feature_renegade_undomestic_milord</th>
      <th>feature_koranic_rude_corf</th>
      <th>...</th>
      <th>feature_drawable_exhortative_dispersant</th>
      <th>feature_metabolic_minded_armorist</th>
      <th>feature_investigatory_inerasable_circumvallation</th>
      <th>feature_centroclinal_incentive_lancelet</th>
      <th>feature_unemotional_quietistic_chirper</th>
      <th>feature_behaviorist_microbiological_farina</th>
      <th>feature_lofty_acceptable_challenge</th>
      <th>feature_coactive_prefatorial_lucy</th>
      <th>era</th>
      <th>data_type</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n559bd06a8861222</th>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>1.0</td>
      <td>...</td>
      <td>1.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>1.00</td>
      <td>0.25</td>
      <td>0297</td>
      <td>train</td>
    </tr>
    <tr>
      <th>n9d39dea58c9e3cf</th>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.5</td>
      <td>...</td>
      <td>0.25</td>
      <td>0.5</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>1.0</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>0003</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 1055 columns</p>
</div>
</div>

</div>

<div class="output_area">




<div id="ffffd020-a339-4c5f-93f2-4369f44c96f2"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ffffd020-a339-4c5f-93f2-4369f44c96f2');

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "dataset = create_numerframe(\n    \"test_assets/mini_numerai_version_2_data.parquet\", metadata={\"version\": 2}\n)\ntarget_cols = [\"target\", \"target_nomi_20\", \"target_nomi_60\"]\nselected_dataset = TargetSelectionPreProcessor(target_cols=target_cols).transform(\n    dataset\n)\nassert selected_dataset.get_target_data.shape[1] == len(target_cols)\nselected_dataset.head(2)";
                var nbb_formatted_code = "dataset = create_numerframe(\n    \"test_assets/mini_numerai_version_2_data.parquet\", metadata={\"version\": 2}\n)\ntarget_cols = [\"target\", \"target_nomi_20\", \"target_nomi_60\"]\nselected_dataset = TargetSelectionPreProcessor(target_cols=target_cols).transform(\n    dataset\n)\nassert selected_dataset.get_target_data.shape[1] == len(target_cols)\nselected_dataset.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.0.4.-ReduceMemoryProcessor">1.0.4. ReduceMemoryProcessor<a class="anchor-link" href="#1.0.4.-ReduceMemoryProcessor"> </a></h3><p>Numerai datasets can take up a lot of RAM and may put a strain on your compute environment.</p>
<p>For Numerai Classic, many of the feature and target columns can be downscaled to <code>float16</code>. <code>int8</code> if you are using the Numerai int8 datasets. For Signals it depends on the features you are generating.</p>
<p><a href="/numerbloxpreprocessing.html#ReduceMemoryProcessor"><code>ReduceMemoryProcessor</code></a> downscales the type of your numeric columns to reduce the memory footprint as much as possible.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ReduceMemoryProcessor" class="doc_header"><code>class</code> <code>ReduceMemoryProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L124" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ReduceMemoryProcessor</code>(<strong><code>deep_mem_inspect</code></strong>=<em><code>False</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Reduce memory usage as much as possible.</p>
<p>Credits to kainsama and others for writing about memory usage reduction for Numerai data:
<a href="https://forum.numer.ai/t/reducing-memory/313">https://forum.numer.ai/t/reducing-memory/313</a></p>
<p>:param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.
Yields a more accurate representation of memory usage if you have complex object columns.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="6eb6495e-ed97-40a6-8e99-e47df9712087"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#6eb6495e-ed97-40a6-8e99-e47df9712087');

            setTimeout(function() {
                var nbb_cell_id = 15;
                var nbb_unformatted_code = "# export\nclass ReduceMemoryProcessor(BaseProcessor):\n    \"\"\"\n    Reduce memory usage as much as possible.\n\n    Credits to kainsama and others for writing about memory usage reduction for Numerai data:\n    https://forum.numer.ai/t/reducing-memory/313\n\n    :param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.\n    Yields a more accurate representation of memory usage if you have complex object columns.\n    \"\"\"\n    def __init__(self, deep_mem_inspect = False):\n        super().__init__()\n        self.deep_mem_inspect = deep_mem_inspect\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        dataf = self._reduce_mem_usage(dataf)\n        return NumerFrame(dataf)\n\n    def _reduce_mem_usage(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"\n        Iterate through all columns and modify the numeric column types\n        to reduce memory usage.\n        \"\"\"\n        start_memory_usage = dataf.memory_usage(deep=self.deep_mem_inspect).sum() / 1024**2\n        rich_print(f\"Memory usage of DataFrame is [bold]{round(start_memory_usage, 2)} MB[/bold]\")\n\n        for col in dataf.columns:\n            col_type = dataf[col].dtype.name\n\n            if col_type not in ['object', 'category', 'datetime64[ns, UTC]','datetime64[ns]']:\n                c_min = dataf[col].min()\n                c_max = dataf[col].max()\n                if str(col_type)[:3] == 'int':\n                    if c_min > np.iinfo(np.int8).min and c_max < np.iinfo(np.int8).max:\n                        dataf[col] = dataf[col].astype(np.int16)\n                    elif c_min > np.iinfo(np.int16).min and c_max < np.iinfo(np.int16).max:\n                        dataf[col] = dataf[col].astype(np.int16)\n                    elif c_min > np.iinfo(np.int32).min and c_max < np.iinfo(np.int32).max:\n                        dataf[col] = dataf[col].astype(np.int32)\n                    elif c_min > np.iinfo(np.int64).min and c_max < np.iinfo(np.int64).max:\n                        dataf[col] = dataf[col].astype(np.int64)\n                else:\n                    if c_min > np.finfo(np.float16).min and c_max < np.finfo(np.float16).max:\n                        dataf[col] = dataf[col].astype(np.float16)\n                    elif c_min > np.finfo(np.float32).min and c_max < np.finfo(np.float32).max:\n                        dataf[col] = dataf[col].astype(np.float32)\n                    else:\n                        dataf[col] = dataf[col].astype(np.float64)\n\n        end_memory_usage = dataf.memory_usage(deep=self.deep_mem_inspect).sum() / 1024**2\n        rich_print(f\"Memory usage after optimization is: [bold]{round(end_memory_usage, 2)} MB[/bold]\")\n        rich_print(f\"[green] Usage decreased by [bold]{round(100 * (start_memory_usage - end_memory_usage) / start_memory_usage, 2)}%[/bold][/green]\")\n        return dataf";
                var nbb_formatted_code = "# export\nclass ReduceMemoryProcessor(BaseProcessor):\n    \"\"\"\n    Reduce memory usage as much as possible.\n\n    Credits to kainsama and others for writing about memory usage reduction for Numerai data:\n    https://forum.numer.ai/t/reducing-memory/313\n\n    :param deep_mem_inspect: Introspect the data deeply by interrogating object dtypes.\n    Yields a more accurate representation of memory usage if you have complex object columns.\n    \"\"\"\n\n    def __init__(self, deep_mem_inspect=False):\n        super().__init__()\n        self.deep_mem_inspect = deep_mem_inspect\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        dataf = self._reduce_mem_usage(dataf)\n        return NumerFrame(dataf)\n\n    def _reduce_mem_usage(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"\n        Iterate through all columns and modify the numeric column types\n        to reduce memory usage.\n        \"\"\"\n        start_memory_usage = (\n            dataf.memory_usage(deep=self.deep_mem_inspect).sum() / 1024 ** 2\n        )\n        rich_print(\n            f\"Memory usage of DataFrame is [bold]{round(start_memory_usage, 2)} MB[/bold]\"\n        )\n\n        for col in dataf.columns:\n            col_type = dataf[col].dtype.name\n\n            if col_type not in [\n                \"object\",\n                \"category\",\n                \"datetime64[ns, UTC]\",\n                \"datetime64[ns]\",\n            ]:\n                c_min = dataf[col].min()\n                c_max = dataf[col].max()\n                if str(col_type)[:3] == \"int\":\n                    if c_min > np.iinfo(np.int8).min and c_max < np.iinfo(np.int8).max:\n                        dataf[col] = dataf[col].astype(np.int16)\n                    elif (\n                        c_min > np.iinfo(np.int16).min\n                        and c_max < np.iinfo(np.int16).max\n                    ):\n                        dataf[col] = dataf[col].astype(np.int16)\n                    elif (\n                        c_min > np.iinfo(np.int32).min\n                        and c_max < np.iinfo(np.int32).max\n                    ):\n                        dataf[col] = dataf[col].astype(np.int32)\n                    elif (\n                        c_min > np.iinfo(np.int64).min\n                        and c_max < np.iinfo(np.int64).max\n                    ):\n                        dataf[col] = dataf[col].astype(np.int64)\n                else:\n                    if (\n                        c_min > np.finfo(np.float16).min\n                        and c_max < np.finfo(np.float16).max\n                    ):\n                        dataf[col] = dataf[col].astype(np.float16)\n                    elif (\n                        c_min > np.finfo(np.float32).min\n                        and c_max < np.finfo(np.float32).max\n                    ):\n                        dataf[col] = dataf[col].astype(np.float32)\n                    else:\n                        dataf[col] = dataf[col].astype(np.float64)\n\n        end_memory_usage = (\n            dataf.memory_usage(deep=self.deep_mem_inspect).sum() / 1024 ** 2\n        )\n        rich_print(\n            f\"Memory usage after optimization is: [bold]{round(end_memory_usage, 2)} MB[/bold]\"\n        )\n        rich_print(\n            f\"[green] Usage decreased by [bold]{round(100 * (start_memory_usage - end_memory_usage) / start_memory_usage, 2)}%[/bold][/green]\"\n        )\n        return dataf";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataf</span> <span class="o">=</span> <span class="n">create_numerframe</span><span class="p">(</span><span class="s2">&quot;test_assets/mini_numerai_version_2_data.parquet&quot;</span><span class="p">)</span>
<span class="n">rmp</span> <span class="o">=</span> <span class="n">ReduceMemoryProcessor</span><span class="p">()</span>
<span class="n">dataf</span> <span class="o">=</span> <span class="n">rmp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Memory usage of DataFrame is <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04</span><span style="font-weight: bold"> MB</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Memory usage after optimization is: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.02</span><span style="font-weight: bold"> MB</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000"> Usage decreased by </span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">49.72</span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">%</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">ReduceMemoryProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1073</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">955320</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="8892f5cd-9e47-4697-ae0e-6d4787c5ae2b"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8892f5cd-9e47-4697-ae0e-6d4787c5ae2b');

            setTimeout(function() {
                var nbb_cell_id = 16;
                var nbb_unformatted_code = "dataf = create_numerframe(\"test_assets/mini_numerai_version_2_data.parquet\")\nrmp = ReduceMemoryProcessor()\ndataf = rmp.transform(dataf)";
                var nbb_formatted_code = "dataf = create_numerframe(\"test_assets/mini_numerai_version_2_data.parquet\")\nrmp = ReduceMemoryProcessor()\ndataf = rmp.transform(dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.0.5.-SyntheticDataGenerator">1.0.5. SyntheticDataGenerator<a class="anchor-link" href="#1.0.5.-SyntheticDataGenerator"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://sdv.dev">SDV (Synthetic Data Vault)</a> is a library to easily use generative models on tabular data. This object allows you to generate and add synthetic eras of data to the <a href="/numerbloxnumerframe.html#NumerFrame"><code>NumerFrame</code></a>.</p>
<p>Currently supported models are: <a href="https://sdv.dev/SDV/user_guides/single_table/gaussian_copula.html">GaussianCopula</a>, <a href="https://sdv.dev/SDV/user_guides/single_table/ctgan.html">CTGAN</a> <a href="https://sdv.dev/SDV/user_guides/single_table/copulagan.html">CopulaGAN</a> and <a href="https://sdv.dev/SDV/user_guides/single_table/tvae.html">TVAE</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SyntheticDataGenerator" class="doc_header"><code>class</code> <code>SyntheticDataGenerator</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L180" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SyntheticDataGenerator</code>(<strong><code>model_path</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>=<em><code>'CTGAN'</code></em>, <strong><code>rows_per_era</code></strong>:<code>int</code>=<em><code>5400</code></em>, <strong><code>eras_to_add</code></strong>:<code>int</code>=<em><code>1</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Generate synthetic eras. Uses SDV (sdv.dev) under the hood.</p>
<p>:param model_name: Exact class name of a model supported on sdv.</p>
<p>:param model_path: Either:</p>
<ol>
<li><p>Path to trained model.</p>
</li>
<li><p>Path to where you want to save the fitted model.</p>
</li>
</ol>
<p>If model_path does not point to a valid file, a new model will be initialized, fitted and saved.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="574d637c-014d-4f25-8539-5fb3f96a26bf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#574d637c-014d-4f25-8539-5fb3f96a26bf');

            setTimeout(function() {
                var nbb_cell_id = 18;
                var nbb_unformatted_code = "# export\nclass SyntheticDataGenerator(BaseProcessor):\n    \"\"\"\n    Generate synthetic eras. Uses SDV (sdv.dev) under the hood.\n\n    :param model_name: Exact class name of a model supported on sdv. \\n\n    :param model_path: Either: \\n\n    1. Path to trained model. \\n\n    2. Path to where you want to save the fitted model. \\n\n    If model_path does not point to a valid file, a new model will be initialized, fitted and saved.\n    \"\"\"\n    SUPPORTED_MODELS = [\"GaussianCopula\", \"CTGAN\", \"CopulaGAN\", \"TVAE\"]\n    def __init__(self, model_path: str,\n                 model_name = \"CTGAN\",\n                 rows_per_era: int = 5400,\n                 eras_to_add: int = 1):\n        super().__init__()\n        self.model_name = model_name\n        assert self.model_name in self.SUPPORTED_MODELS,\\\n            f\"Only models '{self.SUPPORTED_MODELS}' are supported. Got '{self.model_name}'.\"\n        self.model_path = Path(model_path)\n        self.rows_per_era = rows_per_era\n        self.eras_to_add = eras_to_add\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        model = self.prepare_model(dataf=dataf)\n        synth_datafs = []\n        for era_n in tqdm(range(self.eras_to_add), desc=\"Generating synthetic eras\"):\n            synth_era_data = self.get_synthetic_batch(model=model)\n            synth_era_data.loc[:, dataf.meta.era_col] = f\"synth_{str(era_n).zfill(4)}\"\n            synth_datafs.append(synth_era_data)\n\n        synth_dataf = pd.concat(synth_datafs)\n        dataf = pd.concat([dataf, synth_dataf])\n        return NumerFrame(dataf)\n\n    def prepare_model(self, dataf: Union[pd.DataFrame, NumerFrame]):\n        if self.model_path.is_file():\n            rich_print(f\"Loading '{self.model_name}' model from '{self.model_path}'.\")\n            model = getattr(sdv.tabular, self.model_name).load(self.model_path)\n        else:\n            rich_print(f\":warning: Model path '{self.model_path}' does not point to a file. Initializing, fitting and saving new model. :warning:\")\n            model = getattr(sdv.tabular, self.model_name)()\n            model.fit(dataf)\n            model.save(self.model_path)\n        return model\n\n    def get_synthetic_batch(self, model) -> pd.DataFrame:\n        synthetic_dataf = model.sample(num_rows=self.rows_per_era)\n        return synthetic_dataf";
                var nbb_formatted_code = "# export\nclass SyntheticDataGenerator(BaseProcessor):\n    \"\"\"\n    Generate synthetic eras. Uses SDV (sdv.dev) under the hood.\n\n    :param model_name: Exact class name of a model supported on sdv. \\n\n    :param model_path: Either: \\n\n    1. Path to trained model. \\n\n    2. Path to where you want to save the fitted model. \\n\n    If model_path does not point to a valid file, a new model will be initialized, fitted and saved.\n    \"\"\"\n\n    SUPPORTED_MODELS = [\"GaussianCopula\", \"CTGAN\", \"CopulaGAN\", \"TVAE\"]\n\n    def __init__(\n        self,\n        model_path: str,\n        model_name=\"CTGAN\",\n        rows_per_era: int = 5400,\n        eras_to_add: int = 1,\n    ):\n        super().__init__()\n        self.model_name = model_name\n        assert (\n            self.model_name in self.SUPPORTED_MODELS\n        ), f\"Only models '{self.SUPPORTED_MODELS}' are supported. Got '{self.model_name}'.\"\n        self.model_path = Path(model_path)\n        self.rows_per_era = rows_per_era\n        self.eras_to_add = eras_to_add\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        model = self.prepare_model(dataf=dataf)\n        synth_datafs = []\n        for era_n in tqdm(range(self.eras_to_add), desc=\"Generating synthetic eras\"):\n            synth_era_data = self.get_synthetic_batch(model=model)\n            synth_era_data.loc[:, dataf.meta.era_col] = f\"synth_{str(era_n).zfill(4)}\"\n            synth_datafs.append(synth_era_data)\n\n        synth_dataf = pd.concat(synth_datafs)\n        dataf = pd.concat([dataf, synth_dataf])\n        return NumerFrame(dataf)\n\n    def prepare_model(self, dataf: Union[pd.DataFrame, NumerFrame]):\n        if self.model_path.is_file():\n            rich_print(f\"Loading '{self.model_name}' model from '{self.model_path}'.\")\n            model = getattr(sdv.tabular, self.model_name).load(self.model_path)\n        else:\n            rich_print(\n                f\":warning: Model path '{self.model_path}' does not point to a file. Initializing, fitting and saving new model. :warning:\"\n            )\n            model = getattr(sdv.tabular, self.model_name)()\n            model.fit(dataf)\n            model.save(self.model_path)\n        return model\n\n    def get_synthetic_batch(self, model) -> pd.DataFrame:\n        synthetic_dataf = model.sample(num_rows=self.rows_per_era)\n        return synthetic_dataf";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">val_dataf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>era</th>
      <th>data_type</th>
      <th>feature_dichasial_hammier_spawner</th>
      <th>feature_rheumy_epistemic_prancer</th>
      <th>feature_pert_performative_hormuz</th>
      <th>feature_hillier_unpitied_theobromine</th>
      <th>feature_perigean_bewitching_thruster</th>
      <th>feature_renegade_undomestic_milord</th>
      <th>feature_koranic_rude_corf</th>
      <th>feature_demisable_expiring_millepede</th>
      <th>...</th>
      <th>target_paul_20</th>
      <th>target_paul_60</th>
      <th>target_george_20</th>
      <th>target_george_60</th>
      <th>target_william_20</th>
      <th>target_william_60</th>
      <th>target_arthur_20</th>
      <th>target_arthur_60</th>
      <th>target_thomas_20</th>
      <th>target_thomas_60</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n000777698096000</th>
      <td>0857</td>
      <td>validation</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.166667</td>
      <td>0.500000</td>
      <td>0.166667</td>
      <td>0.500000</td>
      <td>0.166667</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>n0009793a3b91c27</th>
      <td>0857</td>
      <td>validation</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>...</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.666667</td>
      <td>0.833333</td>
      <td>0.666667</td>
      <td>0.833333</td>
      <td>0.500000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>n00099ccd6698ab0</th>
      <td>0857</td>
      <td>validation</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>0.75</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>...</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.166667</td>
      <td>0.333333</td>
      <td>0.166667</td>
      <td>0.333333</td>
      <td>0.166667</td>
      <td>0.166667</td>
    </tr>
    <tr>
      <th>n0019e36bbb8702b</th>
      <td>0857</td>
      <td>validation</td>
      <td>0.50</td>
      <td>1.00</td>
      <td>0.25</td>
      <td>0.75</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>...</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.666667</td>
      <td>0.500000</td>
      <td>0.666667</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>n0028cb874439df8</th>
      <td>0857</td>
      <td>validation</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>1.00</td>
      <td>0.50</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>0.25</td>
      <td>0.50</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.333333</td>
      <td>0.500000</td>
      <td>0.333333</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.666667</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1073 columns</p>
</div>
</div>

</div>

<div class="output_area">




<div id="25226465-bd81-4cfb-b3b0-346cebb30734"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#25226465-bd81-4cfb-b3b0-346cebb30734');

            setTimeout(function() {
                var nbb_cell_id = 20;
                var nbb_unformatted_code = "val_dataf.head()";
                var nbb_formatted_code = "val_dataf.head()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with 5 features and main target. All synthetic eras will have the prefix <code>synth_</code> in the <code>era</code> column.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_df</span> <span class="o">=</span> <span class="n">val_dataf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100</span><span class="p">)[[</span><span class="s1">&#39;feature_dichasial_hammier_spawner&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;feature_rheumy_epistemic_prancer&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;feature_pert_performative_hormuz&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;feature_hillier_unpitied_theobromine&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;feature_perigean_bewitching_thruster&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;era&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="054e0560-c028-4659-89e0-af2f668207c3"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#054e0560-c028-4659-89e0-af2f668207c3');

            setTimeout(function() {
                var nbb_cell_id = 22;
                var nbb_unformatted_code = "sample_df = val_dataf.sample(100)[['feature_dichasial_hammier_spawner',\n                                   'feature_rheumy_epistemic_prancer',\n                                   'feature_pert_performative_hormuz',\n                                   'feature_hillier_unpitied_theobromine',\n                                   'feature_perigean_bewitching_thruster',\n                                   'era', 'target']]";
                var nbb_formatted_code = "sample_df = val_dataf.sample(100)[\n    [\n        \"feature_dichasial_hammier_spawner\",\n        \"feature_rheumy_epistemic_prancer\",\n        \"feature_pert_performative_hormuz\",\n        \"feature_hillier_unpitied_theobromine\",\n        \"feature_perigean_bewitching_thruster\",\n        \"era\",\n        \"target\",\n    ]\n]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Testing with trained dummy CTGAN model in <code>test_assets</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sdg</span> <span class="o">=</span> <span class="n">SyntheticDataGenerator</span><span class="p">(</span><span class="s2">&quot;test_assets/test_ctgan.pkl&quot;</span><span class="p">,</span> <span class="n">eras_to_add</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sdg</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataf</span><span class="o">=</span><span class="n">sample_df</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Loading <span style="color: #008000; text-decoration-color: #008000">'CTGAN'</span> model from <span style="color: #008000; text-decoration-color: #008000">'test_assets/test_ctgan.pkl'</span>.
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">SyntheticDataGenerator</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">989319</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_dichasial_hammier_spawner</th>
      <th>feature_rheumy_epistemic_prancer</th>
      <th>feature_pert_performative_hormuz</th>
      <th>feature_hillier_unpitied_theobromine</th>
      <th>feature_perigean_bewitching_thruster</th>
      <th>era</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5395</th>
      <td>0.00</td>
      <td>0.22</td>
      <td>0.46</td>
      <td>0.32</td>
      <td>1.00</td>
      <td>synth_0002</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>5396</th>
      <td>0.00</td>
      <td>0.08</td>
      <td>0.74</td>
      <td>0.06</td>
      <td>0.62</td>
      <td>synth_0002</td>
      <td>0.76</td>
    </tr>
    <tr>
      <th>5397</th>
      <td>0.45</td>
      <td>0.72</td>
      <td>0.23</td>
      <td>1.00</td>
      <td>0.43</td>
      <td>synth_0002</td>
      <td>0.61</td>
    </tr>
    <tr>
      <th>5398</th>
      <td>0.00</td>
      <td>0.33</td>
      <td>0.00</td>
      <td>0.06</td>
      <td>0.17</td>
      <td>synth_0002</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>5399</th>
      <td>0.46</td>
      <td>0.43</td>
      <td>0.82</td>
      <td>0.05</td>
      <td>0.54</td>
      <td>synth_0002</td>
      <td>0.55</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="6ff1af8d-c3c4-48fe-94b8-f6037b232a75"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#6ff1af8d-c3c4-48fe-94b8-f6037b232a75');

            setTimeout(function() {
                var nbb_cell_id = 23;
                var nbb_unformatted_code = "sdg = SyntheticDataGenerator(\"test_assets/test_ctgan.pkl\", eras_to_add=3)\nsdg.transform(dataf=sample_df).tail()";
                var nbb_formatted_code = "sdg = SyntheticDataGenerator(\"test_assets/test_ctgan.pkl\", eras_to_add=3)\nsdg.transform(dataf=sample_df).tail()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.1.-Numerai-Classic">1.1. Numerai Classic<a class="anchor-link" href="#1.1.-Numerai-Classic"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Numerai Classic dataset has a certain structure that you may not encounter in the Numerai Signals tournament.
Therefore, this section has all preprocessors that can only be applied to Numerai Classic.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.1.0-Numerai-Classic:-Version-agnostic">1.1.0 Numerai Classic: Version agnostic<a class="anchor-link" href="#1.1.0-Numerai-Classic:-Version-agnostic"> </a></h3><p>Preprocessors that work for all Numerai Classic versions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.1.0.1.-BayesianGMMTargetProcessor">1.1.0.1. BayesianGMMTargetProcessor<a class="anchor-link" href="#1.1.0.1.-BayesianGMMTargetProcessor"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BayesianGMMTargetProcessor" class="doc_header"><code>class</code> <code>BayesianGMMTargetProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L232" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BayesianGMMTargetProcessor</code>(<strong><code>target_col</code></strong>:<code>str</code>=<em><code>'target'</code></em>, <strong><code>n_components</code></strong>:<code>int</code>=<em><code>6</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Generate synthetic (fake) target using a Bayesian Gaussian Mixture model.</p>
<p>Based on Michael Oliver's GitHub Gist implementation:</p>
<p><a href="https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93">https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93</a></p>
<p>:param target_col: Column from which to create fake target.</p>
<p>:param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8add66a6-9d91-4072-9f2d-2088f02e3398"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8add66a6-9d91-4072-9f2d-2088f02e3398');

            setTimeout(function() {
                var nbb_cell_id = 24;
                var nbb_unformatted_code = "# export\nclass BayesianGMMTargetProcessor(BaseProcessor):\n    \"\"\"\n    Generate synthetic (fake) target using a Bayesian Gaussian Mixture model. \\n\n    Based on Michael Oliver's GitHub Gist implementation: \\n\n    https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93\n\n    :param target_col: Column from which to create fake target. \\n\n    :param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.\n    \"\"\"\n    def __init__(self, target_col: str = \"target\", n_components: int = 6):\n        super().__init__()\n        self.target_col = target_col\n        self.n_components = n_components\n        self.ridge = Ridge(fit_intercept=False)\n        self.bins = [0, 0.05, 0.25, 0.75, 0.95, 1]\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame, *args, **kwargs) -> NumerFrame:\n        all_eras = dataf[dataf.meta.era_col].unique()\n        coefs = self._get_coefs(dataf=dataf, all_eras=all_eras)\n        bgmm = self._fit_bgmm(coefs=coefs)\n        fake_target = self._generate_target(dataf=dataf,\n                                            bgmm=bgmm,\n                                            all_eras=all_eras)\n        dataf[f\"fake_{self.target_col}\"] = fake_target\n        return NumerFrame(dataf)\n\n    def _get_coefs(self, dataf: NumerFrame, all_eras: list) -> np.ndarray:\n        \"\"\"\n        Generate coefficients for BGMM.\n        Data should already be scaled between 0 and 1\n        (Already done with Numerai Classic data)\n        \"\"\"\n        coefs = []\n        for era in all_eras:\n            features, target = self.__get_features_target(dataf=dataf, era=era)\n            self.ridge.fit(features, target)\n            coefs.append(self.ridge.coef_)\n        stacked_coefs = np.vstack(coefs)\n        return stacked_coefs\n\n    def _fit_bgmm(self, coefs: np.ndarray) -> BayesianGaussianMixture:\n        \"\"\"\n        Fit Bayesian Gaussian Mixture model on coefficients and normalize.\n        \"\"\"\n        bggm = BayesianGaussianMixture(n_components=self.n_components)\n        bggm.fit(coefs)\n        # make probability of sampling each component equal to better balance rare regimes\n        bggm.weights_[:] = 1 / self.n_components\n        return bggm\n\n    def _generate_target(self, dataf: NumerFrame,\n                         bgmm: BayesianGaussianMixture,\n                         all_eras: list) -> np.ndarray:\n        \"\"\" Generate fake target using Bayesian Gaussian Mixture model. \"\"\"\n        fake_target = []\n        for era in tqdm(all_eras, desc=\"Generating fake target\"):\n            features, _ = self.__get_features_target(dataf=dataf, era=era)\n            # Sample a set of weights from GMM\n            beta, _ = bgmm.sample(1)\n            # Create fake continuous target\n            fake_targ = features @ beta[0]\n            # Bin fake target like real target\n            fake_targ = (rankdata(fake_targ) - .5) / len(fake_targ)\n            fake_targ = (np.digitize(fake_targ, self.bins) - 1) / 4\n            fake_target.append(fake_targ)\n        return np.concatenate(fake_target)\n\n    def __get_features_target(self, dataf: NumerFrame, era) -> tuple:\n        \"\"\" Get features and target for one era and center data. \"\"\"\n        sub_df = dataf[dataf.era == era]\n        features = sub_df.get_feature_data\n        target = sub_df[self.target_col]\n        features = features.values - .5\n        target = target.values - .5\n        return features, target";
                var nbb_formatted_code = "# export\nclass BayesianGMMTargetProcessor(BaseProcessor):\n    \"\"\"\n    Generate synthetic (fake) target using a Bayesian Gaussian Mixture model. \\n\n    Based on Michael Oliver's GitHub Gist implementation: \\n\n    https://gist.github.com/the-moliver/dcdd2862dc2c78dda600f1b449071c93\n\n    :param target_col: Column from which to create fake target. \\n\n    :param n_components: Number of components for fitting Bayesian Gaussian Mixture Model.\n    \"\"\"\n\n    def __init__(self, target_col: str = \"target\", n_components: int = 6):\n        super().__init__()\n        self.target_col = target_col\n        self.n_components = n_components\n        self.ridge = Ridge(fit_intercept=False)\n        self.bins = [0, 0.05, 0.25, 0.75, 0.95, 1]\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame, *args, **kwargs) -> NumerFrame:\n        all_eras = dataf[dataf.meta.era_col].unique()\n        coefs = self._get_coefs(dataf=dataf, all_eras=all_eras)\n        bgmm = self._fit_bgmm(coefs=coefs)\n        fake_target = self._generate_target(dataf=dataf, bgmm=bgmm, all_eras=all_eras)\n        dataf[f\"fake_{self.target_col}\"] = fake_target\n        return NumerFrame(dataf)\n\n    def _get_coefs(self, dataf: NumerFrame, all_eras: list) -> np.ndarray:\n        \"\"\"\n        Generate coefficients for BGMM.\n        Data should already be scaled between 0 and 1\n        (Already done with Numerai Classic data)\n        \"\"\"\n        coefs = []\n        for era in all_eras:\n            features, target = self.__get_features_target(dataf=dataf, era=era)\n            self.ridge.fit(features, target)\n            coefs.append(self.ridge.coef_)\n        stacked_coefs = np.vstack(coefs)\n        return stacked_coefs\n\n    def _fit_bgmm(self, coefs: np.ndarray) -> BayesianGaussianMixture:\n        \"\"\"\n        Fit Bayesian Gaussian Mixture model on coefficients and normalize.\n        \"\"\"\n        bggm = BayesianGaussianMixture(n_components=self.n_components)\n        bggm.fit(coefs)\n        # make probability of sampling each component equal to better balance rare regimes\n        bggm.weights_[:] = 1 / self.n_components\n        return bggm\n\n    def _generate_target(\n        self, dataf: NumerFrame, bgmm: BayesianGaussianMixture, all_eras: list\n    ) -> np.ndarray:\n        \"\"\"Generate fake target using Bayesian Gaussian Mixture model.\"\"\"\n        fake_target = []\n        for era in tqdm(all_eras, desc=\"Generating fake target\"):\n            features, _ = self.__get_features_target(dataf=dataf, era=era)\n            # Sample a set of weights from GMM\n            beta, _ = bgmm.sample(1)\n            # Create fake continuous target\n            fake_targ = features @ beta[0]\n            # Bin fake target like real target\n            fake_targ = (rankdata(fake_targ) - 0.5) / len(fake_targ)\n            fake_targ = (np.digitize(fake_targ, self.bins) - 1) / 4\n            fake_target.append(fake_targ)\n        return np.concatenate(fake_target)\n\n    def __get_features_target(self, dataf: NumerFrame, era) -> tuple:\n        \"\"\"Get features and target for one era and center data.\"\"\"\n        sub_df = dataf[dataf.era == era]\n        features = sub_df.get_feature_data\n        target = sub_df[self.target_col]\n        features = features.values - 0.5\n        target = target.values - 0.5\n        return features, target";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bgmm</span> <span class="o">=</span> <span class="n">BayesianGMMTargetProcessor</span><span class="p">()</span>
<span class="n">val_dataf</span> <span class="o">=</span> <span class="n">bgmm</span><span class="p">(</span><span class="n">val_dataf</span><span class="p">)</span>
<span class="n">val_dataf</span><span class="p">[[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;fake_target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">BayesianGMMTargetProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">539658</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1074</span><span style="font-weight: bold">)</span>. Time taken for 
step: <span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:03:47</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">201264</span>. ✅
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>fake_target</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n000777698096000</th>
      <td>0.25</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>n0009793a3b91c27</th>
      <td>0.50</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>n00099ccd6698ab0</th>
      <td>0.00</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="bf34effe-d8fe-4ed3-ae02-762449990ff5"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#bf34effe-d8fe-4ed3-ae02-762449990ff5');

            setTimeout(function() {
                var nbb_cell_id = 25;
                var nbb_unformatted_code = "bgmm = BayesianGMMTargetProcessor()\nval_dataf = bgmm(val_dataf)\nval_dataf[['target', 'fake_target']].head(3)";
                var nbb_formatted_code = "bgmm = BayesianGMMTargetProcessor()\nval_dataf = bgmm(val_dataf)\nval_dataf[[\"target\", \"fake_target\"]].head(3)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.1.1.-Numerai-Classic:-Version-1-specific">1.1.1. Numerai Classic: Version 1 specific<a class="anchor-link" href="#1.1.1.-Numerai-Classic:-Version-1-specific"> </a></h3><p>Preprocessors that only work for version 1 (legacy data).
When using version 1 preprocessor it is recommended that the input <a href="/numerbloxnumerframe.html#NumerFrame"><code>NumerFrame</code></a> has <code>version</code> in its metadata.
This avoids using version 1 preprocessors on version 2 data and encountering confusing error messages.</p>
<p>As a new user we recommend to start modeling the version 2 data and avoid version 1.
The preprocessors below are only there for legacy and compatibility reasons.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1.1.1.1.-GroupStatsPreProcessor">1.1.1.1. GroupStatsPreProcessor<a class="anchor-link" href="#1.1.1.1.-GroupStatsPreProcessor"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The version 1 legacy data has 6 groups of features which allows us to calculate aggregate features.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GroupStatsPreProcessor" class="doc_header"><code>class</code> <code>GroupStatsPreProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L311" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GroupStatsPreProcessor</code>(<strong><code>groups</code></strong>:<code>list</code>=<em><code>None</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>WARNING: Only supported for Version 1 (legacy) data.</p>
<p>Calculate group statistics for all data groups.</p>
<p>| :param groups: Groups to create features for. All groups by default.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="10b981a8-ece0-4a21-a0af-3d7e6cdde795"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#10b981a8-ece0-4a21-a0af-3d7e6cdde795');

            setTimeout(function() {
                var nbb_cell_id = 27;
                var nbb_unformatted_code = "# export\nclass GroupStatsPreProcessor(BaseProcessor):\n    \"\"\"\n    WARNING: Only supported for Version 1 (legacy) data. \\n\n    Calculate group statistics for all data groups. \\n\n    | :param groups: Groups to create features for. All groups by default.\n    \"\"\"\n\n    def __init__(self, groups: list = None):\n        super().__init__()\n        self.all_groups = [\n            \"intelligence\",\n            \"wisdom\",\n            \"charisma\",\n            \"dexterity\",\n            \"strength\",\n            \"constitution\",\n        ]\n        self.group_names = groups if groups else self.all_groups\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame, *args, **kwargs) -> NumerFrame:\n        \"\"\"Check validity and add group features.\"\"\"\n        self._check_data_validity(dataf=dataf)\n        dataf = dataf.pipe(self._add_group_features)\n        return NumerFrame(dataf)\n\n    def _add_group_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"Mean, standard deviation and skew for each group.\"\"\"\n        for group in self.group_names:\n            cols = [col for col in dataf.columns if group in col]\n            dataf[f\"feature_{group}_mean\"] = dataf[cols].mean(axis=1)\n            dataf[f\"feature_{group}_std\"] = dataf[cols].std(axis=1)\n            dataf[f\"feature_{group}_skew\"] = dataf[cols].skew(axis=1)\n        return dataf\n\n    def _check_data_validity(self, dataf: NumerFrame):\n        \"\"\"Make sure this is only used for version 1 data.\"\"\"\n        assert hasattr(\n            dataf.meta, \"version\"\n        ), f\"Version should be specified for '{self.__class__.__name__}' This Preprocessor will only work on version 1 data.\"\n        assert (\n            getattr(dataf.meta, \"version\") == 1\n        ), f\"'{self.__class__.__name__}' only works on version 1 data. Got version: '{getattr(dataf.meta, 'version')}'.\"";
                var nbb_formatted_code = "# export\nclass GroupStatsPreProcessor(BaseProcessor):\n    \"\"\"\n    WARNING: Only supported for Version 1 (legacy) data. \\n\n    Calculate group statistics for all data groups. \\n\n    | :param groups: Groups to create features for. All groups by default.\n    \"\"\"\n\n    def __init__(self, groups: list = None):\n        super().__init__()\n        self.all_groups = [\n            \"intelligence\",\n            \"wisdom\",\n            \"charisma\",\n            \"dexterity\",\n            \"strength\",\n            \"constitution\",\n        ]\n        self.group_names = groups if groups else self.all_groups\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame, *args, **kwargs) -> NumerFrame:\n        \"\"\"Check validity and add group features.\"\"\"\n        self._check_data_validity(dataf=dataf)\n        dataf = dataf.pipe(self._add_group_features)\n        return NumerFrame(dataf)\n\n    def _add_group_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"Mean, standard deviation and skew for each group.\"\"\"\n        for group in self.group_names:\n            cols = [col for col in dataf.columns if group in col]\n            dataf[f\"feature_{group}_mean\"] = dataf[cols].mean(axis=1)\n            dataf[f\"feature_{group}_std\"] = dataf[cols].std(axis=1)\n            dataf[f\"feature_{group}_skew\"] = dataf[cols].skew(axis=1)\n        return dataf\n\n    def _check_data_validity(self, dataf: NumerFrame):\n        \"\"\"Make sure this is only used for version 1 data.\"\"\"\n        assert hasattr(\n            dataf.meta, \"version\"\n        ), f\"Version should be specified for '{self.__class__.__name__}' This Preprocessor will only work on version 1 data.\"\n        assert (\n            getattr(dataf.meta, \"version\") == 1\n        ), f\"'{self.__class__.__name__}' only works on version 1 data. Got version: '{getattr(dataf.meta, 'version')}'.\"";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataf</span> <span class="o">=</span> <span class="n">create_numerframe</span><span class="p">(</span>
    <span class="s2">&quot;test_assets/mini_numerai_version_1_data.csv&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">group_features_dataf</span> <span class="o">=</span> <span class="n">GroupStatsPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
<span class="n">group_features_dataf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">group_features_dataf</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">GroupStatsPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">332</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:00</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">042279</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="5d6ec021-31dd-4b4d-a0e9-64c8e0c37878"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#5d6ec021-31dd-4b4d-a0e9-64c8e0c37878');

            setTimeout(function() {
                var nbb_cell_id = 28;
                var nbb_unformatted_code = "dataf = create_numerframe(\n    \"test_assets/mini_numerai_version_1_data.csv\", metadata={\"version\": 1}\n)\ngroup_features_dataf = GroupStatsPreProcessor().transform(dataf)\ngroup_features_dataf.head(2)\nassert group_features_dataf.meta.version == 1";
                var nbb_formatted_code = "dataf = create_numerframe(\n    \"test_assets/mini_numerai_version_1_data.csv\", metadata={\"version\": 1}\n)\ngroup_features_dataf = GroupStatsPreProcessor().transform(dataf)\ngroup_features_dataf.head(2)\nassert group_features_dataf.meta.version == 1";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/numerbloxpreprocessing.html#GroupStatsPreProcessor"><code>GroupStatsPreProcessor</code></a> should break if <code>version != 1</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.1.2.-Numerai-Classic:-Version-2-specific">1.1.2. Numerai Classic: Version 2 specific<a class="anchor-link" href="#1.1.2.-Numerai-Classic:-Version-2-specific"> </a></h3><p>Preprocessors that are only compatible with version 2 data. If the preprocessor is agnostic to Numerai Classic version implement under heading 1.1.0.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># No version 2 specific Numerai Classic preprocessors implemented yet.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8de0a6ef-d1d9-4b54-9546-6f90f0e6ef0a"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8de0a6ef-d1d9-4b54-9546-6f90f0e6ef0a');

            setTimeout(function() {
                var nbb_cell_id = 31;
                var nbb_unformatted_code = "# 1.1.2\n# No version 2 specific Numerai Classic preprocessors implemented yet.";
                var nbb_formatted_code = "# 1.1.2\n# No version 2 specific Numerai Classic preprocessors implemented yet.";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.2.-Numerai-Signals">1.2. Numerai Signals<a class="anchor-link" href="#1.2.-Numerai-Signals"> </a></h2><p>Preprocessors that are specific to Numerai Signals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.2.1.-TA-Lib-Features-(TalibFeatureGenerator)">1.2.1. TA-Lib Features (TalibFeatureGenerator)<a class="anchor-link" href="#1.2.1.-TA-Lib-Features-(TalibFeatureGenerator)"> </a></h3><p><a href="https://mrjbq7.github.io/ta-lib">TA-Lib</a> is an optimized technical analysis library. It is based on Cython and includes 150+ indicators. We have selected features based on feature importances, SHAP and correlation with the Numerai Signals target. If you want to implement other features check out the <a href="https://mrjbq7.github.io/ta-lib/index.html">TA-Lib documentation</a>.</p>
<p>Installation of TA-Lib is a bit more involved than just a pip install and is an optional dependency for this library. Visit the <a href="https://mrjbq7.github.io/ta-lib/install.html">installation documentation</a> for instructions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TalibFeatureGenerator" class="doc_header"><code>class</code> <code>TalibFeatureGenerator</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L356" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TalibFeatureGenerator</code>(<strong><code>windows</code></strong>:<code>List</code>[<code>int</code>], <strong><code>ticker_col</code></strong>:<code>str</code>=<em><code>'bloomberg_ticker'</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Generate relevant features available in TA-Lib.</p>
<p>More info: <a href="https://mrjbq7.github.io/ta-lib">https://mrjbq7.github.io/ta-lib</a></p>
<p>Input DataFrames for these functions should have the following columns defined:
['open', 'high', 'low', 'close', 'volume']</p>
<p>Make sure that all values are sorted in chronological order (by ticker).</p>
<p>:param windows: List of ranges for window features.
Windows will be applied for all features specified in self.window_features.</p>
<p>:param ticker_col: Which column to groupby for feature generation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="bead2328-4ef0-4053-8d82-c0602ca52c80"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#bead2328-4ef0-4053-8d82-c0602ca52c80');

            setTimeout(function() {
                var nbb_cell_id = 32;
                var nbb_unformatted_code = "# export\nclass TalibFeatureGenerator(BaseProcessor):\n    \"\"\"\n    Generate relevant features available in TA-Lib. \\n\n    More info: https://mrjbq7.github.io/ta-lib \\n\n    Input DataFrames for these functions should have the following columns defined:\n    ['open', 'high', 'low', 'close', 'volume'] \\n\n    Make sure that all values are sorted in chronological order (by ticker). \\n\n    :param windows: List of ranges for window features.\n    Windows will be applied for all features specified in self.window_features. \\n\n    :param ticker_col: Which column to groupby for feature generation.\n    \"\"\"\n\n    def __init__(self, windows: List[int], ticker_col: str = \"bloomberg_ticker\"):\n        self.__check_talib_import()\n        super().__init__()\n\n        self.windows = windows\n        self.ticker_col = ticker_col\n        self.window_features = [\n            \"NATR\",\n            \"ADXR\",\n            \"AROONOSC\",\n            \"DX\",\n            \"MFI\",\n            \"MINUS_DI\",\n            \"MINUS_DM\",\n            \"MOM\",\n            \"ROCP\",\n            \"ROCR100\",\n            \"PLUS_DI\",\n            \"PLUS_DM\",\n            \"BETA\",\n            \"RSI\",\n            \"ULTOSC\",\n            \"TRIX\",\n            \"ADXR\",\n            \"CCI\",\n            \"CMO\",\n            \"WILLR\",\n        ]\n        self.no_window_features = [\"AD\", \"OBV\", \"APO\", \"MACD\", \"PPO\"]\n        self.hlocv_cols = [\"open\", \"high\", \"low\", \"close\", \"volume\"]\n\n    def get_no_window_features(self, dataf: pd.DataFrame):\n        for func in tqdm(self.no_window_features, desc=\"No window features\"):\n            dataf.loc[:, f\"feature_{func}\"] = (\n                dataf.groupby(self.ticker_col)\n                .apply(lambda x: pd.Series(self._no_window(x, func)).bfill())\n                .values.astype(np.float32)\n            )\n        return dataf\n\n    def get_window_features(self, dataf: pd.DataFrame):\n        for win in tqdm(self.windows, position=0, desc=\"Window features\"):\n            for func in tqdm(self.window_features, position=1):\n                dataf.loc[:, f\"feature_{func}_{win}\"] = (\n                    dataf.groupby(self.ticker_col)\n                    .apply(lambda x: pd.Series(self._window(x, func, win)).bfill())\n                    .values.astype(np.float32)\n                )\n        return dataf\n\n    def get_all_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        dataf = self.get_no_window_features(dataf)\n        dataf = self.get_window_features(dataf)\n        return dataf\n\n    def transform(self, dataf: pd.DataFrame, *args, **kwargs) -> NumerFrame:\n        return NumerFrame(self.get_all_features(dataf=dataf))\n\n    def _no_window(self, dataf: pd.DataFrame, func) -> pd.Series:\n        from talib import abstract as tab\n\n        inputs = self.__get_inputs(dataf)\n        if func in [\"MACD\"]:\n            # MACD outputs tuple of 3 elements (value, signal and hist)\n            return tab.Function(func)(inputs[\"close\"])[0]\n        else:\n            return tab.Function(func)(inputs)\n\n    def _window(self, dataf: pd.DataFrame, func, window: int) -> pd.Series:\n        from talib import abstract as tab\n\n        inputs = self.__get_inputs(dataf)\n        if func in [\"ULTOSC\"]:\n            # ULTOSC requires 3 timeperiods as input\n            return tab.Function(func)(\n                inputs[\"high\"],\n                inputs[\"low\"],\n                inputs[\"close\"],\n                timeperiod1=window,\n                timeperiod2=window * 2,\n                timeperiod3=window * 4,\n            )\n        else:\n            return tab.Function(func)(inputs, timeperiod=window)\n\n    def __get_inputs(self, dataf: pd.DataFrame) -> dict:\n        return {col: dataf[col].values.astype(np.float64) for col in self.hlocv_cols}\n\n    @staticmethod\n    def __check_talib_import():\n        try:\n            from talib import abstract as tab\n        except ImportError:\n            raise ImportError(\n                \"TA-Lib is not installed for this environment. If you are using this class make sure to have TA-Lib installed. check https://mrjbq7.github.io/ta-lib/install.html for instructions on installation.\"\n            )";
                var nbb_formatted_code = "# export\nclass TalibFeatureGenerator(BaseProcessor):\n    \"\"\"\n    Generate relevant features available in TA-Lib. \\n\n    More info: https://mrjbq7.github.io/ta-lib \\n\n    Input DataFrames for these functions should have the following columns defined:\n    ['open', 'high', 'low', 'close', 'volume'] \\n\n    Make sure that all values are sorted in chronological order (by ticker). \\n\n    :param windows: List of ranges for window features.\n    Windows will be applied for all features specified in self.window_features. \\n\n    :param ticker_col: Which column to groupby for feature generation.\n    \"\"\"\n\n    def __init__(self, windows: List[int], ticker_col: str = \"bloomberg_ticker\"):\n        self.__check_talib_import()\n        super().__init__()\n\n        self.windows = windows\n        self.ticker_col = ticker_col\n        self.window_features = [\n            \"NATR\",\n            \"ADXR\",\n            \"AROONOSC\",\n            \"DX\",\n            \"MFI\",\n            \"MINUS_DI\",\n            \"MINUS_DM\",\n            \"MOM\",\n            \"ROCP\",\n            \"ROCR100\",\n            \"PLUS_DI\",\n            \"PLUS_DM\",\n            \"BETA\",\n            \"RSI\",\n            \"ULTOSC\",\n            \"TRIX\",\n            \"ADXR\",\n            \"CCI\",\n            \"CMO\",\n            \"WILLR\",\n        ]\n        self.no_window_features = [\"AD\", \"OBV\", \"APO\", \"MACD\", \"PPO\"]\n        self.hlocv_cols = [\"open\", \"high\", \"low\", \"close\", \"volume\"]\n\n    def get_no_window_features(self, dataf: pd.DataFrame):\n        for func in tqdm(self.no_window_features, desc=\"No window features\"):\n            dataf.loc[:, f\"feature_{func}\"] = (\n                dataf.groupby(self.ticker_col)\n                .apply(lambda x: pd.Series(self._no_window(x, func)).bfill())\n                .values.astype(np.float32)\n            )\n        return dataf\n\n    def get_window_features(self, dataf: pd.DataFrame):\n        for win in tqdm(self.windows, position=0, desc=\"Window features\"):\n            for func in tqdm(self.window_features, position=1):\n                dataf.loc[:, f\"feature_{func}_{win}\"] = (\n                    dataf.groupby(self.ticker_col)\n                    .apply(lambda x: pd.Series(self._window(x, func, win)).bfill())\n                    .values.astype(np.float32)\n                )\n        return dataf\n\n    def get_all_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        dataf = self.get_no_window_features(dataf)\n        dataf = self.get_window_features(dataf)\n        return dataf\n\n    def transform(self, dataf: pd.DataFrame, *args, **kwargs) -> NumerFrame:\n        return NumerFrame(self.get_all_features(dataf=dataf))\n\n    def _no_window(self, dataf: pd.DataFrame, func) -> pd.Series:\n        from talib import abstract as tab\n\n        inputs = self.__get_inputs(dataf)\n        if func in [\"MACD\"]:\n            # MACD outputs tuple of 3 elements (value, signal and hist)\n            return tab.Function(func)(inputs[\"close\"])[0]\n        else:\n            return tab.Function(func)(inputs)\n\n    def _window(self, dataf: pd.DataFrame, func, window: int) -> pd.Series:\n        from talib import abstract as tab\n\n        inputs = self.__get_inputs(dataf)\n        if func in [\"ULTOSC\"]:\n            # ULTOSC requires 3 timeperiods as input\n            return tab.Function(func)(\n                inputs[\"high\"],\n                inputs[\"low\"],\n                inputs[\"close\"],\n                timeperiod1=window,\n                timeperiod2=window * 2,\n                timeperiod3=window * 4,\n            )\n        else:\n            return tab.Function(func)(inputs, timeperiod=window)\n\n    def __get_inputs(self, dataf: pd.DataFrame) -> dict:\n        return {col: dataf[col].values.astype(np.float64) for col in self.hlocv_cols}\n\n    @staticmethod\n    def __check_talib_import():\n        try:\n            from talib import abstract as tab\n        except ImportError:\n            raise ImportError(\n                \"TA-Lib is not installed for this environment. If you are using this class make sure to have TA-Lib installed. check https://mrjbq7.github.io/ta-lib/install.html for instructions on installation.\"\n            )";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.2.2.-KatsuFeatureGenerator">1.2.2. KatsuFeatureGenerator<a class="anchor-link" href="#1.2.2.-KatsuFeatureGenerator"> </a></h3><p><a href="https://www.kaggle.com/code1110">Katsu1110</a> provides an excellent and fast feature engineering scheme in his <a href="https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners">Kaggle notebook on starting with Numerai Signals</a>. It is surprisingly effective, fast and works well for modeling. This preprocessor is based on his feature engineering setup in that notebook.</p>
<p>Features generated:</p>
<ol>
<li>MACD and MACD signal</li>
<li>RSI</li>
<li>Percentage rate of return</li>
<li>Volatility</li>
<li>MA (moving average) gap</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="KatsuFeatureGenerator" class="doc_header"><code>class</code> <code>KatsuFeatureGenerator</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L466" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>KatsuFeatureGenerator</code>(<strong><code>windows</code></strong>:<code>list</code>, <strong><code>ticker_col</code></strong>:<code>str</code>=<em><code>'ticker'</code></em>, <strong><code>close_col</code></strong>:<code>str</code>=<em><code>'close'</code></em>, <strong><code>num_cores</code></strong>:<code>int</code>=<em><code>None</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Effective feature engineering setup based on Katsu's starter notebook.
Based on source by Katsu1110: <a href="https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners">https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners</a></p>
<p>:param windows: Time interval to apply for window features:</p>
<ol>
<li><p>Percentage Rate of change</p>
</li>
<li><p>Volatility</p>
</li>
<li><p>Moving Average gap</p>
</li>
</ol>
<p>:param ticker_col: Columns with tickers to iterate over.</p>
<p>:param close_col: Column name where you have closing price stored.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="24fdcf51-8b7f-4968-a851-92969cc462e1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#24fdcf51-8b7f-4968-a851-92969cc462e1');

            setTimeout(function() {
                var nbb_cell_id = 34;
                var nbb_unformatted_code = "# export\nclass KatsuFeatureGenerator(BaseProcessor):\n    \"\"\"\n    Effective feature engineering setup based on Katsu's starter notebook.\n    Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners\n\n    :param windows: Time interval to apply for window features: \\n\n    1. Percentage Rate of change \\n\n    2. Volatility \\n\n    3. Moving Average gap \\n\n    :param ticker_col: Columns with tickers to iterate over. \\n\n    :param close_col: Column name where you have closing price stored.\n    \"\"\"\n\n    warnings.filterwarnings(\"ignore\")\n\n    def __init__(\n        self,\n        windows: list,\n        ticker_col: str = \"ticker\",\n        close_col: str = \"close\",\n        num_cores: int = None,\n    ):\n        super().__init__()\n        self.windows = windows\n        self.ticker_col = ticker_col\n        self.close_col = close_col\n        self.num_cores = num_cores if num_cores else os.cpu_count()\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        \"\"\"Multiprocessing feature engineering.\"\"\"\n        tickers = dataf.loc[:, self.ticker_col].unique().tolist()\n        rich_print(\n            f\"Feature engineering for {len(tickers)} tickers using {self.num_cores} CPU cores.\"\n        )\n        dataf_list = [\n            x\n            for _, x in tqdm(\n                dataf.groupby(self.ticker_col), desc=\"Generating ticker DataFrames\"\n            )\n        ]\n        dataf = self._generate_features(dataf_list=dataf_list)\n        return NumerFrame(dataf)\n\n    def feature_engineering(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"Feature engineering for single ticker.\"\"\"\n        close_series = dataf.loc[:, self.close_col]\n        for x in self.windows:\n            dataf.loc[\n                :, f\"feature_{self.close_col}_ROCP_{x}\"\n            ] = close_series.pct_change(x)\n\n            dataf.loc[:, f\"feature_{self.close_col}_VOL_{x}\"] = (\n                np.log1p(close_series).pct_change().rolling(x).std()\n            )\n\n            dataf.loc[:, f\"feature_{self.close_col}_MA_gap_{x}\"] = (\n                close_series / close_series.rolling(x).mean()\n            )\n\n        dataf.loc[:, \"feature_RSI\"] = self._rsi(close_series)\n        macd, macd_signal = self._macd(close_series)\n        dataf.loc[:, \"feature_MACD\"] = macd\n        dataf.loc[:, \"feature_MACD_signal\"] = macd_signal\n        return dataf.bfill()\n\n    def _generate_features(self, dataf_list: list) -> pd.DataFrame:\n        \"\"\"Add features for list of ticker DataFrames and concatenate.\"\"\"\n        with Pool(self.num_cores) as p:\n            feature_datafs = list(\n                tqdm(\n                    p.imap(self.feature_engineering, dataf_list),\n                    desc=\"Generating features\",\n                    total=len(dataf_list),\n                )\n            )\n        return pd.concat(feature_datafs)\n\n    @staticmethod\n    def _rsi(close: pd.Series, period: int = 14) -> pd.Series:\n        \"\"\"\n        See source https://github.com/peerchemist/finta\n        and fix https://www.tradingview.com/wiki/Talk:Relative_Strength_Index_(RSI)\n        \"\"\"\n        delta = close.diff()\n        up, down = delta.copy(), delta.copy()\n        up[up < 0] = 0\n        down[down > 0] = 0\n\n        gain = up.ewm(com=(period - 1), min_periods=period).mean()\n        loss = down.abs().ewm(com=(period - 1), min_periods=period).mean()\n\n        rs = gain / loss\n        return pd.Series(100 - (100 / (1 + rs)))\n\n    def _macd(\n        self, close: pd.Series, span1=12, span2=26, span3=9\n    ) -> Tuple[pd.Series, pd.Series]:\n        \"\"\"Compute MACD and MACD signal.\"\"\"\n        exp1 = self.__ema1(close, span1)\n        exp2 = self.__ema1(close, span2)\n        macd = 100 * (exp1 - exp2) / exp2\n        signal = self.__ema1(macd, span3)\n        return macd, signal\n\n    @staticmethod\n    def __ema1(series: pd.Series, span: int) -> pd.Series:\n        \"\"\"Exponential moving average\"\"\"\n        a = 2 / (span + 1)\n        return series.ewm(alpha=a).mean()";
                var nbb_formatted_code = "# export\nclass KatsuFeatureGenerator(BaseProcessor):\n    \"\"\"\n    Effective feature engineering setup based on Katsu's starter notebook.\n    Based on source by Katsu1110: https://www.kaggle.com/code1110/numeraisignals-starter-for-beginners\n\n    :param windows: Time interval to apply for window features: \\n\n    1. Percentage Rate of change \\n\n    2. Volatility \\n\n    3. Moving Average gap \\n\n    :param ticker_col: Columns with tickers to iterate over. \\n\n    :param close_col: Column name where you have closing price stored.\n    \"\"\"\n\n    warnings.filterwarnings(\"ignore\")\n\n    def __init__(\n        self,\n        windows: list,\n        ticker_col: str = \"ticker\",\n        close_col: str = \"close\",\n        num_cores: int = None,\n    ):\n        super().__init__()\n        self.windows = windows\n        self.ticker_col = ticker_col\n        self.close_col = close_col\n        self.num_cores = num_cores if num_cores else os.cpu_count()\n\n    @display_processor_info\n    def transform(self, dataf: Union[pd.DataFrame, NumerFrame]) -> NumerFrame:\n        \"\"\"Multiprocessing feature engineering.\"\"\"\n        tickers = dataf.loc[:, self.ticker_col].unique().tolist()\n        rich_print(\n            f\"Feature engineering for {len(tickers)} tickers using {self.num_cores} CPU cores.\"\n        )\n        dataf_list = [\n            x\n            for _, x in tqdm(\n                dataf.groupby(self.ticker_col), desc=\"Generating ticker DataFrames\"\n            )\n        ]\n        dataf = self._generate_features(dataf_list=dataf_list)\n        return NumerFrame(dataf)\n\n    def feature_engineering(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"Feature engineering for single ticker.\"\"\"\n        close_series = dataf.loc[:, self.close_col]\n        for x in self.windows:\n            dataf.loc[\n                :, f\"feature_{self.close_col}_ROCP_{x}\"\n            ] = close_series.pct_change(x)\n\n            dataf.loc[:, f\"feature_{self.close_col}_VOL_{x}\"] = (\n                np.log1p(close_series).pct_change().rolling(x).std()\n            )\n\n            dataf.loc[:, f\"feature_{self.close_col}_MA_gap_{x}\"] = (\n                close_series / close_series.rolling(x).mean()\n            )\n\n        dataf.loc[:, \"feature_RSI\"] = self._rsi(close_series)\n        macd, macd_signal = self._macd(close_series)\n        dataf.loc[:, \"feature_MACD\"] = macd\n        dataf.loc[:, \"feature_MACD_signal\"] = macd_signal\n        return dataf.bfill()\n\n    def _generate_features(self, dataf_list: list) -> pd.DataFrame:\n        \"\"\"Add features for list of ticker DataFrames and concatenate.\"\"\"\n        with Pool(self.num_cores) as p:\n            feature_datafs = list(\n                tqdm(\n                    p.imap(self.feature_engineering, dataf_list),\n                    desc=\"Generating features\",\n                    total=len(dataf_list),\n                )\n            )\n        return pd.concat(feature_datafs)\n\n    @staticmethod\n    def _rsi(close: pd.Series, period: int = 14) -> pd.Series:\n        \"\"\"\n        See source https://github.com/peerchemist/finta\n        and fix https://www.tradingview.com/wiki/Talk:Relative_Strength_Index_(RSI)\n        \"\"\"\n        delta = close.diff()\n        up, down = delta.copy(), delta.copy()\n        up[up < 0] = 0\n        down[down > 0] = 0\n\n        gain = up.ewm(com=(period - 1), min_periods=period).mean()\n        loss = down.abs().ewm(com=(period - 1), min_periods=period).mean()\n\n        rs = gain / loss\n        return pd.Series(100 - (100 / (1 + rs)))\n\n    def _macd(\n        self, close: pd.Series, span1=12, span2=26, span3=9\n    ) -> Tuple[pd.Series, pd.Series]:\n        \"\"\"Compute MACD and MACD signal.\"\"\"\n        exp1 = self.__ema1(close, span1)\n        exp2 = self.__ema1(close, span2)\n        macd = 100 * (exp1 - exp2) / exp2\n        signal = self.__ema1(macd, span3)\n        return macd, signal\n\n    @staticmethod\n    def __ema1(series: pd.Series, span: int) -> pd.Series:\n        \"\"\"Exponential moving average\"\"\"\n        a = 2 / (span + 1)\n        return series.ewm(alpha=a).mean()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">numerblox.download</span> <span class="kn">import</span> <span class="n">KaggleDownloader</span>
<span class="c1"># Get price data from Kaggle</span>
<span class="n">home_dir</span> <span class="o">=</span> <span class="s2">&quot;katsu_features_test/&quot;</span>
<span class="n">kd</span> <span class="o">=</span> <span class="n">KaggleDownloader</span><span class="p">(</span><span class="n">home_dir</span><span class="p">)</span>
<span class="n">kd</span><span class="o">.</span><span class="n">download_training_data</span><span class="p">(</span><span class="s2">&quot;code1110/yfinance-stock-price-data-for-numerai-signals&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">No existing directory found at <span style="color: #008000; text-decoration-color: #008000">'</span><span style="color: #000080; text-decoration-color: #000080">katsu_features_test</span><span style="color: #008000; text-decoration-color: #008000">'</span>. Creating directory<span style="color: #808000; text-decoration-color: #808000">...</span>
</pre>

</div>

</div>

<div class="output_area">




<div id="973b71fa-6ce8-4a06-9c78-8de6e1453cef"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#973b71fa-6ce8-4a06-9c78-8de6e1453cef');

            setTimeout(function() {
                var nbb_cell_id = 35;
                var nbb_unformatted_code = "# other\nfrom numerblox.download import KaggleDownloader\n# Get price data from Kaggle\nhome_dir = \"katsu_features_test/\"\nkd = KaggleDownloader(home_dir)\nkd.download_training_data(\"code1110/yfinance-stock-price-data-for-numerai-signals\")";
                var nbb_formatted_code = "# other\nfrom numerblox.download import KaggleDownloader\n\n# Get price data from Kaggle\nhome_dir = \"katsu_features_test/\"\nkd = KaggleDownloader(home_dir)\nkd.download_training_data(\"code1110/yfinance-stock-price-data-for-numerai-signals\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataf</span> <span class="o">=</span> <span class="n">create_numerframe</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/full_data.parquet&quot;</span><span class="p">)</span>
<span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;friday_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
<span class="c1"># Take 500 ticker sample for test</span>
<span class="n">dataf</span> <span class="o">=</span> <span class="n">dataf</span><span class="p">[</span><span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">dataf</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[:</span><span class="mi">500</span><span class="p">])]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="38648390-7645-4a80-911e-da516a8edb1b"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#38648390-7645-4a80-911e-da516a8edb1b');

            setTimeout(function() {
                var nbb_cell_id = 36;
                var nbb_unformatted_code = "# other\ndataf = create_numerframe(f\"{home_dir}/full_data.parquet\")\ndataf.loc[:, 'friday_date'] = dataf['date']\n# Take 500 ticker sample for test\ndataf = dataf[dataf['ticker'].isin(dataf['ticker'].unique()[:500])]";
                var nbb_formatted_code = "# other\ndataf = create_numerframe(f\"{home_dir}/full_data.parquet\")\ndataf.loc[:, \"friday_date\"] = dataf[\"date\"]\n# Take 500 ticker sample for test\ndataf = dataf[dataf[\"ticker\"].isin(dataf[\"ticker\"].unique()[:500])]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kfpp</span> <span class="o">=</span> <span class="n">KatsuFeatureGenerator</span><span class="p">(</span><span class="n">windows</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="n">num_cores</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">new_dataf</span> <span class="o">=</span> <span class="n">kfpp</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Feature engineering for <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> tickers using <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> CPU cores.
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-04-06 22:15:38,689 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,696 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,692 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,700 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,702 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,708 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,708 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,716 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,714 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,719 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,728 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,731 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,735 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,737 INFO numexpr.utils: NumExpr defaulting to 8 threads.
2022-04-06 22:15:38,736 INFO numexpr.utils: Note: NumExpr detected 16 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8.
2022-04-06 22:15:38,744 INFO numexpr.utils: NumExpr defaulting to 8 threads.
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">KatsuFeatureGenerator</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2524503</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:00:07</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">337639</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="2fb4ea4d-e25d-43a4-bcfc-f21139b77d69"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#2fb4ea4d-e25d-43a4-bcfc-f21139b77d69');

            setTimeout(function() {
                var nbb_cell_id = 37;
                var nbb_unformatted_code = "# other\nkfpp = KatsuFeatureGenerator(windows=[20, 40, 60], num_cores=8)\nnew_dataf = kfpp.transform(dataf)";
                var nbb_formatted_code = "# other\nkfpp = KatsuFeatureGenerator(windows=[20, 40, 60], num_cores=8)\nnew_dataf = kfpp.transform(dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>12 features are generated in this test (3*3 window features + 3 non window features).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_dataf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;ticker&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">get_feature_data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_close_ROCP_20</th>
      <th>feature_close_VOL_20</th>
      <th>feature_close_MA_gap_20</th>
      <th>feature_close_ROCP_40</th>
      <th>feature_close_VOL_40</th>
      <th>feature_close_MA_gap_40</th>
      <th>feature_close_ROCP_60</th>
      <th>feature_close_VOL_60</th>
      <th>feature_close_MA_gap_60</th>
      <th>feature_RSI</th>
      <th>feature_MACD</th>
      <th>feature_MACD_signal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19870719</th>
      <td>0.043659</td>
      <td>0.012359</td>
      <td>1.038477</td>
      <td>-0.114638</td>
      <td>0.010094</td>
      <td>0.995933</td>
      <td>-0.146259</td>
      <td>0.008895</td>
      <td>0.949349</td>
      <td>53.491013</td>
      <td>-1.684793</td>
      <td>-2.460588</td>
    </tr>
    <tr>
      <th>19875927</th>
      <td>0.006061</td>
      <td>0.012042</td>
      <td>1.029883</td>
      <td>-0.110714</td>
      <td>0.010078</td>
      <td>0.991045</td>
      <td>-0.154499</td>
      <td>0.008897</td>
      <td>0.944494</td>
      <td>51.752020</td>
      <td>-1.341805</td>
      <td>-2.236831</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">




<div id="322ed318-224e-4724-b306-7a81c01281db"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#322ed318-224e-4724-b306-7a81c01281db');

            setTimeout(function() {
                var nbb_cell_id = 38;
                var nbb_unformatted_code = "# other\nnew_dataf.sort_values([\"ticker\", \"date\"]).get_feature_data.tail(2)";
                var nbb_formatted_code = "# other\nnew_dataf.sort_values([\"ticker\", \"date\"]).get_feature_data.tail(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.2.3.-EraQuantileProcessor">1.2.3. EraQuantileProcessor<a class="anchor-link" href="#1.2.3.-EraQuantileProcessor"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EraQuantileProcessor" class="doc_header"><code>class</code> <code>EraQuantileProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L578" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EraQuantileProcessor</code>(<strong><code>num_quantiles</code></strong>:<code>int</code>=<em><code>50</code></em>, <strong><code>era_col</code></strong>:<code>str</code>=<em><code>'friday_date'</code></em>, <strong><code>features</code></strong>:<code>list</code>=<em><code>None</code></em>, <strong><code>num_cores</code></strong>:<code>int</code>=<em><code>None</code></em>) :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Transform features into quantiles on a per-era basis</p>
<p>:param num_quantiles: Number of buckets to split data into:</p>
<p>:param era_col: Era column name in the dataframe to perform each transformation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="882d780d-42dd-45cd-8a0d-54d5cffad8c8"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#882d780d-42dd-45cd-8a0d-54d5cffad8c8');

            setTimeout(function() {
                var nbb_cell_id = 39;
                var nbb_unformatted_code = "# export\nclass EraQuantileProcessor(BaseProcessor):\n    \"\"\"\n    Transform features into quantiles on a per-era basis\n\n    :param num_quantiles: Number of buckets to split data into: \\n\n    :param era_col: Era column name in the dataframe to perform each transformation \\n\n    \"\"\"\n\n    def __init__(\n        self,\n        num_quantiles: int = 50,\n        era_col: str = \"friday_date\",\n        features: list = None,\n        num_cores: int = None,\n    ):\n        super().__init__()\n        self.num_quantiles = num_quantiles\n        self.era_col = era_col\n        self.num_cores = num_cores if num_cores else os.cpu_count()\n        self.features = features\n\n    def _process_eras(self, groupby_object):\n        quantizer = QuantileTransformer(n_quantiles=self.num_quantiles, random_state=0)\n        qt = lambda x: quantizer.fit_transform(x.values.reshape(-1, 1)).ravel()\n\n        column = groupby_object.transform(qt)\n        return column\n\n    @display_processor_info\n    def transform(\n        self,\n        dataf: Union[pd.DataFrame, NumerFrame],\n    ) -> NumerFrame:\n        \"\"\"Multiprocessing quantile transforms by era.\"\"\"\n        self.features = self.features if self.features else dataf.feature_cols\n        rich_print(\n            f\"Quantiling for {len(self.features)} features using {self.num_cores} CPU cores.\"\n        )\n\n        date_groups = dataf.groupby(self.era_col)\n        groupby_objects = [date_groups[feature] for feature in self.features]\n\n        with Pool() as p:\n            results = list(\n                tqdm(\n                    p.imap(self._process_eras, groupby_objects),\n                    total=len(groupby_objects),\n                )\n            )\n\n        quantiles = pd.concat(results, axis=1)\n        dataf[[f\"{feature}_quantile\" for feature in self.features]] = quantiles\n        return NumerFrame(dataf)";
                var nbb_formatted_code = "# export\nclass EraQuantileProcessor(BaseProcessor):\n    \"\"\"\n    Transform features into quantiles on a per-era basis\n\n    :param num_quantiles: Number of buckets to split data into: \\n\n    :param era_col: Era column name in the dataframe to perform each transformation \\n\n    \"\"\"\n\n    def __init__(\n        self,\n        num_quantiles: int = 50,\n        era_col: str = \"friday_date\",\n        features: list = None,\n        num_cores: int = None,\n    ):\n        super().__init__()\n        self.num_quantiles = num_quantiles\n        self.era_col = era_col\n        self.num_cores = num_cores if num_cores else os.cpu_count()\n        self.features = features\n\n    def _process_eras(self, groupby_object):\n        quantizer = QuantileTransformer(n_quantiles=self.num_quantiles, random_state=0)\n        qt = lambda x: quantizer.fit_transform(x.values.reshape(-1, 1)).ravel()\n\n        column = groupby_object.transform(qt)\n        return column\n\n    @display_processor_info\n    def transform(\n        self,\n        dataf: Union[pd.DataFrame, NumerFrame],\n    ) -> NumerFrame:\n        \"\"\"Multiprocessing quantile transforms by era.\"\"\"\n        self.features = self.features if self.features else dataf.feature_cols\n        rich_print(\n            f\"Quantiling for {len(self.features)} features using {self.num_cores} CPU cores.\"\n        )\n\n        date_groups = dataf.groupby(self.era_col)\n        groupby_objects = [date_groups[feature] for feature in self.features]\n\n        with Pool() as p:\n            results = list(\n                tqdm(\n                    p.imap(self._process_eras, groupby_objects),\n                    total=len(groupby_objects),\n                )\n            )\n\n        quantiles = pd.concat(results, axis=1)\n        dataf[[f\"{feature}_quantile\" for feature in self.features]] = quantiles\n        return NumerFrame(dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">era_quantiler</span> <span class="o">=</span> <span class="n">EraQuantileProcessor</span><span class="p">(</span><span class="n">num_quantiles</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">era_dataf</span> <span class="o">=</span> <span class="n">era_quantiler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">new_dataf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Quantiling for <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span> features using <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span> CPU cores.
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">EraQuantileProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2524503</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">33</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #000080; text-decoration-color: #000080; font-weight: bold">0:02:53</span><span style="color: #000080; text-decoration-color: #000080">.</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">087000</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="e9950e54-56be-4396-bf82-9f68c47f3290"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#e9950e54-56be-4396-bf82-9f68c47f3290');

            setTimeout(function() {
                var nbb_cell_id = 40;
                var nbb_unformatted_code = "# other\nera_quantiler = EraQuantileProcessor(num_quantiles=50)\nera_dataf = era_quantiler.transform(new_dataf)";
                var nbb_formatted_code = "# other\nera_quantiler = EraQuantileProcessor(num_quantiles=50)\nera_dataf = era_quantiler.transform(new_dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">era_dataf</span><span class="o">.</span><span class="n">get_feature_data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature_close_ROCP_20</th>
      <th>feature_close_VOL_20</th>
      <th>feature_close_MA_gap_20</th>
      <th>feature_close_ROCP_40</th>
      <th>feature_close_VOL_40</th>
      <th>feature_close_MA_gap_40</th>
      <th>feature_close_ROCP_60</th>
      <th>feature_close_VOL_60</th>
      <th>feature_close_MA_gap_60</th>
      <th>feature_RSI</th>
      <th>...</th>
      <th>feature_close_MA_gap_20_quantile</th>
      <th>feature_close_ROCP_40_quantile</th>
      <th>feature_close_VOL_40_quantile</th>
      <th>feature_close_MA_gap_40_quantile</th>
      <th>feature_close_ROCP_60_quantile</th>
      <th>feature_close_VOL_60_quantile</th>
      <th>feature_close_MA_gap_60_quantile</th>
      <th>feature_RSI_quantile</th>
      <th>feature_MACD_quantile</th>
      <th>feature_MACD_signal_quantile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19870719</th>
      <td>0.043659</td>
      <td>0.012359</td>
      <td>1.038477</td>
      <td>-0.114638</td>
      <td>0.010094</td>
      <td>0.995933</td>
      <td>-0.146259</td>
      <td>0.008895</td>
      <td>0.949349</td>
      <td>53.491013</td>
      <td>...</td>
      <td>0.698273</td>
      <td>0.060019</td>
      <td>0.973669</td>
      <td>0.325862</td>
      <td>0.168157</td>
      <td>0.966298</td>
      <td>0.125098</td>
      <td>0.520845</td>
      <td>0.048145</td>
      <td>0.031296</td>
    </tr>
    <tr>
      <th>19875927</th>
      <td>0.006061</td>
      <td>0.012042</td>
      <td>1.029883</td>
      <td>-0.110714</td>
      <td>0.010078</td>
      <td>0.991045</td>
      <td>-0.154499</td>
      <td>0.008897</td>
      <td>0.944494</td>
      <td>51.752020</td>
      <td>...</td>
      <td>0.775538</td>
      <td>0.113676</td>
      <td>0.966339</td>
      <td>0.433476</td>
      <td>0.155960</td>
      <td>0.964018</td>
      <td>0.203244</td>
      <td>0.608829</td>
      <td>0.106155</td>
      <td>0.051631</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 24 columns</p>
</div>
</div>

</div>

<div class="output_area">




<div id="cb0158f0-b633-412a-8b34-969303adda9c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#cb0158f0-b633-412a-8b34-969303adda9c');

            setTimeout(function() {
                var nbb_cell_id = 41;
                var nbb_unformatted_code = "# other\nera_dataf.get_feature_data.tail(2)";
                var nbb_formatted_code = "# other\nera_dataf.get_feature_data.tail(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Custom-preprocessors">2. Custom preprocessors<a class="anchor-link" href="#2.-Custom-preprocessors"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are an almost unlimited number of ways to preprocess (selection, engineering and manipulation). We have only scratched the surface with the preprocessors currently implemented. We invite the Numerai community to develop Numerai Classic and Numerai Signals preprocessors.</p>
<p>A new Preprocessor should inherit from <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a> and implement a <code>transform</code> method. For efficient implementation, we recommend you use <a href="/numerbloxnumerframe.html#NumerFrame"><code>NumerFrame</code></a> functionality for preprocessing. You can also support Pandas DataFrame input as long as the <code>transform</code> method returns a <a href="/numerbloxnumerframe.html#NumerFrame"><code>NumerFrame</code></a>. This ensures that the Preprocessor still works within a full <code>numerai-blocks</code> pipeline. A template for new preprocessors is given below.</p>
<p>To enable fancy logging output. Add the <code>@display_processor_info</code> decorator to the <code>transform</code> method.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AwesomePreProcessor" class="doc_header"><code>class</code> <code>AwesomePreProcessor</code><a href="https://github.com/crowdcent/numerblox/tree/master/numerblox/preprocessing.py#L633" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AwesomePreProcessor</code>() :: <a href="/numerbloxpreprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>TEMPLATE - Do some awesome preprocessing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="212152fd-d0e7-4636-a877-c6e797a86240"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#212152fd-d0e7-4636-a877-c6e797a86240');

            setTimeout(function() {
                var nbb_cell_id = 43;
                var nbb_unformatted_code = "# export\nclass AwesomePreProcessor(BaseProcessor):\n    \"\"\" TEMPLATE - Do some awesome preprocessing. \"\"\"\n    def __init__(self):\n        super().__init__()\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame, *args, **kwargs) -> NumerFrame:\n        # Do processing\n        ...\n        # Parse all contents of NumerFrame to the next pipeline step\n        return NumerFrame(dataf)";
                var nbb_formatted_code = "# export\nclass AwesomePreProcessor(BaseProcessor):\n    \"\"\"TEMPLATE - Do some awesome preprocessing.\"\"\"\n\n    def __init__(self):\n        super().__init__()\n\n    @display_processor_info\n    def transform(self, dataf: NumerFrame, *args, **kwargs) -> NumerFrame:\n        # Do processing\n        ...\n        # Parse all contents of NumerFrame to the next pipeline step\n        return NumerFrame(dataf)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

