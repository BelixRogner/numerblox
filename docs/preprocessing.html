---

title: Preprocessing


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/03_preprocessing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_preprocessing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">load_ext</span> nb_black
<span class="o">%</span><span class="k">load_ext</span> lab_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="791e2f1a-c0bf-4e7e-820f-2ebea2d221d0"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#791e2f1a-c0bf-4e7e-820f-2ebea2d221d0');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_formatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.-Base">0. Base<a class="anchor-link" href="#0.-Base"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="0.1.-BaseProcessor">0.1. BaseProcessor<a class="anchor-link" href="#0.1.-BaseProcessor"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseProcessor" class="doc_header"><code>class</code> <code>BaseProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseProcessor</code>() :: <code>ABC</code></p>
</blockquote>
<p>New Preprocessors and Postprocessors should inherit from this object
and implement the transform method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7e2d52c6-0651-4909-b20b-6605186173ca"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7e2d52c6-0651-4909-b20b-6605186173ca');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "#export\n@typechecked\nclass BaseProcessor(ABC):\n    \"\"\"\n    New Preprocessors and Postprocessors should inherit from this object\n    and implement the transform method.\n    \"\"\"\n    def __init__(self):\n        ...\n\n    @abstractmethod\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        ...\n\n    def __call__(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return self.transform(dataset=dataset, *args, **kwargs)";
                var nbb_formatted_code = "# export\n@typechecked\nclass BaseProcessor(ABC):\n    \"\"\"\n    New Preprocessors and Postprocessors should inherit from this object\n    and implement the transform method.\n    \"\"\"\n\n    def __init__(self):\n        ...\n\n    @abstractmethod\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        ...\n\n    def __call__(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return self.transform(dataset=dataset, *args, **kwargs)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="0.2.-Decorators">0.2. Decorators<a class="anchor-link" href="#0.2.-Decorators"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You might have preprocessing functions that work with Pandas DataFrames and want to make them compatible with <code>numerai-blocks</code> <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a>s. This can be done by adding a single decorator (<a href="/numerai_blocks/preprocessing.html#support_dataset_processing"><code>support_dataset_processing</code></a>).</p>
<p>The reverse (make Dataset Preprocessor compatible with Pandas DataFrames directly) by adding the decorator <a href="/numerai_blocks/preprocessing.html#support_dataf_processing"><code>support_dataf_processing</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="support_dataf_processing" class="doc_header"><code>support_dataf_processing</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>support_dataf_processing</code>(<strong><code>func</code></strong>)</p>
</blockquote>
<p>Make Dataset processor compatible with DataFrame input.
:param func: Some function/method that takes Dataset as input
and returns Dataset.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="support_dataset_processing" class="doc_header"><code>support_dataset_processing</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>support_dataset_processing</code>(<strong><code>func</code></strong>)</p>
</blockquote>
<p>Make existing DataFrame transformer compatible with Dataset input.
:param func: Some function/method that takes Pandas DataFrame as input
and return Pandas DataFrame.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="ebf19f43-86c1-49c3-81ff-803d0e60c911"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ebf19f43-86c1-49c3-81ff-803d0e60c911');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "#export\ndef support_dataf_processing(func):\n    \"\"\"\n    Make Dataset processor compatible with DataFrame input.\n    :param func: Some function/method that takes Dataset as input\n    and returns Dataset.\n    \"\"\"\n    @wraps(func)\n    def wrapper(dataf: pd.DataFrame, *args, **kwargs) -> pd.DataFrame:\n        return func(Dataset(dataf), *args, **kwargs).dataf\n    return wrapper\n\ndef support_dataset_processing(func):\n    \"\"\"\n    Make existing DataFrame transformer compatible with Dataset input.\n    :param func: Some function/method that takes Pandas DataFrame as input\n    and return Pandas DataFrame.\n    \"\"\"\n    @wraps(func)\n    def wrapper(dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataf_transform = func(dataset.dataf, *args, **kwargs)\n        metadata = dataset.__dict__\n        metadata.pop(\"dataf\", None)\n        return Dataset(dataf_transform, metadata)\n    return wrapper";
                var nbb_formatted_code = "# export\ndef support_dataf_processing(func):\n    \"\"\"\n    Make Dataset processor compatible with DataFrame input.\n    :param func: Some function/method that takes Dataset as input\n    and returns Dataset.\n    \"\"\"\n\n    @wraps(func)\n    def wrapper(dataf: pd.DataFrame, *args, **kwargs) -> pd.DataFrame:\n        return func(Dataset(dataf), *args, **kwargs).dataf\n\n    return wrapper\n\n\ndef support_dataset_processing(func):\n    \"\"\"\n    Make existing DataFrame transformer compatible with Dataset input.\n    :param func: Some function/method that takes Pandas DataFrame as input\n    and return Pandas DataFrame.\n    \"\"\"\n\n    @wraps(func)\n    def wrapper(dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataf_transform = func(dataset.dataf, *args, **kwargs)\n        metadata = dataset.__dict__\n        metadata.pop(\"dataf\", None)\n        return Dataset(dataf_transform, metadata)\n\n    return wrapper";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Decorator-tests">Decorator tests<a class="anchor-link" href="#Decorator-tests"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_features</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;feature_</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="s2">&quot;ABCDEFGHIK&quot;</span><span class="p">]</span>
<span class="n">id_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">test_features</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pandas_quad</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple DataFrame function which takes gives column to power of 2. &quot;&quot;&quot;</span>
    <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_copy</span>

<span class="k">class</span> <span class="nc">QuadraticProcessor</span><span class="p">(</span><span class="n">BaseProcessor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple Dataset Processor which takes gives column to power of 2. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QuadraticProcessor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="n">dataset_copy</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">copy_dataset</span><span class="p">()</span>
        <span class="n">dataset_copy</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_copy</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quadratic</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">dataset_copy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_quadratic</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dataf</span> <span class="o">**</span> <span class="mi">2</span>


<span class="nd">@support_dataset_processing</span>
<span class="k">def</span> <span class="nf">test_dataf_with_dataset_input</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">pandas_quad</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

<span class="nd">@support_dataf_processing</span>
<span class="k">def</span> <span class="nf">test_dataset_with_dataf_input</span><span class="p">(</span><span class="n">dataf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">QuadraticProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataf</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="90db49ce-bec3-44e0-a5b1-d481115439fb"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#90db49ce-bec3-44e0-a5b1-d481115439fb');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "# Random DataFrame\ntest_features = [f\"feature_{l}\" for l in \"ABCDEFGHIK\"]\nid_col = [uuid.uuid4().hex for _ in range(100)]\ndf = pd.DataFrame(np.random.uniform(size=(100, 10)), columns=test_features)\n\ndef pandas_quad(df, col: str):\n    \"\"\" Simple DataFrame function which takes gives column to power of 2. \"\"\"\n    df_copy = df.copy()\n    df_copy.loc[:, col] = df_copy.loc[:, col].apply(lambda x: x ** 2)\n    return df_copy\n\nclass QuadraticProcessor(BaseProcessor):\n    \"\"\" Simple Dataset Processor which takes gives column to power of 2. \"\"\"\n    def __init__(self):\n        super(QuadraticProcessor, self).__init__()\n\n    def transform(self, dataset: Dataset, col: str) -> Dataset:\n        dataset_copy = dataset.copy_dataset()\n        dataset_copy.dataf.loc[:, col] = dataset_copy.get_column_selection(col).pipe(self._quadratic)\n        return Dataset(**dataset_copy.__dict__)\n\n    @staticmethod\n    def _quadratic(dataf: pd.DataFrame):\n        return dataf ** 2\n\n\n@support_dataset_processing\ndef test_dataf_with_dataset_input(dataset: Dataset, col: str) -> Dataset:\n    return pandas_quad(dataset, col=col)\n\n@support_dataf_processing\ndef test_dataset_with_dataf_input(dataf: pd.DataFrame, col: str) -> pd.DataFrame:\n    return QuadraticProcessor().transform(dataset=dataf, col=col)";
                var nbb_formatted_code = "# Random DataFrame\ntest_features = [f\"feature_{l}\" for l in \"ABCDEFGHIK\"]\nid_col = [uuid.uuid4().hex for _ in range(100)]\ndf = pd.DataFrame(np.random.uniform(size=(100, 10)), columns=test_features)\n\n\ndef pandas_quad(df, col: str):\n    \"\"\"Simple DataFrame function which takes gives column to power of 2.\"\"\"\n    df_copy = df.copy()\n    df_copy.loc[:, col] = df_copy.loc[:, col].apply(lambda x: x ** 2)\n    return df_copy\n\n\nclass QuadraticProcessor(BaseProcessor):\n    \"\"\"Simple Dataset Processor which takes gives column to power of 2.\"\"\"\n\n    def __init__(self):\n        super(QuadraticProcessor, self).__init__()\n\n    def transform(self, dataset: Dataset, col: str) -> Dataset:\n        dataset_copy = dataset.copy_dataset()\n        dataset_copy.dataf.loc[:, col] = dataset_copy.get_column_selection(col).pipe(\n            self._quadratic\n        )\n        return Dataset(**dataset_copy.__dict__)\n\n    @staticmethod\n    def _quadratic(dataf: pd.DataFrame):\n        return dataf ** 2\n\n\n@support_dataset_processing\ndef test_dataf_with_dataset_input(dataset: Dataset, col: str) -> Dataset:\n    return pandas_quad(dataset, col=col)\n\n\n@support_dataf_processing\ndef test_dataset_with_dataf_input(dataf: pd.DataFrame, col: str) -> pd.DataFrame:\n    return QuadraticProcessor().transform(dataset=dataf, col=col)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_to_transform</span> <span class="o">=</span> <span class="s2">&quot;feature_B&quot;</span>
<span class="n">transformed_dataset</span> <span class="o">=</span> <span class="n">test_dataf_with_dataset_input</span><span class="p">(</span><span class="n">Dataset</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="n">feature_to_transform</span><span class="p">)</span>
<span class="n">transformed_df</span> <span class="o">=</span> <span class="n">test_dataset_with_dataf_input</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">feature_to_transform</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d466a6dd-8488-419a-9cac-75ecb604ab15"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d466a6dd-8488-419a-9cac-75ecb604ab15');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "feature_to_transform = \"feature_B\"\ntransformed_dataset = test_dataf_with_dataset_input(Dataset(df), col=feature_to_transform)\ntransformed_df = test_dataset_with_dataf_input(df, col=feature_to_transform)";
                var nbb_formatted_code = "feature_to_transform = \"feature_B\"\ntransformed_dataset = test_dataf_with_dataset_input(\n    Dataset(df), col=feature_to_transform\n)\ntransformed_df = test_dataset_with_dataf_input(df, col=feature_to_transform)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">transform_method_1</span> <span class="o">=</span> <span class="n">transformed_dataset</span><span class="o">.</span><span class="n">get_column_selection</span><span class="p">(</span><span class="n">feature_to_transform</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">transform_method_2</span> <span class="o">=</span> <span class="n">transformed_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">feature_to_transform</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">transform_method_1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">transform_method_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="ccc2911a-e2d5-43d1-9397-a624b35ee361"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ccc2911a-e2d5-43d1-9397-a624b35ee361');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "transform_method_1 = transformed_dataset.get_column_selection(feature_to_transform).round(8)\ntransform_method_2 = transformed_df.loc[:, [feature_to_transform]].round(8)\n\nassert transform_method_1.equals(transform_method_2)";
                var nbb_formatted_code = "transform_method_1 = transformed_dataset.get_column_selection(\n    feature_to_transform\n).round(8)\ntransform_method_2 = transformed_df.loc[:, [feature_to_transform]].round(8)\n\nassert transform_method_1.equals(transform_method_2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="0.3.-Logging">0.3. Logging<a class="anchor-link" href="#0.3.-Logging"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This function will display:</p>
<ol>
<li>When a step has finished.</li>
<li>What the output shape of the data is.</li>
<li>How long the step took to finish
To use this functionality, simply add <code>@display_processor_info</code></li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="display_processor_info" class="doc_header"><code>display_processor_info</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>display_processor_info</code>(<strong><code>func</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8194d0e9-93a4-4e85-a254-74de61d5f16d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8194d0e9-93a4-4e85-a254-74de61d5f16d');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "#export\ndef display_processor_info(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        tic = dt.datetime.now()\n        result = func(*args, **kwargs)\n        time_taken = str(dt.datetime.now() - tic)\n        class_name = func.__qualname__.split('.')[0]\n        rich_print(f\":white_check_mark: Finished step [bold]{class_name}[/bold]. Output shape={result.dataf.shape}. Time taken for step: {time_taken}. :white_check_mark:\")\n        return result\n    return wrapper";
                var nbb_formatted_code = "# export\ndef display_processor_info(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        tic = dt.datetime.now()\n        result = func(*args, **kwargs)\n        time_taken = str(dt.datetime.now() - tic)\n        class_name = func.__qualname__.split(\".\")[0]\n        rich_print(\n            f\":white_check_mark: Finished step [bold]{class_name}[/bold]. Output shape={result.dataf.shape}. Time taken for step: {time_taken}. :white_check_mark:\"\n        )\n        return result\n\n    return wrapper";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TestDisplay</span><span class="p">:</span>
    <span class="nd">@display_processor_info</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Common-preprocessing-steps">1. Common preprocessing steps<a class="anchor-link" href="#1.-Common-preprocessing-steps"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CopyPreProcessor" class="doc_header"><code>class</code> <code>CopyPreProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L75" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CopyPreProcessor</code>() :: <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>Copy DataFrame to avoid manipulation of original DataFrame.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GroupStatsPreProcessor" class="doc_header"><code>class</code> <code>GroupStatsPreProcessor</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/preprocessing.py#L85" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>GroupStatsPreProcessor</code>() :: <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a></p>
</blockquote>
<p>WARNING: Only supported for Version 1 (legacy) data.
Calculate group statistics for all data groups.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="af2f2926-0d1b-403f-be40-fee8c0ea631d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#af2f2926-0d1b-403f-be40-fee8c0ea631d');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "#export\n@typechecked\nclass CopyPreProcessor(BaseProcessor):\n    \"\"\"Copy DataFrame to avoid manipulation of original DataFrame. \"\"\"\n    def __init__(self):\n        super(CopyPreProcessor, self).__init__()\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return dataset.copy_dataset()\n\n@typechecked\nclass GroupStatsPreProcessor(BaseProcessor):\n    \"\"\"\n    WARNING: Only supported for Version 1 (legacy) data.\n    Calculate group statistics for all data groups.\n    \"\"\"\n    def __init__(self):\n        super(GroupStatsPreProcessor, self).__init__()\n        self.group_names = [\"intelligence\", \"wisdom\", \"charisma\",\n                            \"dexterity\", \"strength\", \"constitution\"]\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        self._check_data_validity(dataset=dataset)\n        dataset.dataf = dataset.dataf.pipe(self._add_group_features)\n        return Dataset(**dataset.__dict__)\n\n    def _add_group_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\" Mean, standard deviation and skew for each group. \"\"\"\n        for group in self.group_names:\n            cols = [col for col in df.columns if group in col]\n            dataf[f\"feature_{group}_mean\"] = dataf[cols].mean(axis=1)\n            dataf[f\"feature_{group}_std\"] = dataf[cols].std(axis=1)\n            dataf[f\"feature_{group}_skew\"] = dataf[cols].skew(axis=1)\n        return dataf\n\n    def _check_data_validity(self, dataset: Dataset):\n        assert hasattr(dataset, 'version'), f\"Version should be specified for '{self.__class__.__name__}' This Preprocessor will only work on version 1 data.\"\n        assert getattr(dataset, 'version') == 1, f\"'{self.__class__.__name__}' only works on version 1 data. Got version: '{getattr(dataset, 'version')}'.\"";
                var nbb_formatted_code = "# export\n@typechecked\nclass CopyPreProcessor(BaseProcessor):\n    \"\"\"Copy DataFrame to avoid manipulation of original DataFrame.\"\"\"\n\n    def __init__(self):\n        super(CopyPreProcessor, self).__init__()\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        return dataset.copy_dataset()\n\n\n@typechecked\nclass GroupStatsPreProcessor(BaseProcessor):\n    \"\"\"\n    WARNING: Only supported for Version 1 (legacy) data.\n    Calculate group statistics for all data groups.\n    \"\"\"\n\n    def __init__(self):\n        super(GroupStatsPreProcessor, self).__init__()\n        self.group_names = [\n            \"intelligence\",\n            \"wisdom\",\n            \"charisma\",\n            \"dexterity\",\n            \"strength\",\n            \"constitution\",\n        ]\n\n    @display_processor_info\n    def transform(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        self._check_data_validity(dataset=dataset)\n        dataset.dataf = dataset.dataf.pipe(self._add_group_features)\n        return Dataset(**dataset.__dict__)\n\n    def _add_group_features(self, dataf: pd.DataFrame) -> pd.DataFrame:\n        \"\"\"Mean, standard deviation and skew for each group.\"\"\"\n        for group in self.group_names:\n            cols = [col for col in df.columns if group in col]\n            dataf[f\"feature_{group}_mean\"] = dataf[cols].mean(axis=1)\n            dataf[f\"feature_{group}_std\"] = dataf[cols].std(axis=1)\n            dataf[f\"feature_{group}_skew\"] = dataf[cols].skew(axis=1)\n        return dataf\n\n    def _check_data_validity(self, dataset: Dataset):\n        assert hasattr(\n            dataset, \"version\"\n        ), f\"Version should be specified for '{self.__class__.__name__}' This Preprocessor will only work on version 1 data.\"\n        assert (\n            getattr(dataset, \"version\") == 1\n        ), f\"'{self.__class__.__name__}' only works on version 1 data. Got version: '{getattr(dataset, 'version')}'.\"";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_assets/mini_numerai_version_1_data.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>era</th>
      <th>data_type</th>
      <th>feature_intelligence1</th>
      <th>feature_intelligence2</th>
      <th>feature_intelligence3</th>
      <th>feature_intelligence4</th>
      <th>feature_intelligence5</th>
      <th>feature_intelligence6</th>
      <th>feature_intelligence7</th>
      <th>...</th>
      <th>feature_wisdom38</th>
      <th>feature_wisdom39</th>
      <th>feature_wisdom40</th>
      <th>feature_wisdom41</th>
      <th>feature_wisdom42</th>
      <th>feature_wisdom43</th>
      <th>feature_wisdom44</th>
      <th>feature_wisdom45</th>
      <th>feature_wisdom46</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>n000315175b67977</td>
      <td>era1</td>
      <td>train</td>
      <td>0.0</td>
      <td>0.5</td>
      <td>0.25</td>
      <td>0.00</td>
      <td>0.5</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.75</td>
      <td>0.5</td>
      <td>0.75</td>
      <td>0.50</td>
      <td>1.0</td>
      <td>0.50</td>
      <td>0.75</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>n0014af834a96cdd</td>
      <td>era1</td>
      <td>train</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.25</td>
      <td>0.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>...</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>0.75</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>1.00</td>
      <td>0.25</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 314 columns</p>
</div>
</div>

</div>

<div class="output_area">




<div id="e6574572-9d12-4c6b-bea8-e3024ab35341"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#e6574572-9d12-4c6b-bea8-e3024ab35341');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "# Top 10 rows of numerai version 1 (legacy) training data.\ndf = pd.read_csv(\"test_assets/mini_numerai_version_1_data.csv\")\ndf.head(2)";
                var nbb_formatted_code = "# Top 10 rows of numerai version 1 (legacy) training data.\ndf = pd.read_csv(\"test_assets/mini_numerai_version_1_data.csv\")\ndf.head(2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;multi_target&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="b34b00fa-4bed-4566-ae66-ea05c04053f5"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#b34b00fa-4bed-4566-ae66-ea05c04053f5');

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "metadata = {\"version\": 1, \"multi_target\": False}\ndataset = Dataset(df, metadata)";
                var nbb_formatted_code = "metadata = {\"version\": 1, \"multi_target\": False}\ndataset = Dataset(df, metadata)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">CopyPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">copied_dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">dataf</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">multi_target</span> <span class="o">==</span> <span class="p">(</span><span class="n">copied_dataset</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">copied_dataset</span><span class="o">.</span><span class="n">multi_target</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">CopyPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">314</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">0:00:00</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">000678</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="5498ae5f-524e-4272-aa5d-8493983b3bbe"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#5498ae5f-524e-4272-aa5d-8493983b3bbe');

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "copied_dataset = CopyPreProcessor().transform(dataset)\nassert copied_dataset.dataf.equals(dataset.dataf)\nassert dataset.version, dataset.multi_target == (copied_dataset.version, copied_dataset.multi_target)";
                var nbb_formatted_code = "copied_dataset = CopyPreProcessor().transform(dataset)\nassert copied_dataset.dataf.equals(dataset.dataf)\nassert dataset.version, dataset.multi_target == (\n    copied_dataset.version,\n    copied_dataset.multi_target,\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">group_features_dataset</span> <span class="o">=</span> <span class="n">GroupStatsPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">copied_dataset</span><span class="p">)</span>
<span class="n">group_features_dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">group_features_dataset</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">✅ Finished step <span style="font-weight: bold">GroupStatsPreProcessor</span>. Output <span style="color: #808000; text-decoration-color: #808000">shape</span>=<span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">332</span><span style="font-weight: bold">)</span>. Time taken for step: 
<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">0:00:00</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">040951</span>. ✅
</pre>

</div>

</div>

<div class="output_area">




<div id="f2ed87e6-8645-48af-b63f-5edb084f9ebf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#f2ed87e6-8645-48af-b63f-5edb084f9ebf');

            setTimeout(function() {
                var nbb_cell_id = 15;
                var nbb_unformatted_code = "group_features_dataset = GroupStatsPreProcessor().transform(copied_dataset)\ngroup_features_dataset.dataf.head(2)\nassert group_features_dataset.version == 1";
                var nbb_formatted_code = "group_features_dataset = GroupStatsPreProcessor().transform(copied_dataset)\ngroup_features_dataset.dataf.head(2)\nassert group_features_dataset.version == 1";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/numerai_blocks/preprocessing.html#GroupStatsPreProcessor"><code>GroupStatsPreProcessor</code></a> should break if <code>version != 1</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_invalid_version</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">):</span>
    <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">copy_dataset</span><span class="p">()</span>
    <span class="n">copied_dataset</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">GroupStatsPreProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">copied_dataset</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="n">test_invalid_version</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="5bae8344-423f-415f-9738-da2598a116c9"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#5bae8344-423f-415f-9738-da2598a116c9');

            setTimeout(function() {
                var nbb_cell_id = 18;
                var nbb_unformatted_code = "def test_invalid_version(dataset: Dataset):\n    copied_dataset = dataset.copy_dataset()\n    copied_dataset.version = 2\n    try:\n        GroupStatsPreProcessor().transform(copied_dataset)\n    except AssertionError:\n        return True\n    return False\n\ntest_invalid_version(dataset);";
                var nbb_formatted_code = "def test_invalid_version(dataset: Dataset):\n    copied_dataset = dataset.copy_dataset()\n    copied_dataset.version = 2\n    try:\n        GroupStatsPreProcessor().transform(copied_dataset)\n    except AssertionError:\n        return True\n    return False\n\n\ntest_invalid_version(dataset)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Custom-preprocessors">2. Custom preprocessors<a class="anchor-link" href="#2.-Custom-preprocessors"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are an almost unlimited number of ways to preprocess data. We have only scratched the surface with the preprocessors currently implemented in <code>numerai-blocks</code>. We invite the Numerai community to develop Numerai Classic and Signals preprocessors for <code>numerai-blocks</code>.</p>
<p>A new Preprocessor should inherit from <a href="/numerai_blocks/preprocessing.html#BaseProcessor"><code>BaseProcessor</code></a> and implement a <code>transform</code> method. The <code>transform</code> method should take a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> as input and return a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> object as output. An example is given below.</p>
<p>To enable fancy logging output. Add the <code>@display_processor_info</code> decorator to the <code>transform</code> method.</p>
<p>Note that arbitrary metadata can be added or changed in a preprocessing step.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">AwesomePreProcessor</span><span class="p">(</span><span class="n">BaseProcessor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - TEMPLATE -</span>
<span class="sd">    Do some awesome preprocessing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AwesomePreProcessor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="nd">@display_processor_info</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="c1"># Do processing</span>
        <span class="o">...</span>
        <span class="c1"># Parse all contents of Dataset to the next pipeline step</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">dataset</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

