---

title: Download


keywords: fastai
sidebar: home_sidebar

summary: "Downloaders for Numerai Classic and Numerai Signals."
description: "Downloaders for Numerai Classic and Numerai Signals."
nb_path: "nbs/00_download.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_download.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.-BaseIO">0. BaseIO<a class="anchor-link" href="#0.-BaseIO"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are common methods needed for <code>Downloaders</code> and <code>Submittors</code>. <a href="/numerai_blocks/download.html#BaseIO"><code>BaseIO</code></a> implements this functionality and allows us to make abstract base classes. Namely, <a href="/numerai_blocks/download.html#BaseDownloader"><code>BaseDownloader</code></a> and <a href="/numerai_blocks/submission.html#BaseSubmittor"><code>BaseSubmittor</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseIO" class="doc_header"><code>class</code> <code>BaseIO</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/download.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseIO</code>(<strong><code>directory_path</code></strong>:<code>str</code>) :: <code>ABC</code></p>
</blockquote>
<p>Basic functionality for IO like downloading and uploading.
:param directory_path: Base folder for IO. Will be created if it does not exist.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="39012cec-b30c-424f-be3d-5e7e02fcf7f7"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#39012cec-b30c-424f-be3d-5e7e02fcf7f7');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "#export\n@typechecked\nclass BaseIO(ABC):\n    \"\"\"\n    Basic functionality for IO like downloading and uploading.\n    :param directory_path: Base folder for IO. Will be created if it does not exist.\n    \"\"\"\n    def __init__(self, directory_path: str):\n        self.dir = Path(directory_path)\n        self._create_directory()\n\n    def remove_base_directory(self):\n        \"\"\" Remove directory with all contents. \"\"\"\n        abs_path = self.dir.resolve()\n        rich_print(f\":warning: [red]Deleting directory for '{self.__class__.__name__}[/red]' :warning:\\nPath: '{abs_path}'\")\n        shutil.rmtree(abs_path)\n\n    def download_file_from_gcs(self, bucket_name: str, local_path: str):\n        blob_path = str(self.dir.resolve())\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=blob_path)\n        blob.download_to_filename(local_path)\n        rich_print(f\":cloud: :page_facing_up: Downloaded GCS object '{blob_path}' from bucket '{blob.bucket.id}' to local file '{local_path}'. :page_facing_up: :cloud:\")\n\n    def upload_file_to_gcs(self, bucket_name: str, gcs_path: str, local_path: str):\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=gcs_path)\n        blob.upload_from_filename(local_path)\n        rich_print(f\":cloud: :page_facing_up: Local file '{local_path}' uploaded to '{gcs_path}' in bucket {blob.bucket.id}:page_facing_up: :cloud:\")\n\n    def download_directory_from_gcs(self, bucket_name: str, gcs_path: str):\n        blob_path = str(self.dir.resolve())\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=blob_path)\n        for gcs_file in glob.glob(gcs_path + '/**', recursive=True):\n            if os.path.isfile(gcs_file):\n                blob.download_to_filename(blob_path)\n        rich_print(f\":cloud: :folder: Directory '{gcs_path}' from bucket '{blob.bucket.id}' downloaded to '{blob_path}' :folder: :cloud:\")\n\n    def upload_directory_to_gcs(self, bucket_name: str, gcs_path: str):\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=gcs_path)\n        for local_path in glob.glob(str(self.dir) + '/**', recursive=True):\n            if os.path.isfile(local_path):\n                blob.upload_from_filename(local_path)\n        rich_print(f\":cloud: :folder: Directory '{self.dir}' uploaded to '{gcs_path}' in bucket {blob.bucket.id} :folder: :cloud:\")\n\n    def _get_gcs_blob(self, bucket_name: str, blob_path: str) -> storage.Blob:\n        \"\"\" Create blob that interacts with Google Cloud Storage (GCS) \"\"\"\n        client = storage.Client()\n        # https://console.cloud.google.com/storage/browser/[bucket-id]/\n        bucket = client.get_bucket(bucket_name)\n        blob = bucket.blob(blob_path)\n        return blob\n\n    def _append_folder(self, folder: str) -> Path:\n        \"\"\"\n        Return base directory Path appended with 'folder'.\n        Create directory if it does not exist.\n        \"\"\"\n        dir = Path(self.dir / folder)\n        dir.mkdir(parents=True, exist_ok=True)\n        return dir\n\n    def _create_directory(self):\n        \"\"\" Create base directory if it does not exist. \"\"\"\n        if not self.dir.is_dir():\n            rich_print(f\"No existing directory found at '[blue]{self.dir}[/blue]'. Creating directory...\")\n            self.dir.mkdir(parents=True, exist_ok=True)\n\n    @property\n    def get_all_files(self) -> list:\n        \"\"\" Return all contents in directory. \"\"\"\n        return list(self.dir.iterdir())\n\n    @property\n    def is_empty(self) -> bool:\n        \"\"\" Check if directory is empty.\"\"\"\n        return not bool(self.get_all_files)";
                var nbb_formatted_code = "# export\n@typechecked\nclass BaseIO(ABC):\n    \"\"\"\n    Basic functionality for IO like downloading and uploading.\n    :param directory_path: Base folder for IO. Will be created if it does not exist.\n    \"\"\"\n\n    def __init__(self, directory_path: str):\n        self.dir = Path(directory_path)\n        self._create_directory()\n\n    def remove_base_directory(self):\n        \"\"\"Remove directory with all contents.\"\"\"\n        abs_path = self.dir.resolve()\n        rich_print(\n            f\":warning: [red]Deleting directory for '{self.__class__.__name__}[/red]' :warning:\\nPath: '{abs_path}'\"\n        )\n        shutil.rmtree(abs_path)\n\n    def download_file_from_gcs(self, bucket_name: str, local_path: str):\n        blob_path = str(self.dir.resolve())\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=blob_path)\n        blob.download_to_filename(local_path)\n        rich_print(\n            f\":cloud: :page_facing_up: Downloaded GCS object '{blob_path}' from bucket '{blob.bucket.id}' to local file '{local_path}'. :page_facing_up: :cloud:\"\n        )\n\n    def upload_file_to_gcs(self, bucket_name: str, gcs_path: str, local_path: str):\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=gcs_path)\n        blob.upload_from_filename(local_path)\n        rich_print(\n            f\":cloud: :page_facing_up: Local file '{local_path}' uploaded to '{gcs_path}' in bucket {blob.bucket.id}:page_facing_up: :cloud:\"\n        )\n\n    def download_directory_from_gcs(self, bucket_name: str, gcs_path: str):\n        blob_path = str(self.dir.resolve())\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=blob_path)\n        for gcs_file in glob.glob(gcs_path + \"/**\", recursive=True):\n            if os.path.isfile(gcs_file):\n                blob.download_to_filename(blob_path)\n        rich_print(\n            f\":cloud: :folder: Directory '{gcs_path}' from bucket '{blob.bucket.id}' downloaded to '{blob_path}' :folder: :cloud:\"\n        )\n\n    def upload_directory_to_gcs(self, bucket_name: str, gcs_path: str):\n        blob = self._get_gcs_blob(bucket_name=bucket_name, blob_path=gcs_path)\n        for local_path in glob.glob(str(self.dir) + \"/**\", recursive=True):\n            if os.path.isfile(local_path):\n                blob.upload_from_filename(local_path)\n        rich_print(\n            f\":cloud: :folder: Directory '{self.dir}' uploaded to '{gcs_path}' in bucket {blob.bucket.id} :folder: :cloud:\"\n        )\n\n    def _get_gcs_blob(self, bucket_name: str, blob_path: str) -> storage.Blob:\n        \"\"\"Create blob that interacts with Google Cloud Storage (GCS)\"\"\"\n        client = storage.Client()\n        # https://console.cloud.google.com/storage/browser/[bucket-id]/\n        bucket = client.get_bucket(bucket_name)\n        blob = bucket.blob(blob_path)\n        return blob\n\n    def _append_folder(self, folder: str) -> Path:\n        \"\"\"\n        Return base directory Path appended with 'folder'.\n        Create directory if it does not exist.\n        \"\"\"\n        dir = Path(self.dir / folder)\n        dir.mkdir(parents=True, exist_ok=True)\n        return dir\n\n    def _create_directory(self):\n        \"\"\"Create base directory if it does not exist.\"\"\"\n        if not self.dir.is_dir():\n            rich_print(\n                f\"No existing directory found at '[blue]{self.dir}[/blue]'. Creating directory...\"\n            )\n            self.dir.mkdir(parents=True, exist_ok=True)\n\n    @property\n    def get_all_files(self) -> list:\n        \"\"\"Return all contents in directory.\"\"\"\n        return list(self.dir.iterdir())\n\n    @property\n    def is_empty(self) -> bool:\n        \"\"\"Check if directory is empty.\"\"\"\n        return not bool(self.get_all_files)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-BaseDownloader">1. BaseDownloader<a class="anchor-link" href="#1.-BaseDownloader"> </a></h2><p><a href="/numerai_blocks/download.html#BaseDownloader"><code>BaseDownloader</code></a> is an object which implements logic common to all downloaders.</p>
<p>To implement a new Downloader, you should inherit from <a href="/numerai_blocks/download.html#BaseDownloader"><code>BaseDownloader</code></a> and be sure to implement at least methods <code>download_training_data</code> and <code>download_inference_data</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseDownloader" class="doc_header"><code>class</code> <code>BaseDownloader</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/download.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseDownloader</code>(<strong><code>directory_path</code></strong>:<code>str</code>) :: <a href="/numerai_blocks/download.html#BaseIO"><code>BaseIO</code></a></p>
</blockquote>
<p>Abstract base class for downloaders.
:param directory_path: Base folder to download files to.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="6937acda-2731-401f-9daf-0be9741c598a"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#6937acda-2731-401f-9daf-0be9741c598a');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "#export\n@typechecked\nclass BaseDownloader(BaseIO):\n    \"\"\"\n    Abstract base class for downloaders.\n    :param directory_path: Base folder to download files to.\n    \"\"\"\n    def __init__(self, directory_path: str):\n        super(BaseDownloader, self).__init__(directory_path=directory_path)\n\n    @abstractmethod\n    def download_training_data(self, *args, **kwargs):\n        \"\"\" Download all necessary files needed for training. \"\"\"\n        ...\n\n    @abstractmethod\n    def download_inference_data(self, *args, **kwargs):\n        \"\"\" Download minimal amount of files needed for weekly inference. \"\"\"\n        ...\n\n    @staticmethod\n    def _load_json(file_path: str, verbose = False, *args, **kwargs) -> dict:\n        \"\"\" Load JSON from file and return as dictionary. \"\"\"\n        with open(file_path) as json_file:\n            json_data = json.load(json_file, *args, **kwargs)\n        if verbose:\n            rich_print(json_data)\n        return json_data\n\n    def __call__(self, *args, **kwargs):\n        \"\"\"\n        The most common use case will be to get weekly inference data. So calling the class itself returns inference data.\n        \"\"\"\n        self.download_inference_data(*args, **kwargs)";
                var nbb_formatted_code = "# export\n@typechecked\nclass BaseDownloader(BaseIO):\n    \"\"\"\n    Abstract base class for downloaders.\n    :param directory_path: Base folder to download files to.\n    \"\"\"\n\n    def __init__(self, directory_path: str):\n        super(BaseDownloader, self).__init__(directory_path=directory_path)\n\n    @abstractmethod\n    def download_training_data(self, *args, **kwargs):\n        \"\"\"Download all necessary files needed for training.\"\"\"\n        ...\n\n    @abstractmethod\n    def download_inference_data(self, *args, **kwargs):\n        \"\"\"Download minimal amount of files needed for weekly inference.\"\"\"\n        ...\n\n    @staticmethod\n    def _load_json(file_path: str, verbose=False, *args, **kwargs) -> dict:\n        \"\"\"Load JSON from file and return as dictionary.\"\"\"\n        with open(file_path) as json_file:\n            json_data = json.load(json_file, *args, **kwargs)\n        if verbose:\n            rich_print(json_data)\n        return json_data\n\n    def __call__(self, *args, **kwargs):\n        \"\"\"\n        The most common use case will be to get weekly inference data. So calling the class itself returns inference data.\n        \"\"\"\n        self.download_inference_data(*args, **kwargs)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Numerai-Classic">2. Numerai Classic<a class="anchor-link" href="#2.-Numerai-Classic"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NumeraiClassicDownloader" class="doc_header"><code>class</code> <code>NumeraiClassicDownloader</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/download.py#L164" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NumeraiClassicDownloader</code>(<strong><code>directory_path</code></strong>:<code>str</code>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/download.html#BaseDownloader"><code>BaseDownloader</code></a></p>
</blockquote>
<p>Downloading from NumerAPI for Numerai Classic data</p>
<p>:param directory_path: Base folder to download files to.
All *args, **kwargs will be passed to NumerAPI initialization.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="ee46eabc-d58e-4c2f-b0ca-1db6cdcd88f8"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#ee46eabc-d58e-4c2f-b0ca-1db6cdcd88f8');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "#export\nclass NumeraiClassicDownloader(BaseDownloader):\n    \"\"\"\n    Downloading from NumerAPI for Numerai Classic data\n\n    :param directory_path: Base folder to download files to.\n    All *args, **kwargs will be passed to NumerAPI initialization.\n    \"\"\"\n    def __init__(self, directory_path: str, *args, **kwargs):\n        super(NumeraiClassicDownloader, self).__init__(directory_path=directory_path)\n        self.napi = NumerAPI(*args, **kwargs)\n        self.current_round = self.napi.get_current_round()\n        # NumerAPI filenames corresponding to version, class and data type\n        self.version_mapping = {1: {\"train\":\n                                        {\"int8\": ['numerai_training_data_int8.csv', 'numerai_validation_data_int8.csv'],\n                                         \"float\": ['numerai_training_data.csv', 'numerai_validation_data.csv']},\n                                    \"inference\": {\"int8\": ['numerai_tournament_data_int8.csv'],\n                                                  \"float\": ['numerai_tournament_data.csv']},\n                                    \"example\": ['example_predictions.csv', 'example_validation_predictions.csv']},\n                                2: {\"train\":\n                                        {\"int8\": ['numerai_training_data_int8.parquet', 'numerai_validation_data_int8.parquet'],\n                                         \"float\": ['numerai_training_data.parquet', 'numerai_validation_data.parquet']},\n                                    \"inference\": {\"int8\": ['numerai_tournament_data_int8.parquet'],\n                                                  \"float\": ['numerai_tournament_data.parquet']},\n                                    \"example\": ['example_predictions.parquet', 'example_validation_predictions.parquet']}\n                                }\n\n    def download_training_data(self, subfolder: str = \"\", version: int = 2, int8: bool = False):\n        \"\"\"\n        Get Numerai classic training and validation data.\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        :param version: Numerai version (1=classic, 2=super massive dataset (parquet)\n        :param int8: Integer version of data\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        data_type = \"int8\" if int8 else \"float\"\n        train_val_files = self._get_version_mapping(version)['train'][data_type]\n        for file in train_val_files:\n            self.download_single_dataset(filename=file,\n                                         dest_path=str(dir.joinpath(file)))\n\n\n    def download_inference_data(self, subfolder: str = \"\", version: int = 2, int8: bool = False, round_num: int = None):\n        \"\"\"\n        Get Numerai classic inference data.\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        :param version: Numerai version (1=classic, 2=super massive dataset (parquet)\n        :param int8: Integer version of data\n        :param round_num: Numerai tournament round number. Downloads latest round by default.\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        data_type = \"int8\" if int8 else \"float\"\n        inference_files = self._get_version_mapping(version)['inference'][data_type]\n        rich_print(f\":file_folder: [green]Downloading inference data for round[/green] '{round_num if round_num else self.current_round}'.\")\n        for file in inference_files:\n            self.download_single_dataset(filename=file,\n                                         dest_path=str(dir.joinpath(file)),\n                                         round_num=round_num)\n\n    def download_single_dataset(self, filename: str, dest_path: str, round_num: int = None):\n        \"\"\"\n        Download one of the available datasets through NumerAPI.\n\n        :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets())\n        :param dest_path: Full path where file will be saved.\n        :param round_num: Numerai tournament round number. Downloads latest round by default.\n        \"\"\"\n        assert filename in self.napi.list_datasets(), f\"Dataset '{filename}' not available in NumerAPI. Available datasets are {self.napi.list_datasets()}.\"\n        rich_print(f\":file_folder: [green]Downloading[/green] '{filename}' :file_folder:\")\n        self.napi.download_dataset(filename=filename,\n                                   dest_path=dest_path,\n                                   round_num=round_num)\n\n\n    def download_example_data(self, subfolder: str = \"\", version: int = 2, round_num: int = None):\n        \"\"\"\n        Download all example prediction data in specified folder for given version.\n\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        :param version: Numerai version (1=classic, 2=super massive dataset (parquet)\n        :param round_num: Numerai tournament round number. Downloads latest round by default.\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        example_files = self._get_version_mapping(version)['example']\n        for file in example_files:\n            self.download_single_dataset(filename=file,\n                                         dest_path=str(dir.joinpath(file)),\n                                         round_num=round_num)\n\n    def get_classic_features(self, subfolder: str = \"\", *args, **kwargs) -> dict:\n        \"\"\"\n        Download feature overview (stats and feature sets) through NumerAPI and load.\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        *args, **kwargs will be passed to the JSON loader.\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        filename = \"features.json\"\n        dest_path = str(dir.joinpath(filename))\n        self.download_single_dataset(filename=filename,\n                                     dest_path=dest_path)\n        json_data = self._load_json(dest_path, *args, **kwargs)\n        return json_data\n\n    def _get_version_mapping(self, version: int) -> dict:\n        \"\"\" Check if version is supported and return file mapping for version. \"\"\"\n        try:\n            mapping_dictionary = self.version_mapping[version]\n        except KeyError:\n            raise NotImplementedError(f\"Version '{version}' is not implemented. Available versions are {list(self.version_mapping.keys())}\")\n        return mapping_dictionary";
                var nbb_formatted_code = "# export\nclass NumeraiClassicDownloader(BaseDownloader):\n    \"\"\"\n    Downloading from NumerAPI for Numerai Classic data\n\n    :param directory_path: Base folder to download files to.\n    All *args, **kwargs will be passed to NumerAPI initialization.\n    \"\"\"\n\n    def __init__(self, directory_path: str, *args, **kwargs):\n        super(NumeraiClassicDownloader, self).__init__(directory_path=directory_path)\n        self.napi = NumerAPI(*args, **kwargs)\n        self.current_round = self.napi.get_current_round()\n        # NumerAPI filenames corresponding to version, class and data type\n        self.version_mapping = {\n            1: {\n                \"train\": {\n                    \"int8\": [\n                        \"numerai_training_data_int8.csv\",\n                        \"numerai_validation_data_int8.csv\",\n                    ],\n                    \"float\": [\n                        \"numerai_training_data.csv\",\n                        \"numerai_validation_data.csv\",\n                    ],\n                },\n                \"inference\": {\n                    \"int8\": [\"numerai_tournament_data_int8.csv\"],\n                    \"float\": [\"numerai_tournament_data.csv\"],\n                },\n                \"example\": [\n                    \"example_predictions.csv\",\n                    \"example_validation_predictions.csv\",\n                ],\n            },\n            2: {\n                \"train\": {\n                    \"int8\": [\n                        \"numerai_training_data_int8.parquet\",\n                        \"numerai_validation_data_int8.parquet\",\n                    ],\n                    \"float\": [\n                        \"numerai_training_data.parquet\",\n                        \"numerai_validation_data.parquet\",\n                    ],\n                },\n                \"inference\": {\n                    \"int8\": [\"numerai_tournament_data_int8.parquet\"],\n                    \"float\": [\"numerai_tournament_data.parquet\"],\n                },\n                \"example\": [\n                    \"example_predictions.parquet\",\n                    \"example_validation_predictions.parquet\",\n                ],\n            },\n        }\n\n    def download_training_data(\n        self, subfolder: str = \"\", version: int = 2, int8: bool = False\n    ):\n        \"\"\"\n        Get Numerai classic training and validation data.\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        :param version: Numerai version (1=classic, 2=super massive dataset (parquet)\n        :param int8: Integer version of data\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        data_type = \"int8\" if int8 else \"float\"\n        train_val_files = self._get_version_mapping(version)[\"train\"][data_type]\n        for file in train_val_files:\n            self.download_single_dataset(\n                filename=file, dest_path=str(dir.joinpath(file))\n            )\n\n    def download_inference_data(\n        self,\n        subfolder: str = \"\",\n        version: int = 2,\n        int8: bool = False,\n        round_num: int = None,\n    ):\n        \"\"\"\n        Get Numerai classic inference data.\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        :param version: Numerai version (1=classic, 2=super massive dataset (parquet)\n        :param int8: Integer version of data\n        :param round_num: Numerai tournament round number. Downloads latest round by default.\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        data_type = \"int8\" if int8 else \"float\"\n        inference_files = self._get_version_mapping(version)[\"inference\"][data_type]\n        rich_print(\n            f\":file_folder: [green]Downloading inference data for round[/green] '{round_num if round_num else self.current_round}'.\"\n        )\n        for file in inference_files:\n            self.download_single_dataset(\n                filename=file, dest_path=str(dir.joinpath(file)), round_num=round_num\n            )\n\n    def download_single_dataset(\n        self, filename: str, dest_path: str, round_num: int = None\n    ):\n        \"\"\"\n        Download one of the available datasets through NumerAPI.\n\n        :param filename: Name as listed in NumerAPI (Check NumerAPI().list_datasets())\n        :param dest_path: Full path where file will be saved.\n        :param round_num: Numerai tournament round number. Downloads latest round by default.\n        \"\"\"\n        assert (\n            filename in self.napi.list_datasets()\n        ), f\"Dataset '{filename}' not available in NumerAPI. Available datasets are {self.napi.list_datasets()}.\"\n        rich_print(\n            f\":file_folder: [green]Downloading[/green] '{filename}' :file_folder:\"\n        )\n        self.napi.download_dataset(\n            filename=filename, dest_path=dest_path, round_num=round_num\n        )\n\n    def download_example_data(\n        self, subfolder: str = \"\", version: int = 2, round_num: int = None\n    ):\n        \"\"\"\n        Download all example prediction data in specified folder for given version.\n\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        :param version: Numerai version (1=classic, 2=super massive dataset (parquet)\n        :param round_num: Numerai tournament round number. Downloads latest round by default.\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        example_files = self._get_version_mapping(version)[\"example\"]\n        for file in example_files:\n            self.download_single_dataset(\n                filename=file, dest_path=str(dir.joinpath(file)), round_num=round_num\n            )\n\n    def get_classic_features(self, subfolder: str = \"\", *args, **kwargs) -> dict:\n        \"\"\"\n        Download feature overview (stats and feature sets) through NumerAPI and load.\n        :param subfolder: Specify folder to create folder within directory root. Saves in directory root by default.\n        *args, **kwargs will be passed to the JSON loader.\n        \"\"\"\n        dir = self._append_folder(subfolder)\n        filename = \"features.json\"\n        dest_path = str(dir.joinpath(filename))\n        self.download_single_dataset(filename=filename, dest_path=dest_path)\n        json_data = self._load_json(dest_path, *args, **kwargs)\n        return json_data\n\n    def _get_version_mapping(self, version: int) -> dict:\n        \"\"\"Check if version is supported and return file mapping for version.\"\"\"\n        try:\n            mapping_dictionary = self.version_mapping[version]\n        except KeyError:\n            raise NotImplementedError(\n                f\"Version '{version}' is not implemented. Available versions are {list(self.version_mapping.keys())}\"\n            )\n        return mapping_dictionary";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BaseDownloader-and-NumeraiClassicDownlaoder--tests">BaseDownloader and NumeraiClassicDownlaoder  tests<a class="anchor-link" href="#BaseDownloader-and-NumeraiClassicDownlaoder--tests"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dir_classic</span> <span class="o">=</span> <span class="s2">&quot;test_numclassic_general&quot;</span>
<span class="n">numer_classic_downloader</span> <span class="o">=</span> <span class="n">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">test_dir_classic</span><span class="p">)</span>

<span class="c1"># Test building class</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">PosixPath</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>

<span class="c1"># Test is_empty</span>
<span class="p">(</span><span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">dir</span> <span class="o">/</span> <span class="s2">&quot;test.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">rich_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory contents:</span><span class="se">\n</span><span class="si">{</span><span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">get_all_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">is_empty</span>

<span class="c1"># Downloading example data</span>
<span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">download_example_data</span><span class="p">(</span><span class="s2">&quot;test1/&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">download_example_data</span><span class="p">(</span><span class="s2">&quot;test2/&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="mi">290</span><span class="p">)</span>

<span class="c1"># Features</span>
<span class="n">feature_stats_test</span> <span class="o">=</span> <span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">get_classic_features</span><span class="p">()</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_stats_test</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_stats_test</span><span class="p">[</span><span class="s2">&quot;feature_sets&quot;</span><span class="p">][</span><span class="s2">&quot;legacy&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">304</span>

<span class="c1"># Remove contents</span>
<span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_dir_classic</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">No existing directory found at <span style="color: #008000; text-decoration-color: #008000">'</span><span style="color: #000080; text-decoration-color: #000080">test_numclassic_general</span><span style="color: #008000; text-decoration-color: #008000">'</span>. Creating directory<span style="color: #808000; text-decoration-color: #808000">...</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Directory contents:
<span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Path</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'test_numclassic_general/test.txt'</span><span style="font-weight: bold">)]</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'example_predictions.csv'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:22:31,112 INFO numerapi.utils: starting download
test_numclassic_general/test1/example_predictions.csv: 51.2MB [01:37, 524kB/s]                             
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'example_validation_predictions.csv'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:24:10,653 INFO numerapi.utils: starting download
test_numclassic_general/test1/example_validation_predictions.csv: 19.6MB [01:36, 202kB/s]                             
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'example_predictions.parquet'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:25:50,044 INFO numerapi.utils: starting download
test_numclassic_general/test2/example_predictions.parquet: 33.5MB [01:24, 398kB/s]                             
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'example_validation_predictions.parquet'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:27:16,150 INFO numerapi.utils: starting download
test_numclassic_general/test2/example_validation_predictions.parquet: 13.0MB [00:46, 280kB/s]                             
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'features.json'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:28:04,428 INFO numerapi.utils: starting download
test_numclassic_general/features.json: 441kB [00:00, 566kB/s]                             
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">⚠ <span style="color: #800000; text-decoration-color: #800000">Deleting directory for </span><span style="color: #800000; text-decoration-color: #800000">'NumeraiClassicDownloader</span><span style="color: #008000; text-decoration-color: #008000">'</span> ⚠
Path: 
<span style="color: #008000; text-decoration-color: #008000">'/Users/clepelaars/Desktop/crowdcent/repositories/numerai-blocks/nbs/test_numclassic_general'</span>
</pre>

</div>

</div>

<div class="output_area">




<div id="6d2f29f1-6f3c-42b0-b206-1da60fedfef3"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#6d2f29f1-6f3c-42b0-b206-1da60fedfef3');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "#slow\ntest_dir_classic = \"test_numclassic_general\"\nnumer_classic_downloader = NumeraiClassicDownloader(test_dir_classic)\n\n# Test building class\nassert isinstance(numer_classic_downloader.dir, PosixPath)\nassert numer_classic_downloader.dir.is_dir()\n\n# Test is_empty\n(numer_classic_downloader.dir / \"test.txt\").write_text(\"test\")\nrich_print(f\"Directory contents:\\n{numer_classic_downloader.get_all_files}\")\nassert not numer_classic_downloader.is_empty\n\n# Downloading example data\nnumer_classic_downloader.download_example_data(\"test1/\", version=1)\nnumer_classic_downloader.download_example_data(\"test2/\", version=2, round_num=290)\n\n# Features\nfeature_stats_test = numer_classic_downloader.get_classic_features()\nassert isinstance(feature_stats_test, dict)\nassert len(feature_stats_test['feature_sets']['legacy']) == 304\n\n# Remove contents\nnumer_classic_downloader.remove_base_directory()\nassert not os.path.exists(test_dir_classic)";
                var nbb_formatted_code = "# slow\ntest_dir_classic = \"test_numclassic_general\"\nnumer_classic_downloader = NumeraiClassicDownloader(test_dir_classic)\n\n# Test building class\nassert isinstance(numer_classic_downloader.dir, PosixPath)\nassert numer_classic_downloader.dir.is_dir()\n\n# Test is_empty\n(numer_classic_downloader.dir / \"test.txt\").write_text(\"test\")\nrich_print(f\"Directory contents:\\n{numer_classic_downloader.get_all_files}\")\nassert not numer_classic_downloader.is_empty\n\n# Downloading example data\nnumer_classic_downloader.download_example_data(\"test1/\", version=1)\nnumer_classic_downloader.download_example_data(\"test2/\", version=2, round_num=290)\n\n# Features\nfeature_stats_test = numer_classic_downloader.get_classic_features()\nassert isinstance(feature_stats_test, dict)\nassert len(feature_stats_test[\"feature_sets\"][\"legacy\"]) == 304\n\n# Remove contents\nnumer_classic_downloader.remove_base_directory()\nassert not os.path.exists(test_dir_classic)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-usage">Example usage<a class="anchor-link" href="#Example-usage"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Training">Training<a class="anchor-link" href="#Training"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initialization</span>
<span class="n">train_base_directory</span> <span class="o">=</span> <span class="s2">&quot;test_numclassic_train&quot;</span>
<span class="n">numer_classic_downloader</span> <span class="o">=</span> <span class="n">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">train_base_directory</span><span class="p">)</span>

<span class="c1"># Uncomment line below to download training and validation data.</span>
<span class="c1"># numer_classic_downloader.download_training_data(&quot;train_val&quot;, version=2, int8=False)</span>

<span class="c1"># Get feature overview</span>
<span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">get_classic_features</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">No existing directory found at <span style="color: #008000; text-decoration-color: #008000">'</span><span style="color: #000080; text-decoration-color: #000080">test_numclassic_train</span><span style="color: #008000; text-decoration-color: #008000">'</span>. Creating directory<span style="color: #808000; text-decoration-color: #808000">...</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'features.json'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:28:07,196 INFO numerapi.utils: starting download
test_numclassic_train/features.json: 441kB [00:01, 389kB/s]                             
</pre>
</div>
</div>

<div class="output_area">




<div id="5e9801f5-1c41-4b5e-a5a6-572e846daec1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#5e9801f5-1c41-4b5e-a5a6-572e846daec1');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "#slow\n# Initialization\ntrain_base_directory = \"test_numclassic_train\"\nnumer_classic_downloader = NumeraiClassicDownloader(train_base_directory)\n\n# Uncomment line below to download training and validation data.\n# numer_classic_downloader.download_training_data(\"train_val\", version=2, int8=False)\n\n# Get feature overview\nnumer_classic_downloader.get_classic_features();";
                var nbb_formatted_code = "# slow\n# Initialization\ntrain_base_directory = \"test_numclassic_train\"\nnumer_classic_downloader = NumeraiClassicDownloader(train_base_directory)\n\n# Uncomment line below to download training and validation data.\n# numer_classic_downloader.download_training_data(\"train_val\", version=2, int8=False)\n\n# Get feature overview\nnumer_classic_downloader.get_classic_features()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>For the training example the directory structure will be:</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 test_numclassic_train (base_directory)                                                           
<span style="color: #808080; text-decoration-color: #808080">┣━━ </span>📄 features.json                                                                                
<span style="color: #808080; text-decoration-color: #808080">┗━━ </span>📁 train_val                                                                                    
<span style="color: #808080; text-decoration-color: #808080">    ┣━━ </span>📄 numerai_training_data.parquet                                                            
<span style="color: #808080; text-decoration-color: #808080">    ┗━━ </span>📄 numerai_validation_data.parquet                                                          
</pre>

</div>

</div>

<div class="output_area">




<div id="0cf505b2-50c0-4f8b-a1bd-d06a85cad96e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#0cf505b2-50c0-4f8b-a1bd-d06a85cad96e');

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "#hide_input\nconsole = Console(record=True, width=100)\n\ntree = Tree(f\":file_folder: {train_base_directory} (base_directory)\", guide_style=\"bold bright_black\")\nfolder_tree = tree.add(\":page_facing_up: features.json\")\ntrain_val_tree = tree.add(\":file_folder: train_val\")\ntrain_val_tree.add(':page_facing_up: numerai_training_data.parquet')\ntrain_val_tree.add(':page_facing_up: numerai_validation_data.parquet')\n\nconsole.print(tree)";
                var nbb_formatted_code = "# hide_input\nconsole = Console(record=True, width=100)\n\ntree = Tree(\n    f\":file_folder: {train_base_directory} (base_directory)\",\n    guide_style=\"bold bright_black\",\n)\nfolder_tree = tree.add(\":page_facing_up: features.json\")\ntrain_val_tree = tree.add(\":file_folder: train_val\")\ntrain_val_tree.add(\":page_facing_up: numerai_training_data.parquet\")\ntrain_val_tree.add(\":page_facing_up: numerai_validation_data.parquet\")\n\nconsole.print(tree)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># initialization</span>
<span class="n">inference_base_directory</span> <span class="o">=</span> <span class="s2">&quot;test_numclassic_inference&quot;</span>
<span class="n">numer_classic_downloader</span> <span class="o">=</span> <span class="n">NumeraiClassicDownloader</span><span class="p">(</span><span class="n">inference_base_directory</span><span class="p">)</span>

<span class="c1"># Download tournament (inference) data</span>
<span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">download_inference_data</span><span class="p">(</span><span class="s2">&quot;inference&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">int8</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Remove folder when done with inference</span>
<span class="n">numer_classic_downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">No existing directory found at <span style="color: #008000; text-decoration-color: #008000">'</span><span style="color: #000080; text-decoration-color: #000080">test_numclassic_inference</span><span style="color: #008000; text-decoration-color: #008000">'</span>. Creating directory<span style="color: #808000; text-decoration-color: #808000">...</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading inference data for round</span> <span style="color: #008000; text-decoration-color: #008000">'298'</span>.
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'numerai_tournament_data.parquet'</span> 📁
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-01-09 22:28:10,501 INFO numerapi.utils: starting download
test_numclassic_inference/inference/numerai_tournament_data.parquet:  18%|█▊        | 106M/582M [02:46&lt;27:35, 288kB/s]    </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/d5/1qd2ftjn7ts_5_k6w2k2g4c00000gn/T/ipykernel_3537/2919954469.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> 
<span class="ansi-green-intense-fg ansi-bold">      6</span> <span class="ansi-red-fg"># Download tournament (inference) data</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>numer_classic_downloader<span class="ansi-blue-fg">.</span>download_inference_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;inference&#34;</span><span class="ansi-blue-fg">,</span> version<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> int8<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> 
<span class="ansi-green-intense-fg ansi-bold">      9</span> <span class="ansi-red-fg"># Remove folder when done with inference</span>

<span class="ansi-green-fg">/var/folders/d5/1qd2ftjn7ts_5_k6w2k2g4c00000gn/T/ipykernel_3537/71534705.py</span> in <span class="ansi-cyan-fg">download_inference_data</span><span class="ansi-blue-fg">(self, subfolder, version, int8, round_num)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>         rich_print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#34;:file_folder: [green]Downloading inference data for round[/green] &#39;{round_num if round_num else self.current_round}&#39;.&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         <span class="ansi-green-fg">for</span> file <span class="ansi-green-fg">in</span> inference_files<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 56</span><span class="ansi-red-fg">             self.download_single_dataset(filename=file,
</span><span class="ansi-green-intense-fg ansi-bold">     57</span>                                          dest_path<span class="ansi-blue-fg">=</span>str<span class="ansi-blue-fg">(</span>dir<span class="ansi-blue-fg">.</span>joinpath<span class="ansi-blue-fg">(</span>file<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     58</span>                                          round_num=round_num)

<span class="ansi-green-fg">/var/folders/d5/1qd2ftjn7ts_5_k6w2k2g4c00000gn/T/ipykernel_3537/71534705.py</span> in <span class="ansi-cyan-fg">download_single_dataset</span><span class="ansi-blue-fg">(self, filename, dest_path, round_num)</span>
<span class="ansi-green-intense-fg ansi-bold">     68</span>         <span class="ansi-green-fg">assert</span> filename <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>napi<span class="ansi-blue-fg">.</span>list_datasets<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">f&#34;Dataset &#39;{filename}&#39; not available in NumerAPI. Available datasets are {self.napi.list_datasets()}.&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     69</span>         rich_print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#34;:file_folder: [green]Downloading[/green] &#39;{filename}&#39; :file_folder:&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 70</span><span class="ansi-red-fg">         self.napi.download_dataset(filename=filename,
</span><span class="ansi-green-intense-fg ansi-bold">     71</span>                                    dest_path<span class="ansi-blue-fg">=</span>dest_path<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     72</span>                                    round_num=round_num)

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/site-packages/numerapi/numerapi.py</span> in <span class="ansi-cyan-fg">download_dataset</span><span class="ansi-blue-fg">(self, filename, dest_path, round_num)</span>
<span class="ansi-green-intense-fg ansi-bold">    103</span> 
<span class="ansi-green-intense-fg ansi-bold">    104</span>         dataset_url <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>raw_query<span class="ansi-blue-fg">(</span>query<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;data&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;dataset&#39;</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 105</span><span class="ansi-red-fg">         </span>utils<span class="ansi-blue-fg">.</span>download_file<span class="ansi-blue-fg">(</span>dataset_url<span class="ansi-blue-fg">,</span> dest_path<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>show_progress_bars<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    106</span> 
<span class="ansi-green-intense-fg ansi-bold">    107</span>     <span class="ansi-green-fg">def</span> get_dataset_url<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> tournament<span class="ansi-blue-fg">:</span> int <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> str<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/site-packages/numerapi/utils.py</span> in <span class="ansi-cyan-fg">download_file</span><span class="ansi-blue-fg">(url, dest_path, show_progress_bars)</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>     pbar<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span>file_size<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     77</span>     <span class="ansi-green-fg">with</span> open<span class="ansi-blue-fg">(</span>dest_path<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;ab&#34;</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> dest_file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 78</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> chunk <span class="ansi-green-fg">in</span> req<span class="ansi-blue-fg">.</span>iter_content<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1024</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>             dest_file<span class="ansi-blue-fg">.</span>write<span class="ansi-blue-fg">(</span>chunk<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>             pbar<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1024</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/site-packages/requests/models.py</span> in <span class="ansi-cyan-fg">generate</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">    758</span>             <span class="ansi-green-fg">if</span> hasattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>raw<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;stream&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    759</span>                 <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 760</span><span class="ansi-red-fg">                     </span><span class="ansi-green-fg">for</span> chunk <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>raw<span class="ansi-blue-fg">.</span>stream<span class="ansi-blue-fg">(</span>chunk_size<span class="ansi-blue-fg">,</span> decode_content<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    761</span>                         <span class="ansi-green-fg">yield</span> chunk
<span class="ansi-green-intense-fg ansi-bold">    762</span>                 <span class="ansi-green-fg">except</span> ProtocolError <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/site-packages/urllib3/response.py</span> in <span class="ansi-cyan-fg">stream</span><span class="ansi-blue-fg">(self, amt, decode_content)</span>
<span class="ansi-green-intense-fg ansi-bold">    574</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    575</span>             <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">not</span> is_fp_closed<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_fp<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 576</span><span class="ansi-red-fg">                 </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>amt<span class="ansi-blue-fg">=</span>amt<span class="ansi-blue-fg">,</span> decode_content<span class="ansi-blue-fg">=</span>decode_content<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    577</span> 
<span class="ansi-green-intense-fg ansi-bold">    578</span>                 <span class="ansi-green-fg">if</span> data<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/site-packages/urllib3/response.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self, amt, decode_content, cache_content)</span>
<span class="ansi-green-intense-fg ansi-bold">    517</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    518</span>                 cache_content <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">False</span>
<span class="ansi-green-fg">--&gt; 519</span><span class="ansi-red-fg">                 </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_fp<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>amt<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> fp_closed <span class="ansi-green-fg">else</span> <span class="ansi-blue-fg">b&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    520</span>                 if (
<span class="ansi-green-intense-fg ansi-bold">    521</span>                     amt <span class="ansi-blue-fg">!=</span> <span class="ansi-cyan-fg">0</span> <span class="ansi-green-fg">and</span> <span class="ansi-green-fg">not</span> data

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/http/client.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self, amt)</span>
<span class="ansi-green-intense-fg ansi-bold">    460</span>             <span class="ansi-red-fg"># Amount is given, implement using readinto</span>
<span class="ansi-green-intense-fg ansi-bold">    461</span>             b <span class="ansi-blue-fg">=</span> bytearray<span class="ansi-blue-fg">(</span>amt<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 462</span><span class="ansi-red-fg">             </span>n <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>readinto<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    463</span>             <span class="ansi-green-fg">return</span> memoryview<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span>n<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>tobytes<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    464</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/http/client.py</span> in <span class="ansi-cyan-fg">readinto</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">    504</span>         <span class="ansi-red-fg"># connection, and the user is reading more bytes than will be provided</span>
<span class="ansi-green-intense-fg ansi-bold">    505</span>         <span class="ansi-red-fg"># (for example, reading in 1k chunks)</span>
<span class="ansi-green-fg">--&gt; 506</span><span class="ansi-red-fg">         </span>n <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>fp<span class="ansi-blue-fg">.</span>readinto<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    507</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> n <span class="ansi-green-fg">and</span> b<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    508</span>             <span class="ansi-red-fg"># Ideally, we would raise IncompleteRead if the content-length</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/socket.py</span> in <span class="ansi-cyan-fg">readinto</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">    702</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    703</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 704</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sock<span class="ansi-blue-fg">.</span>recv_into<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    705</span>             <span class="ansi-green-fg">except</span> timeout<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    706</span>                 self<span class="ansi-blue-fg">.</span>_timeout_occurred <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/ssl.py</span> in <span class="ansi-cyan-fg">recv_into</span><span class="ansi-blue-fg">(self, buffer, nbytes, flags)</span>
<span class="ansi-green-intense-fg ansi-bold">   1239</span>                   <span class="ansi-blue-fg">&#34;non-zero flags not allowed in calls to recv_into() on %s&#34;</span> <span class="ansi-blue-fg">%</span>
<span class="ansi-green-intense-fg ansi-bold">   1240</span>                   self.__class__)
<span class="ansi-green-fg">-&gt; 1241</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>nbytes<span class="ansi-blue-fg">,</span> buffer<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1242</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1243</span>             <span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>recv_into<span class="ansi-blue-fg">(</span>buffer<span class="ansi-blue-fg">,</span> nbytes<span class="ansi-blue-fg">,</span> flags<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/anaconda3/envs/numerai-blocks39/lib/python3.9/ssl.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self, len, buffer)</span>
<span class="ansi-green-intense-fg ansi-bold">   1097</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1098</span>             <span class="ansi-green-fg">if</span> buffer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1099</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sslobj<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">,</span> buffer<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1100</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1101</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sslobj<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

<div class="output_area">




<div id="32cbeb0b-b388-4c5e-b6e2-b11596f79e4d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#32cbeb0b-b388-4c5e-b6e2-b11596f79e4d');

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "#slow\n# initialization\ninference_base_directory = \"test_numclassic_inference\"\nnumer_classic_downloader = NumeraiClassicDownloader(inference_base_directory)\n\n# Download tournament (inference) data\nnumer_classic_downloader.download_inference_data(\"inference\", version=2, int8=False)\n\n# Remove folder when done with inference\nnumer_classic_downloader.remove_base_directory()";
                var nbb_formatted_code = "# slow\n# initialization\ninference_base_directory = \"test_numclassic_inference\"\nnumer_classic_downloader = NumeraiClassicDownloader(inference_base_directory)\n\n# Download tournament (inference) data\nnumer_classic_downloader.download_inference_data(\"inference\", version=2, int8=False)\n\n# Remove folder when done with inference\nnumer_classic_downloader.remove_base_directory()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>For the inference example the directory structure will be:</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 test_numclassic_inference (base_directory)                                                       
<span style="color: #808080; text-decoration-color: #808080">┗━━ </span>📁 inference                                                                                    
<span style="color: #808080; text-decoration-color: #808080">    ┗━━ </span>📄 numerai_tournament_data.parquet                                                          
</pre>

</div>

</div>

<div class="output_area">




<div id="972df99b-3a1e-4f19-8077-4767dff65d83"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#972df99b-3a1e-4f19-8077-4767dff65d83');

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "#hide_input\nconsole = Console(record=True, width=100)\n\ntree = Tree(f\":file_folder: {inference_base_directory} (base_directory)\", guide_style=\"bold bright_black\")\ninference_tree = tree.add(\":file_folder: inference\")\ninference_tree.add(':page_facing_up: numerai_tournament_data.parquet')\n\nconsole.print(tree)";
                var nbb_formatted_code = "# hide_input\nconsole = Console(record=True, width=100)\n\ntree = Tree(\n    f\":file_folder: {inference_base_directory} (base_directory)\",\n    guide_style=\"bold bright_black\",\n)\ninference_tree = tree.add(\":file_folder: inference\")\ninference_tree.add(\":page_facing_up: numerai_tournament_data.parquet\")\n\nconsole.print(tree)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3.-Yahoo-Finance">3. Yahoo Finance<a class="anchor-link" href="#3.-Yahoo-Finance"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Use <a href="https://github.com/councilofelders/opensignals">opensignals</a> to download Yahoo Finance data?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">YahooFinanceDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download Yahoo Finance data through opensignals.</span>
<span class="sd">    https://github.com/councilofelders/opensignals</span>

<span class="sd">    :param directory_path: Base folder to download files to.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">YahooFinanceDownloader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">SignalsAPI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">universe_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">TICKER_UNIVERSE_URL</span>

    <span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(minimal) weekly inference downloading here.&quot;&quot;&quot;</span>
        <span class="n">last_friday</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">FR</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># yahoo.download_data(self.dir)</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Training dataset downloading here.&quot;&quot;&quot;</span>
        <span class="o">...</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="425e0685-2ada-4c59-b530-d9814df4fcf0"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#425e0685-2ada-4c59-b530-d9814df4fcf0');

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "class YahooFinanceDownloader(BaseDownloader):\n    \"\"\"\n    Download Yahoo Finance data through opensignals.\n    https://github.com/councilofelders/opensignals\n\n    :param directory_path: Base folder to download files to.\n    \"\"\"\n    def __init__(self, directory_path: str, *args, **kwargs):\n        super(YahooFinanceDownloader, self).__init__(directory_path=directory_path)\n        self.api = SignalsAPI()\n        self.universe_url = self.api.TICKER_UNIVERSE_URL\n\n    def download_inference_data(self, *args, **kwargs):\n        \"\"\" (minimal) weekly inference downloading here. \"\"\"\n        last_friday = int(str((datetime.now() + relativedelta(weekday=FR(-1))).date()).replace(\"-\", \"\"))\n        # yahoo.download_data(self.dir)\n\n    def download_training_data(self, *args, **kwargs):\n        \"\"\" Training dataset downloading here. \"\"\"\n        ...";
                var nbb_formatted_code = "class YahooFinanceDownloader(BaseDownloader):\n    \"\"\"\n    Download Yahoo Finance data through opensignals.\n    https://github.com/councilofelders/opensignals\n\n    :param directory_path: Base folder to download files to.\n    \"\"\"\n\n    def __init__(self, directory_path: str, *args, **kwargs):\n        super(YahooFinanceDownloader, self).__init__(directory_path=directory_path)\n        self.api = SignalsAPI()\n        self.universe_url = self.api.TICKER_UNIVERSE_URL\n\n    def download_inference_data(self, *args, **kwargs):\n        \"\"\"(minimal) weekly inference downloading here.\"\"\"\n        last_friday = int(\n            str((datetime.now() + relativedelta(weekday=FR(-1))).date()).replace(\n                \"-\", \"\"\n            )\n        )\n        # yahoo.download_data(self.dir)\n\n    def download_training_data(self, *args, **kwargs):\n        \"\"\"Training dataset downloading here.\"\"\"\n        ...";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">yfinance_downloader</span> <span class="o">=</span> <span class="n">YahooFinanceDownloader</span><span class="p">(</span><span class="s2">&quot;test_yahoo&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Universe CSV path: </span><span class="si">{</span><span class="n">yfinance_downloader</span><span class="o">.</span><span class="n">universe_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Remove folder (when done with inference)</span>
<span class="n">yfinance_downloader</span><span class="o">.</span><span class="n">remove_base_directory</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">No existing directory found at <span style="color: #008000; text-decoration-color: #008000">'</span><span style="color: #000080; text-decoration-color: #000080">test_yahoo</span><span style="color: #008000; text-decoration-color: #008000">'</span>. Creating directory<span style="color: #808000; text-decoration-color: #808000">...</span>
</pre>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Universe CSV path: https://numerai-signals-public-data.s3-us-west-2.amazonaws.com/latest_universe.csv
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">⚠ <span style="color: #800000; text-decoration-color: #800000">Deleting directory for </span><span style="color: #800000; text-decoration-color: #800000">'YahooFinanceDownloader</span><span style="color: #008000; text-decoration-color: #008000">'</span> ⚠
Path: <span style="color: #008000; text-decoration-color: #008000">'/Users/clepelaars/Desktop/crowdcent/repositories/numerai-blocks/nbs/test_yahoo'</span>
</pre>

</div>

</div>

<div class="output_area">




<div id="be2426d5-bb1b-40bf-bd4e-e0a79c39a458"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#be2426d5-bb1b-40bf-bd4e-e0a79c39a458');

            setTimeout(function() {
                var nbb_cell_id = 15;
                var nbb_unformatted_code = "yfinance_downloader = YahooFinanceDownloader(\"test_yahoo\")\nprint(f\"Universe CSV path: {yfinance_downloader.universe_url}\")\n\n# Remove folder (when done with inference)\nyfinance_downloader.remove_base_directory()";
                var nbb_formatted_code = "yfinance_downloader = YahooFinanceDownloader(\"test_yahoo\")\nprint(f\"Universe CSV path: {yfinance_downloader.universe_url}\")\n\n# Remove folder (when done with inference)\nyfinance_downloader.remove_base_directory()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4.-FinnHub">4. FinnHub<a class="anchor-link" href="#4.-FinnHub"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="5.-Custom-Downloader">5. Custom Downloader<a class="anchor-link" href="#5.-Custom-Downloader"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We invite the Numerai Community to implement new downloaders using interesting APIs. This is especially important for creating innovative Numerai Signals models.</p>
<p>A new Downloader can be created by inheriting from <a href="/numerai_blocks/download.html#BaseDownloader"><code>BaseDownloader</code></a>. You should implement methods for <code>download_inference_data</code> and <code>download_training_data</code> so every downloader has a common interface.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">AwesomeCustomDownloader</span><span class="p">(</span><span class="n">BaseDownloader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - TEMPLATE -</span>
<span class="sd">    Download awesome financial data from who knows where.</span>

<span class="sd">    :param directory_path: Base folder to download files to.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AwesomeCustomDownloader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">directory_path</span><span class="o">=</span><span class="n">directory_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_inference_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(minimal) weekly inference downloading here.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">download_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Training + validation dataset downloading here.&quot;&quot;&quot;</span>
        <span class="o">...</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d869523c-f643-4f7f-9036-c9fe89f66c17"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d869523c-f643-4f7f-9036-c9fe89f66c17');

            setTimeout(function() {
                var nbb_cell_id = 16;
                var nbb_unformatted_code = "class AwesomeCustomDownloader(BaseDownloader):\n    \"\"\"\n    - TEMPLATE -\n    Download awesome financial data from who knows where.\n\n    :param directory_path: Base folder to download files to.\n    \"\"\"\n    def __init__(self, directory_path: str, *args, **kwargs):\n        super(AwesomeCustomDownloader, self).__init__(directory_path=directory_path)\n\n    def download_inference_data(self, *args, **kwargs):\n        \"\"\" (minimal) weekly inference downloading here. \"\"\"\n        ...\n\n    def download_training_data(self, *args, **kwargs):\n        \"\"\" Training + validation dataset downloading here. \"\"\"\n        ...";
                var nbb_formatted_code = "class AwesomeCustomDownloader(BaseDownloader):\n    \"\"\"\n    - TEMPLATE -\n    Download awesome financial data from who knows where.\n\n    :param directory_path: Base folder to download files to.\n    \"\"\"\n\n    def __init__(self, directory_path: str, *args, **kwargs):\n        super(AwesomeCustomDownloader, self).__init__(directory_path=directory_path)\n\n    def download_inference_data(self, *args, **kwargs):\n        \"\"\"(minimal) weekly inference downloading here.\"\"\"\n        ...\n\n    def download_training_data(self, *args, **kwargs):\n        \"\"\"Training + validation dataset downloading here.\"\"\"\n        ...";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

