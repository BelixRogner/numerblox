---

title: Model


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/04_model.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_model.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">load_ext</span> nb_black
<span class="o">%</span><span class="k">load_ext</span> lab_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="336c17ae-3307-488f-97ef-a86f265ff37b"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#336c17ae-3307-488f-97ef-a86f265ff37b');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_formatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.-Base">0. Base<a class="anchor-link" href="#0.-Base"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseModel" class="doc_header"><code>class</code> <code>BaseModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>file_suffix</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>ABC</code></p>
</blockquote>
<p>Setup for model prediction on a Dataset.</p>
<p>:param model_directory: Main directory from which to read in models.
:param file_suffix: File format to load (For example, .joblib, .cbm or .lgb)
:param model_name: Name that will be used to create column names and for display purposes.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="2a697f28-c88c-46e2-ac01-bbed7ddc26d3"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#2a697f28-c88c-46e2-ac01-bbed7ddc26d3');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "#export\n@typechecked\nclass BaseModel(ABC):\n    def __init__(self, model_directory: str, file_suffix: str, model_name: str = None, *args, **kwargs):\n        self.model_directory = Path(model_directory)\n        self.__dict__.update(*args, **kwargs)\n        self.model_name = model_name if model_name else uuid.uuid4().hex\n        self.prediction_col_name = f\"prediction_{self.model_name}\"\n        self.description = f\"{self.__class__.__name__}: '{self.model_name}' prediction\"\n\n        self.file_suffix = file_suffix\n        self.model_paths = self.model_directory.glob(f'*.{self.file_suffix}')\n        self.total_models = len(self.model_paths)\n        assert self.model_paths, f\"No {self.file_suffix} files found in {self.model_directory}.\"\n\n    @abstractmethod\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\" Return Dataset with column added for prediction. \"\"\"\n        ...\n        return Dataset(**dataset.__dict__)\n\n    def __call__(self, dataset: Dataset):\n        return self.predict(dataset)";
                var nbb_formatted_code = "# export\n@typechecked\nclass BaseModel(ABC):\n    def __init__(\n        self,\n        model_directory: str,\n        file_suffix: str,\n        model_name: str = None,\n        *args,\n        **kwargs,\n    ):\n        self.model_directory = Path(model_directory)\n        self.__dict__.update(*args, **kwargs)\n        self.model_name = model_name if model_name else uuid.uuid4().hex\n        self.prediction_col_name = f\"prediction_{self.model_name}\"\n        self.description = f\"{self.__class__.__name__}: '{self.model_name}' prediction\"\n\n        self.file_suffix = file_suffix\n        self.model_paths = self.model_directory.glob(f\"*.{self.file_suffix}\")\n        self.total_models = len(self.model_paths)\n        assert (\n            self.model_paths\n        ), f\"No {self.file_suffix} files found in {self.model_directory}.\"\n\n    @abstractmethod\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\"Return Dataset with column added for prediction.\"\"\"\n        ...\n        return Dataset(**dataset.__dict__)\n\n    def __call__(self, dataset: Dataset):\n        return self.predict(dataset)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Standard-model-formats">1. Standard model formats<a class="anchor-link" href="#1.-Standard-model-formats"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.1.-Joblib">1.1. Joblib<a class="anchor-link" href="#1.1.-Joblib"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Many frameworks like <code>sklearn</code> models can conveniently be saved as <code>.joblib</code> files. This class automatically load all <code>.joblib</code> files in a given folders and generates predictions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="JoblibModel" class="doc_header"><code>class</code> <code>JoblibModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L55" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>JoblibModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<p>Load and predict for arbitrary models saved as .joblib.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="006b656a-622d-4b8e-b9d1-d48d05c10c3d"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#006b656a-622d-4b8e-b9d1-d48d05c10c3d');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "#export\n@typechecked\nclass JoblibModel(BaseModel):\n    \"\"\" Load in arbitrary models saved as .joblib. \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"joblib\"\n        super(JoblibModel, self).__init__(model_directory=model_directory,\n                                          file_suffix=file_suffix,\n                                          model_name=model_name,\n                                          *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataset.dataf.loc[:, self.prediction_col_name] = np.zeros(len(dataset.dataf))\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df, *args, **kwargs)\n            dataset.dataf.loc[:, self.prediction_col_name] += predictions\n        del models; gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [joblib.load(path) for path in self.model_paths]";
                var nbb_formatted_code = "# export\n@typechecked\nclass JoblibModel(BaseModel):\n    \"\"\"Load in arbitrary models saved as .joblib.\"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"joblib\"\n        super(JoblibModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataset.dataf.loc[:, self.prediction_col_name] = np.zeros(len(dataset.dataf))\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df, *args, **kwargs)\n            dataset.dataf.loc[:, self.prediction_col_name] += predictions\n        del models\n        gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [joblib.load(path) for path in self.model_paths]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.2.-Catboost-(.cbm)">1.2. Catboost (.cbm)<a class="anchor-link" href="#1.2.-Catboost-(.cbm)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CatboostModel" class="doc_header"><code>class</code> <code>CatboostModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L80" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CatboostModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<p>Load and predict with all .cbm models (CatBoostRegressor) in directory.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="a1c10b78-7582-40ca-a5c7-cf9e50003056"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#a1c10b78-7582-40ca-a5c7-cf9e50003056');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "#export\n@typechecked\nclass CatboostModel(BaseModel):\n    \"\"\" Predict using .cbm models (CatBoostRegressor) with all models in directory. \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"cbm\"\n        super(CatboostModel, self).__init__(model_directory=model_directory,\n                                            file_suffix=file_suffix,\n                                            model_name=model_name, *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions\n        del models; gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [CatBoostRegressor().load_model(path) for path in self.model_paths]";
                var nbb_formatted_code = "# export\n@typechecked\nclass CatboostModel(BaseModel):\n    \"\"\"Predict using .cbm models (CatBoostRegressor) with all models in directory.\"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"cbm\"\n        super(CatboostModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs,\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions\n        del models\n        gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [CatBoostRegressor().load_model(path) for path in self.model_paths]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.3.-LightGBM-(.lgb)">1.3. LightGBM (.lgb)<a class="anchor-link" href="#1.3.-LightGBM-(.lgb)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LGBMModel" class="doc_header"><code>class</code> <code>LGBMModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L104" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LGBMModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<p>Load and predict with all .lgb models (LightGBM) in directory.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="779babb3-74b1-4ab6-9ebb-9aa0bfc929db"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#779babb3-74b1-4ab6-9ebb-9aa0bfc929db');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "#export\n@typechecked\nclass LGBMModel(BaseModel):\n    \"\"\" Parse predict .cbm models (CatBoostRegressor) from directory. \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"lgb\"\n        super(LGBMModel, self).__init__(model_directory=model_directory,\n                                        file_suffix=file_suffix,\n                                        model_name=model_name, *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions\n        del models; gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [lgb.Booster(path) for path in self.model_paths]";
                var nbb_formatted_code = "# export\n@typechecked\nclass LGBMModel(BaseModel):\n    \"\"\"Parse predict .cbm models (CatBoostRegressor) from directory.\"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"lgb\"\n        super(LGBMModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs,\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions\n        del models\n        gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [lgb.Booster(path) for path in self.model_paths]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Baseline-models">2. Baseline models<a class="anchor-link" href="#2.-Baseline-models"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ConstantModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING: Only use this Model for testing purposes.</span>
<span class="sd">    Create constant prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">constant_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant_value</span> <span class="o">=</span> <span class="n">constant_value</span>
        <span class="n">file_suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;constant_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constant_value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstantModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model_directory</span><span class="o">=</span><span class="n">model_directory</span><span class="p">,</span>
                                            <span class="n">file_suffix</span><span class="o">=</span><span class="n">file_suffix</span><span class="p">,</span>
                                            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_feature_data</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;prediction_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feature_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">dataset</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="e31a7c3f-050b-422f-bd06-d9ef1df51eb4"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#e31a7c3f-050b-422f-bd06-d9ef1df51eb4');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "class ConstantModel(BaseModel):\n    def __init__(self, model_directory: str, constant_value: float = 0.5):\n        self.constant_value = constant_value\n        file_suffix = \"\"\n        model_name = f\"constant_{self.constant_value}\"\n        super(ConstantModel, self).__init__(model_directory=model_directory,\n                                            file_suffix=file_suffix,\n                                            model_name=model_name)\n        self.clf = DummyRegressor(strategy='constant', constant=0.5)\n\n    def predict(self, dataset: Dataset) -> Dataset:\n        feature_df = dataset.get_feature_data\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = self.clf.predict(feature_df)\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "class ConstantModel(BaseModel):\n    def __init__(self, model_directory: str, constant_value: float = 0.5):\n        self.constant_value = constant_value\n        file_suffix = \"\"\n        model_name = f\"constant_{self.constant_value}\"\n        super(ConstantModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n        )\n        self.clf = DummyRegressor(strategy=\"constant\", constant=0.5)\n\n    def predict(self, dataset: Dataset) -> Dataset:\n        feature_df = dataset.get_feature_data\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = self.clf.predict(\n            feature_df\n        )\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-Custom-Model">3. Custom Model<a class="anchor-link" href="#3.-Custom-Model"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Arbitrary models can be instantiated by inheriting from <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a> and defining the <code>file_suffix</code>. All model_paths of models that are in <code>model_directory</code> will be defined upon instantiation. Arbitrary logic (model loading, prediction, etc.) can be defined in <code>.predict</code> as long as the method takes a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> as input and outputs a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a>. The Model should be able to typecheck by adding the <code>@typeguard.typechecked</code> decorator at the top of the class.</p>
<p>If loading model files is not relevant for your use case you should specify <code>file_suffix</code>=''.</p>
<p>For clear console output we recommend adding the <code>@display_processor_info</code> decorator.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AwesomeModel" class="doc_header"><code>class</code> <code>AwesomeModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AwesomeModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<ul>
<li>TEMPLATE -
Predict with arbitrary model formats.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="8ab0a81a-a8a4-465a-ac8e-98609eb49dac"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8ab0a81a-a8a4-465a-ac8e-98609eb49dac');

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "#export\n@typechecked\nclass AwesomeModel(BaseModel):\n    \"\"\"\n    - TEMPLATE -\n    Predict with arbitrary model formats.\n    \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"anything\"\n        super(AwesomeModel, self).__init__(model_directory=model_directory,\n                                           file_suffix=file_suffix,\n                                           model_name=model_name, *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\" Return Dataset with column added for prediction. \"\"\"\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        ...\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "# export\n@typechecked\nclass AwesomeModel(BaseModel):\n    \"\"\"\n    - TEMPLATE -\n    Predict with arbitrary model formats.\n    \"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"anything\"\n        super(AwesomeModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs,\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\"Return Dataset with column added for prediction.\"\"\"\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        ...\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

