---

title: Model


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/04_model.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_model.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">load_ext</span> nb_black
<span class="o">%</span><span class="k">load_ext</span> lab_black
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="83fe3660-b663-4746-a792-0efef55668be"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#83fe3660-b663-4746-a792-0efef55668be');

            setTimeout(function() {
                var nbb_cell_id = 1;
                var nbb_unformatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_formatted_code = "%load_ext autoreload\n%autoreload 2\n%load_ext nb_black\n%load_ext lab_black";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0.-Base">0. Base<a class="anchor-link" href="#0.-Base"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BaseModel" class="doc_header"><code>class</code> <code>BaseModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L24" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BaseModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>file_suffix</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>ABC</code></p>
</blockquote>
<p>Setup for model prediction on a Dataset.</p>
<p>:param model_directory: Main directory from which to read in models.
:param file_suffix: File format to load (For example, .joblib, .cbm or .lgb)
:param model_name: Name that will be used to create column names and for display purposes.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="cacfe1cc-c429-46f4-b602-1aa23bafb73e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#cacfe1cc-c429-46f4-b602-1aa23bafb73e');

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "#export\n@typechecked\nclass BaseModel(ABC):\n    \"\"\"\n    Setup for model prediction on a Dataset.\n\n    :param model_directory: Main directory from which to read in models.\n    :param file_suffix: File format to load (For example, .joblib, .cbm or .lgb)\n    :param model_name: Name that will be used to create column names and for display purposes.\n    \"\"\"\n    def __init__(self, model_directory: str, file_suffix: str, model_name: str = None, *args, **kwargs):\n        self.model_directory = Path(model_directory)\n        self.__dict__.update(*args, **kwargs)\n        self.model_name = model_name if model_name else uuid.uuid4().hex\n        self.prediction_col_name = f\"prediction_{self.model_name}\"\n        self.description = f\"{self.__class__.__name__}: '{self.model_name}' prediction\"\n\n        self.file_suffix = file_suffix\n        self.model_paths = list(self.model_directory.glob(f'*.{self.file_suffix}'))\n        if self.file_suffix:\n            assert self.model_paths, f\"No {self.file_suffix} files found in {self.model_directory}.\"\n        self.total_models = len(self.model_paths)\n\n    @abstractmethod\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\" Return Dataset with column added for prediction. \"\"\"\n        ...\n        return Dataset(**dataset.__dict__)\n\n    def __call__(self, dataset: Dataset) -> Dataset:\n        return self.predict(dataset)";
                var nbb_formatted_code = "# export\n@typechecked\nclass BaseModel(ABC):\n    \"\"\"\n    Setup for model prediction on a Dataset.\n\n    :param model_directory: Main directory from which to read in models.\n    :param file_suffix: File format to load (For example, .joblib, .cbm or .lgb)\n    :param model_name: Name that will be used to create column names and for display purposes.\n    \"\"\"\n\n    def __init__(\n        self,\n        model_directory: str,\n        file_suffix: str,\n        model_name: str = None,\n        *args,\n        **kwargs,\n    ):\n        self.model_directory = Path(model_directory)\n        self.__dict__.update(*args, **kwargs)\n        self.model_name = model_name if model_name else uuid.uuid4().hex\n        self.prediction_col_name = f\"prediction_{self.model_name}\"\n        self.description = f\"{self.__class__.__name__}: '{self.model_name}' prediction\"\n\n        self.file_suffix = file_suffix\n        self.model_paths = list(self.model_directory.glob(f\"*.{self.file_suffix}\"))\n        if self.file_suffix:\n            assert (\n                self.model_paths\n            ), f\"No {self.file_suffix} files found in {self.model_directory}.\"\n        self.total_models = len(self.model_paths)\n\n    @abstractmethod\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\"Return Dataset with column added for prediction.\"\"\"\n        ...\n        return Dataset(**dataset.__dict__)\n\n    def __call__(self, dataset: Dataset) -> Dataset:\n        return self.predict(dataset)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Standard-model-formats">1. Standard model formats<a class="anchor-link" href="#1.-Standard-model-formats"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.1.-Joblib">1.1. Joblib<a class="anchor-link" href="#1.1.-Joblib"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Many frameworks like <code>sklearn</code> models can conveniently be saved as <code>.joblib</code> files. This class automatically load all <code>.joblib</code> files in a given folders and generates predictions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="JoblibModel" class="doc_header"><code>class</code> <code>JoblibModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L56" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>JoblibModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<p>Load and predict for arbitrary models saved as .joblib.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="123d0ff8-7ddc-43b9-8e05-6d7c739da43f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#123d0ff8-7ddc-43b9-8e05-6d7c739da43f');

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "#export\n@typechecked\nclass JoblibModel(BaseModel):\n    \"\"\" Load and predict for arbitrary models saved as .joblib. \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = 'joblib'\n        super(JoblibModel, self).__init__(model_directory=model_directory,\n                                          file_suffix=file_suffix,\n                                          model_name=model_name,\n                                          *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataset.dataf.loc[:, self.prediction_col_name] = np.zeros(len(dataset.dataf))\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df, *args, **kwargs)\n            dataset.dataf.loc[:, self.prediction_col_name] += predictions / self.total_models\n        del models; gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [joblib.load(path) for path in self.model_paths]";
                var nbb_formatted_code = "# export\n@typechecked\nclass JoblibModel(BaseModel):\n    \"\"\"Load and predict for arbitrary models saved as .joblib.\"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"joblib\"\n        super(JoblibModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset, *args, **kwargs) -> Dataset:\n        dataset.dataf.loc[:, self.prediction_col_name] = np.zeros(len(dataset.dataf))\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df, *args, **kwargs)\n            dataset.dataf.loc[:, self.prediction_col_name] += (\n                predictions / self.total_models\n            )\n        del models\n        gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [joblib.load(path) for path in self.model_paths]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.2.-Catboost-(.cbm)">1.2. Catboost (.cbm)<a class="anchor-link" href="#1.2.-Catboost-(.cbm)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CatboostModel" class="doc_header"><code>class</code> <code>CatboostModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L81" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CatboostModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<p>Load and predict with all .cbm models (CatBoostRegressor) in directory.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="6efb5b9c-f4d5-4d0d-a869-5a908ade0daf"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#6efb5b9c-f4d5-4d0d-a869-5a908ade0daf');

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "#export\n@typechecked\nclass CatboostModel(BaseModel):\n    \"\"\" Load and predict with all .cbm models (CatBoostRegressor) in directory. \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = 'cbm'\n        super(CatboostModel, self).__init__(model_directory=model_directory,\n                                            file_suffix=file_suffix,\n                                            model_name=model_name, *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions / self.total_models\n        del models; gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [CatBoostRegressor().load_model(path) for path in self.model_paths]";
                var nbb_formatted_code = "# export\n@typechecked\nclass CatboostModel(BaseModel):\n    \"\"\"Load and predict with all .cbm models (CatBoostRegressor) in directory.\"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"cbm\"\n        super(CatboostModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs,\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions / self.total_models\n        del models\n        gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [CatBoostRegressor().load_model(path) for path in self.model_paths]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.3.-LightGBM-(.lgb)">1.3. LightGBM (.lgb)<a class="anchor-link" href="#1.3.-LightGBM-(.lgb)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LGBMModel" class="doc_header"><code>class</code> <code>LGBMModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L105" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LGBMModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<p>Load and predict with all .lgb models (LightGBM) in directory.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="0400b8d7-d8bd-45ce-9184-05af5ffb5c7f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#0400b8d7-d8bd-45ce-9184-05af5ffb5c7f');

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "#export\n@typechecked\nclass LGBMModel(BaseModel):\n    \"\"\" Load and predict with all .lgb models (LightGBM) in directory. \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = 'lgb'\n        super(LGBMModel, self).__init__(model_directory=model_directory,\n                                        file_suffix=file_suffix,\n                                        model_name=model_name, *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions / self.total_models\n        del models; gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [lgb.Booster(path) for path in self.model_paths]";
                var nbb_formatted_code = "# export\n@typechecked\nclass LGBMModel(BaseModel):\n    \"\"\"Load and predict with all .lgb models (LightGBM) in directory.\"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"lgb\"\n        super(LGBMModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs,\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        models = self._load_models()\n        for model in tqdm(models, desc=self.description):\n            predictions = model.predict(feature_df)\n            dataset.dataf.loc[:, self.model_name] += predictions / self.total_models\n        del models\n        gc.collect()\n        return Dataset(**dataset.__dict__)\n\n    def _load_models(self) -> list:\n        return [lgb.Booster(path) for path in self.model_paths]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Baseline-models">2. Baseline models<a class="anchor-link" href="#2.-Baseline-models"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ConstantModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING: Only use this Model for testing purposes.</span>
<span class="sd">    Create constant prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span>
        <span class="n">file_suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;constant_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstantModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model_directory</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                            <span class="n">file_suffix</span><span class="o">=</span><span class="n">file_suffix</span><span class="p">,</span>
                                            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clf</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">constant</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">([</span><span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_feature_data</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">dataf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;prediction_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feature_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">dataset</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="034e6ab5-e11a-4696-ae86-55a7ef51058e"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#034e6ab5-e11a-4696-ae86-55a7ef51058e');

            setTimeout(function() {
                var nbb_cell_id = 54;
                var nbb_unformatted_code = "class ConstantModel(BaseModel):\n    \"\"\"\n    WARNING: Only use this Model for testing purposes.\n    Create constant prediction.\n    \"\"\"\n    def __init__(self, constant: float = 0.5):\n        self.constant = constant\n        file_suffix = ''\n        model_name = f\"constant_{self.constant}\"\n        super(ConstantModel, self).__init__(model_directory=\"\",\n                                            file_suffix=file_suffix,\n                                            model_name=model_name)\n        self.clf = DummyRegressor(strategy='constant', constant=constant).fit([0.], [0.])\n\n    def predict(self, dataset: Dataset) -> Dataset:\n        feature_df = dataset.get_feature_data\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = self.clf.predict(feature_df)\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "class ConstantModel(BaseModel):\n    \"\"\"\n    WARNING: Only use this Model for testing purposes.\n    Create constant prediction.\n    \"\"\"\n\n    def __init__(self, constant: float = 0.5):\n        self.constant = constant\n        file_suffix = \"\"\n        model_name = f\"constant_{self.constant}\"\n        super(ConstantModel, self).__init__(\n            model_directory=\"\", file_suffix=file_suffix, model_name=model_name\n        )\n        self.clf = DummyRegressor(strategy=\"constant\", constant=constant).fit(\n            [0.0], [0.0]\n        )\n\n    def predict(self, dataset: Dataset) -> Dataset:\n        feature_df = dataset.get_feature_data\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = self.clf.predict(\n            feature_df\n        )\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">constant</span> <span class="o">=</span> <span class="mf">0.85</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;test_assets/mini_numerai_version_1_data.csv&quot;</span><span class="p">)</span>
<span class="n">constant_model</span> <span class="o">=</span> <span class="n">ConstantModel</span><span class="p">(</span><span class="n">constant</span><span class="o">=</span><span class="n">constant</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">constant_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">get_prediction_data</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">==</span> <span class="n">constant</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="b62a43d3-98c2-4b87-b096-2aa4381f1dbb"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#b62a43d3-98c2-4b87-b096-2aa4381f1dbb');

            setTimeout(function() {
                var nbb_cell_id = 64;
                var nbb_unformatted_code = "constant = 0.85\ndataset = create_dataset(\"test_assets/mini_numerai_version_1_data.csv\")\nconstant_model = ConstantModel(constant=constant)\npreds = constant_model.predict(dataset).get_prediction_data\nassert (preds.to_numpy() == constant).all()";
                var nbb_formatted_code = "constant = 0.85\ndataset = create_dataset(\"test_assets/mini_numerai_version_1_data.csv\")\nconstant_model = ConstantModel(constant=constant)\npreds = constant_model.predict(dataset).get_prediction_data\nassert (preds.to_numpy() == constant).all()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-Custom-Model">3. Custom Model<a class="anchor-link" href="#3.-Custom-Model"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Arbitrary models can be instantiated by inheriting from <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a> and defining the <code>file_suffix</code>. All model_paths of models that are in <code>model_directory</code> will be defined upon instantiation. Arbitrary logic (model loading, prediction, etc.) can be defined in <code>.predict</code> as long as the method takes a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a> as input and outputs a <a href="/numerai_blocks/dataset.html#Dataset"><code>Dataset</code></a>. The Model should be able to typecheck by adding the <code>@typeguard.typechecked</code> decorator at the top of the class.</p>
<p>If loading model files is not relevant for your use case you should specify <code>file_suffix</code>=''.</p>
<p>For clear console output we recommend adding the <code>@display_processor_info</code> decorator.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AwesomeModel" class="doc_header"><code>class</code> <code>AwesomeModel</code><a href="https://github.com/crowdcent/numerai_blocks/tree/main/numerai_blocks/model.py#L129" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AwesomeModel</code>(<strong><code>model_directory</code></strong>:<code>str</code>, <strong><code>model_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/numerai_blocks/model.html#BaseModel"><code>BaseModel</code></a></p>
</blockquote>
<ul>
<li>TEMPLATE -
Predict with arbitrary model formats.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="390566d9-8932-41a2-aff3-880f79caa6ac"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#390566d9-8932-41a2-aff3-880f79caa6ac');

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "#export\n@typechecked\nclass AwesomeModel(BaseModel):\n    \"\"\"\n    - TEMPLATE -\n    Predict with arbitrary model formats.\n    \"\"\"\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = 'anything'\n        super(AwesomeModel, self).__init__(model_directory=model_directory,\n                                           file_suffix=file_suffix,\n                                           model_name=model_name, *args, **kwargs)\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\" Return Dataset with column(s) added for prediction(s). \"\"\"\n        ...\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        ...\n        # Parse all contents of Dataset to the next pipeline step\n        return Dataset(**dataset.__dict__)";
                var nbb_formatted_code = "# export\n@typechecked\nclass AwesomeModel(BaseModel):\n    \"\"\"\n    - TEMPLATE -\n    Predict with arbitrary model formats.\n    \"\"\"\n\n    def __init__(self, model_directory: str, model_name: str = None, *args, **kwargs):\n        file_suffix = \"anything\"\n        super(AwesomeModel, self).__init__(\n            model_directory=model_directory,\n            file_suffix=file_suffix,\n            model_name=model_name,\n            *args,\n            **kwargs,\n        )\n\n    @display_processor_info\n    def predict(self, dataset: Dataset) -> Dataset:\n        \"\"\"Return Dataset with column(s) added for prediction(s).\"\"\"\n        ...\n        dataset.dataf.loc[:, f\"prediction_{self.model_name}\"] = 0\n        feature_df = dataset.get_feature_data\n        ...\n        # Parse all contents of Dataset to the next pipeline step\n        return Dataset(**dataset.__dict__)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

