<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Compute evaluation metrics.">

<title>numerblox - Evaluation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="numerblox - Evaluation">
<meta property="og:description" content="Compute evaluation metrics.">
<meta property="og:site-name" content="numerblox">
<meta name="twitter:title" content="numerblox - Evaluation">
<meta name="twitter:description" content="Compute evaluation metrics.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">numerblox</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Evaluation</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">NumerBlox</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">Misc</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download.html" class="sidebar-item-text sidebar-link">Download</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numerframe.html" class="sidebar-item-text sidebar-link">NumerFrame</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">Preprocessing</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model.html" class="sidebar-item-text sidebar-link">Model</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postprocessing.html" class="sidebar-item-text sidebar-link">Postprocessing</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelpipeline.html" class="sidebar-item-text sidebar-link">ModelPipeline</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./evaluation.html" class="sidebar-item-text sidebar-link active">Evaluation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./key.html" class="sidebar-item-text sidebar-link">Key</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./submission.html" class="sidebar-item-text sidebar-link">Submission</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#base" id="toc-base" class="nav-link" data-scroll-target="#base">0. Base</a>
  <ul class="collapse">
  <li><a href="#baseevaluator" id="toc-baseevaluator" class="nav-link" data-scroll-target="#baseevaluator">BaseEvaluator</a></li>
  </ul></li>
  <li><a href="#numerai-classic" id="toc-numerai-classic" class="nav-link" data-scroll-target="#numerai-classic">1. Numerai Classic</a>
  <ul class="collapse">
  <li><a href="#numeraiclassicevaluator" id="toc-numeraiclassicevaluator" class="nav-link" data-scroll-target="#numeraiclassicevaluator">NumeraiClassicEvaluator</a></li>
  </ul></li>
  <li><a href="#numerai-signals" id="toc-numerai-signals" class="nav-link" data-scroll-target="#numerai-signals">2. Numerai Signals</a>
  <ul class="collapse">
  <li><a href="#numeraisignalsevaluator" id="toc-numeraisignalsevaluator" class="nav-link" data-scroll-target="#numeraisignalsevaluator">NumeraiSignalsEvaluator</a></li>
  <li><a href="#example-usage" id="toc-example-usage" class="nav-link" data-scroll-target="#example-usage">Example usage</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/crowdcent/numerblox/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Evaluation</h1>
</div>

<div>
  <div class="description">
    Compute evaluation metrics.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This section provides evaluation schemes for both Numerai Classic and Signals. The <code>Evaluator</code> takes a <a href="https://crowdcent.github.io/numerblox/numerframe.html#numerframe"><code>NumerFrame</code></a> as input and returns a Pandas DataFrame containing metrics for each given prediction column.</p>
</section>
<section id="base" class="level2">
<h2 class="anchored" data-anchor-id="base">0. Base</h2>
<p><a href="https://crowdcent.github.io/numerblox/evaluation.html#baseevaluator"><code>BaseEvaluator</code></a> implements all the evaluation logic that is common for Numerai Classic and Signals. This includes: - Mean, Standard Deviation and Sharpe for era returns. - Max drawdown - Annual Percentage Yield (APY) - Correlation with example predictions - Max <a href="https://forum.numer.ai/t/model-diagnostics-feature-exposure/899">feature exposure</a> - <a href="https://docs.numer.ai/tournament/feature-neutral-correlation">Feature Neutral Mean (FNC)</a>, Standard deviation and Sharpe - <a href="https://forum.numer.ai/t/true-contribution-details/5128/4">Exposure Dissimilarity</a> - Mean, Standard Deviation and Sharpe for TB200 (Buy top 200 stocks and sell bottom 200 stocks). - Mean, Standard Deviation and Sharpe for TB500 (Buy top 500 stocks and sell bottom 500 stocks).</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/evaluation.py#L34" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="baseevaluator" class="level3">
<h3 class="anchored" data-anchor-id="baseevaluator">BaseEvaluator</h3>
<blockquote class="blockquote">
<pre><code> BaseEvaluator (era_col:str='era', fast_mode=False)</code></pre>
</blockquote>
<p>Evaluation functionality that is relevant for both Numerai Classic and Numerai Signals.</p>
<p>:param era_col: Column name pointing to eras.</p>
<p>Most commonly “era” for Numerai Classic and “friday_date” for Numerai Signals.</p>
<p>:param fast_mode: Will skip compute intensive metrics if set to True, namely max_exposure, feature neutral mean, TB200 and TB500.</p>
<p>Note that we calculate the sample standard deviation with ddof=0. It may differ slightly from the standard Pandas calculation, but is consistent with how NumPy computes standard deviation. More info: https://stackoverflow.com/questions/24984178/different-std-in-pandas-vs-numpy</p>
</section>
</section>
<section id="numerai-classic" class="level2">
<h2 class="anchored" data-anchor-id="numerai-classic">1. Numerai Classic</h2>
<p><a href="https://crowdcent.github.io/numerblox/evaluation.html#numeraiclassicevaluator"><code>NumeraiClassicEvaluator</code></a> extends the base evaluation scheme with metrics specific to Numerai Classic.</p>
<p>Additional metrics specific to Numerai are:</p>
<ul>
<li><a href="https://forum.numer.ai/t/true-contribution-details/5128/4">Feature Neutral Mean v3 (FNCv3)</a>, Standard deviation v3 and Sharpe v3.</li>
</ul>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/evaluation.py#L376" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="numeraiclassicevaluator" class="level3">
<h3 class="anchored" data-anchor-id="numeraiclassicevaluator">NumeraiClassicEvaluator</h3>
<blockquote class="blockquote">
<pre><code> NumeraiClassicEvaluator (era_col:str='era', fast_mode=False)</code></pre>
</blockquote>
<p>Evaluator for all metrics that are relevant in Numerai Classic.</p>
</section>
</section>
<section id="numerai-signals" class="level2">
<h2 class="anchored" data-anchor-id="numerai-signals">2. Numerai Signals</h2>
<p><a href="https://crowdcent.github.io/numerblox/evaluation.html#numeraisignalsevaluator"><code>NumeraiSignalsEvaluator</code></a> extends the base evaluation scheme with metrics specific to Numerai Signals.</p>
<hr>
<p><a href="https://github.com/crowdcent/numerblox/blob/master/numerblox/evaluation.py#L435" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="numeraisignalsevaluator" class="level3">
<h3 class="anchored" data-anchor-id="numeraisignalsevaluator">NumeraiSignalsEvaluator</h3>
<blockquote class="blockquote">
<pre><code> NumeraiSignalsEvaluator (era_col:str='friday_date', fast_mode=False)</code></pre>
</blockquote>
<p>Evaluator for all metrics that are relevant in Numerai Signals.</p>
</section>
<section id="example-usage" class="level3">
<h3 class="anchored" data-anchor-id="example-usage">Example usage</h3>
<section id="numeraiclassicevaluator-1" class="level4">
<h4 class="anchored" data-anchor-id="numeraiclassicevaluator-1">NumeraiClassicEvaluator</h4>
<p>We will test <a href="https://crowdcent.github.io/numerblox/evaluation.html#numeraiclassicevaluator"><code>NumeraiClassicEvaluator</code></a> on version 3 evaluation data with example predictions. The baseline reference (<code>example_col</code>) will be random predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numerblox.download <span class="im">import</span> NumeraiClassicDownloader</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> <span class="st">"eval_test_1234321/"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>downloader <span class="op">=</span> NumeraiClassicDownloader(directory_path<span class="op">=</span>directory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No existing directory found at 'eval_test_1234321'. Creating directory...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>downloader.download_single_dataset(filename<span class="op">=</span><span class="st">"v4.1/validation.parquet"</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                                   dest_path<span class="op">=</span>directory <span class="op">+</span> <span class="st">"validation.parquet"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>downloader.download_single_dataset(filename<span class="op">=</span><span class="st">"v4.1/validation_example_preds.parquet"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                   dest_path<span class="op">=</span>directory <span class="op">+</span> <span class="st">"validation_example_preds.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">No existing directory found at <span style="color: #008000; text-decoration-color: #008000">'</span><span style="color: #000080; text-decoration-color: #000080">eval_test_1234321</span><span style="color: #008000; text-decoration-color: #008000">'</span>. Creating directory<span style="color: #808000; text-decoration-color: #808000">...</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'v4.1/validation.parquet'</span> 📁
</pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-01-31 17:36:50,161 INFO numerapi.utils: starting download
eval_test_1234321/validation.parquet: 1.51GB [01:02, 24.2MB/s]                            </code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">📁 <span style="color: #008000; text-decoration-color: #008000">Downloading</span> <span style="color: #008000; text-decoration-color: #008000">'v4.1/validation_example_preds.parquet'</span> 📁
</pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-01-31 17:37:53,094 INFO numerapi.utils: starting download
eval_test_1234321/validation_example_preds.parquet: 56.9MB [00:02, 27.4MB/s]                            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> create_numerframe(directory <span class="op">+</span> <span class="st">"validation.parquet"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>example_preds <span class="op">=</span> pd.read_parquet(directory <span class="op">+</span> <span class="st">"validation_example_preds.parquet"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> test_dataf.merge(example_preds, on<span class="op">=</span><span class="st">"id"</span>, how<span class="op">=</span><span class="st">"left"</span>).reset_index()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>test_dataf <span class="op">=</span> test_dataf.sample(<span class="dv">10_000</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>test_dataf.loc[:, <span class="st">"prediction_random"</span>] <span class="op">=</span> np.random.uniform(size<span class="op">=</span><span class="bu">len</span>(test_dataf))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>test_dataf.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>era</th>
      <th>data_type</th>
      <th>feature_honoured_observational_balaamite</th>
      <th>feature_polaroid_vadose_quinze</th>
      <th>feature_untidy_withdrawn_bargeman</th>
      <th>feature_genuine_kyphotic_trehala</th>
      <th>feature_unenthralled_sportful_schoolhouse</th>
      <th>feature_divulsive_explanatory_ideologue</th>
      <th>feature_ichthyotic_roofed_yeshiva</th>
      <th>...</th>
      <th>target_george_v4_20</th>
      <th>target_george_v4_60</th>
      <th>target_william_v4_20</th>
      <th>target_william_v4_60</th>
      <th>target_arthur_v4_20</th>
      <th>target_arthur_v4_60</th>
      <th>target_thomas_v4_20</th>
      <th>target_thomas_v4_60</th>
      <th>prediction</th>
      <th>prediction_random</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1830220</th>
      <td>n4958fe1e51ed7b1</td>
      <td>0937</td>
      <td>validation</td>
      <td>0.5</td>
      <td>0.25</td>
      <td>0.5</td>
      <td>0.0</td>
      <td>0.5</td>
      <td>0.0</td>
      <td>0.50</td>
      <td>...</td>
      <td>0.5</td>
      <td>0.5</td>
      <td>0.666667</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.333333</td>
      <td>0.262811</td>
      <td>0.246772</td>
    </tr>
    <tr>
      <th>447082</th>
      <td>nff20d793aa8db78</td>
      <td>0664</td>
      <td>validation</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.25</td>
      <td>...</td>
      <td>0.5</td>
      <td>0.5</td>
      <td>0.166667</td>
      <td>0.166667</td>
      <td>0.333333</td>
      <td>0.333333</td>
      <td>0.333333</td>
      <td>0.166667</td>
      <td>0.692049</td>
      <td>0.385958</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 1620 columns</p>
</div>
</div>
</div>
<p>The <code>Evaluator</code> returns a Pandas DataFrame containing metrics for each prediction column defined. Note that any column can be used as example prediction. For practical use cases we recommend using proper example predictions (provided by Numerai) instead of random predictions.</p>
</section>
<section id="fast-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="fast-evaluation">Fast evaluation</h4>
<p><code>fast_mode</code> skips max. feature exposure, feature neutral mean, FNCv3, Exposure Dissimilarity, TB200 and TB500 calculations, which can take a while to compute on full Numerai datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>evaluator <span class="op">=</span> NumeraiClassicEvaluator(fast_mode<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>val_stats_fast <span class="op">=</span> evaluator.full_evaluation(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    dataf<span class="op">=</span>test_dataf,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    target_col<span class="op">=</span><span class="st">"target"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    pred_cols<span class="op">=</span>[<span class="st">"prediction"</span>, <span class="st">"prediction_random"</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    example_col<span class="op">=</span><span class="st">"prediction_random"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>val_stats_fast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using 'v4.1/features.json/medium' feature set to calculate FNC metrics.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d3952796013c4dbe86eddab2e9b49667","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>target</th>
      <th>mean</th>
      <th>std</th>
      <th>sharpe</th>
      <th>max_drawdown</th>
      <th>apy</th>
      <th>corr_with_example_preds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>prediction</th>
      <td>target</td>
      <td>0.050420</td>
      <td>0.235582</td>
      <td>0.214023</td>
      <td>-0.998109</td>
      <td>155.074861</td>
      <td>0.007460</td>
    </tr>
    <tr>
      <th>prediction_random</th>
      <td>target</td>
      <td>-0.006162</td>
      <td>0.233542</td>
      <td>-0.026385</td>
      <td>-1.000000</td>
      <td>-62.819089</td>
      <td>0.981837</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="plot-correlations" class="level4">
<h4 class="anchored" data-anchor-id="plot-correlations">Plot correlations</h4>
<p>The <code>plot_correlations</code> method will use matplotlib to plot per era correlation scores over time. The plots default to a rolling window of 20 eras in order to best align with repuation scores as measured on the Numerai leaderboards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>evaluator.plot_correlations(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    test_dataf, pred_cols<span class="op">=</span>[<span class="st">"prediction"</span>, <span class="st">"prediction_random"</span>], roll_mean<span class="op">=</span><span class="dv">20</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="07_evaluation_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="07_evaluation_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up environment</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>downloader.remove_base_directory()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">⚠ <span style="color: #800000; text-decoration-color: #800000">Deleting directory for </span><span style="color: #800000; text-decoration-color: #800000">'NumeraiClassicDownloader</span><span style="color: #008000; text-decoration-color: #008000">'</span> ⚠
Path: <span style="color: #008000; text-decoration-color: #008000">'/home/clepelaars/numerblox/nbs/eval_test_1234321'</span>
</pre>
</div>
</div>
<hr>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>